function escapeHtml(a){return String(a).replace(/[&<>"'\/]/g,function(a){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}[a]})}!function(a,b,c,d,e,f,g,h){function i(a){return a&&typeof a===b&&!(typeof a.length===c&&!a.propertyIsEnumerable(d))&&a||null}function j(a){return a&&typeof a===b&&typeof a.length===c&&!a.propertyIsEnumerable(d)&&a||null}function k(a){return a&&"function"==typeof a&&a||null}function l(a){return"[object String]"===e.apply(a)&&a||null}function m(a){return k(a)&&a.prototype&&a===a.prototype.constructor&&a||null}function n(a,b,c,d,e,f){c&&c.hasOwnProperty(a)||(d[a]=b,e&&(f[a]=b))}function o(a,b,c){if(j(b))for(var d=b.length;--d>=0;)o(a,b[d],c);else{c=c||{constructor:1,$super:1,prototype:1,$superp:1};var e,f,g=m(a),h=m(b),k=a.prototype;if(i(b))for(e in b)n(e,b[e],c,a,g,k);if(h){f=b.prototype;for(e in f)n(e,f[e],c,a,g,k)}g&&h&&o(k,b.prototype,c)}}function p(a,b){b||(b=a,a=0);var c,d,e,f,g,h,i,l,n=0,o={constructor:1,$singleton:1,$statics:1,prototype:1,$super:1,$superp:1,main:1,toString:0},q=p.plugins;b=("function"==typeof b?b():b)||{},d=b.hasOwnProperty("constructor")?b.constructor:0,e=b.$singleton,f=b.$statics;for(g in q)o[g]=1;for(c=e?{}:d?d:function(){},a=!a||j(a)?a:[a],i=a&&a.length,!e&&i&&(c.prototype=m(a[0])?new a[0]:a[0],c.prototype.constructor=c),h=e?c:c.prototype;i>n;){l=a[n++];for(g in l)o[g]||(h[g]=l[g],e||(c[g]=l[g]));for(g in l.prototype)o[g]||(h[g]=l.prototype[g])}for(g in b)o[g]||(h[g]=b[g]);for(g in f)c[g]=h[g]=f[g];e||(l=a&&a[0]||a,c.$super=l,c.$superp=l&&l.prototype?l.prototype:l);for(g in q)q[g](c,a,b);return k(b.main)&&b.main.call(c,c),c}p.plugins={},h={Class:p,extend:o,mapOrNil:i,arrayOrNil:j,functionOrNil:k,stringOrNil:l,classOrNil:m},"undefined"!=typeof module&&module.exports?module.exports=h:(g=a.Class,a.Class=p,a.jsface=h,h.noConflict=function(){a.Class=g})}(this,"object","number","length",Object.prototype.toString);var GF=new function(){this.escapeHtml=escapeHtml,this.uiEitherOr=function(a,b){var c=$(a),d=$(b);c.bind({keyup:function(){d.prop("disabled",$(this).val().length)},blur:function(){""!=c.val()&&d.prop("disabled","disable")}}),d.bind({keyup:function(){c.prop("disabled",$(this).val().length)},blur:function(){""!=d.val()&&c.prop("disabled","disable")}})}},VehicleSearchHelper=function(){var a=$("#vehicle-search"),b=$("#vehicle-search-form"),c=document.getElementById("type").selectedIndex,d=$("[data-toggle=popover]");b.validate({rules:{search:{required:!0}},errorClass:"inputError",errorContainer:$("#validation-summary-id"),errorLabelContainer:$("#validation-summary-id ol"),wrapper:"li"}),c==REGISTRATION?a.attr("placeholder",REGISTRATION_PLACEHOLDER):a.attr("placeholder",VIN_PLACEHOLDER),$("#type").on("change",function(){switch(c=document.getElementById("type").selectedIndex){case 0:a.attr("placeholder",REGISTRATION_PLACEHOLDER),a.unbind();break;case 1:a.attr("placeholder",VIN_PLACEHOLDER),a.unbind()}});var e="ontouchstart"in document.documentElement;e?d.popover({placement:"top",html:!0,trigger:"click"}):d.popover({placement:"top",html:!0,trigger:"hover"})},VehicleResultHelper=function(){var a=$("#listVehicles");a.dataTable({bPaginate:!0,bLengthChange:!0,bFilter:!0,bSort:!0,aaSorting:[[6,"desc"]],bInfo:!0,bAutoWidth:!0,oLanguage:{sSearch:"Filter:"},bProcessing:!1,bServerSide:!1,bDeferRender:!0,aoColumnDefs:[{sClass:"truncate",aTargets:[4,5]}]}),$("#listVehicles_filter").find("input").addClass("form-control"),a.find("thead").attr("style","background-color:#DEE0E2;")},EventListHelper=function(a,b){var c=$("#listLogs"),d=c.dataTable({bPaginate:!0,bLengthChange:!0,bFilter:!0,bSort:!0,aaSorting:[[1,"desc"]],bInfo:!0,bAutoWidth:!0,oLanguage:{sSearch:"Filter:",sLengthMenu:"Show _MENU_ events per page",sInfo:"_START_ to _END_ events showing from a total of _TOTAL_ ",sInfoFiltered:"(filtered from _MAX_ events)",sInfoEmpty:"No events to show"},lengthMenu:[[10,25,50],[10,25,50]],dom:'<"top"if>rt<"bottom"lp><"clear">',aoColumns:[{mData:"type"},{mData:"date"},{mData:"description"}],aoColumnDefs:[{sClass:"longer-truncate",aTargets:[2]},{aTargets:[0],render:function(a){return'<a href="'+a.url+'">'+a.type+"</a>"}}],sAjaxDataProp:"data",sServerMethod:"POST",bProcessing:!0,bServerSide:!0,bDeferRender:!1,sAjaxSource:b,fnServerData:function(a,b,c){b.push({name:"_csrf_token",value:$('input[name="_csrf_token"]').val()}),b.push({name:"search",value:$("#search").val()}),b.push({name:"isShowDate",value:$("#isShowDate").val()}),b.push({name:"dateFrom[Day]",value:$("#dateFrom-Day").val()}),b.push({name:"dateFrom[Month]",value:$("#dateFrom-Month").val()}),b.push({name:"dateFrom[Year]",value:$("#dateFrom-Year").val()}),b.push({name:"dateTo[Day]",value:$("#dateTo-Day").val()}),b.push({name:"dateTo[Month]",value:$("#dateTo-Month").val()}),b.push({name:"dateTo[Year]",value:$("#dateTo-Year").val()}),$.getJSON(a,b,function(a){c(a)})}});c.find("thead").attr("style","background-color:#DEE0E2;"),$(".dataTables_filter").hide(),$("#searchbox").keyup(function(){d.fnFilter(this.value)});var e=$(".dataTables_length"),f=e.find("select"),g=e.find("label");$(g).hide(),$(".page-results-control").find("a").click(function(){$(f).val(this.text),$(f).trigger("change");var a=$(f).find(":selected").text();$(".page-results-control").find("a").removeClass("item-link-disabled"),$("a#length"+a).addClass("item-link-disabled")});var h=$("#dateRangeFields"),i=$("#isShowDate"),j=$("#allEvents"),k=$("#search");a||(h.hide(),j.addClass("item-bold-link-disabled")),$("#customRange").click(function(){h.show("slow"),i.val(1)}),j.click(function(){return $(this).hasClass("item-bold-link-disabled")?!1:(0!==k.val().length&&$(this).attr("href",$(this).attr("href")+"?search="+k.val()),!0)});var l=$(f).find(":selected").text();$("a#length"+l).addClass("item-link-disabled")},CompareScreenRowSteering=jsface.Class({$statics:{SCORE_VALUE_DISREGARD:1,SCORE_VALUE_NO_DEFECT:5,SCORE_INDEX_DISREGARD:0,DEFECT_VALUE_PLEASE_SELECT:"",DEFECT_VALUE_NOT_APPLICABLE:1,DEFECT_VALUE_DEFECT_MISSED:2,DEFECT_VALUE_INCORRECT_DECISION:3},constructor:function(a,b){this.posted=b,this.loading=!0,this.isTesterRow=$(a).hasClass("tester-row"),this.isVehicleExaminerRow=$(a).hasClass("vehicle-examiner-row"),this.score=$(a).find(".point-score"),this.defect=$(a).find(".defects-decisions"),this.category=$(a).find(".categories"),this.justification=$(a).find(".justification"),this.changingItem=null,this.previousIndex={score:null,defect:null,category:null},this.initDefaults()},initDefaults:function(){_.bindAll(this,"onScoreChange","onDefectChange","onCategoryChange"),this.initScoreOptions(),this.initDefectOptions(),this.disableElement(this.defect),this.disableElement(this.category),this.score.on("change",this.onScoreChange),this.defect.on("change",this.onDefectChange),this.category.on("change",this.onCategoryChange),this.isPosted&&this.score.trigger("change")},isPosted:function(){return this.posted===!0},onScoreChange:function(){if(null===this.changingItem){switch(this.changingItem=this.score,this.isVehicleExaminerRow&&(this.toggleNotApplicableOption(this.defect,"1"==this.score.val()),this.toggleNotApplicableOption(this.category,"1"==this.score.val())),parseInt(this.score.val())){case this.SCORE_VALUE_DISREGARD:this.changeSelectValue(this.defect,1),this.changeSelectValue(this.category,1),this.disableElement(this.defect),this.disableElement(this.category);break;case this.SCORE_VALUE_NO_DEFECT:this.enableElement(this.defect),this.enableElement(this.category),this.previousIndex.score==this.SCORE_INDEX_DISREGARD&&(this.changeSelectIndex(this.defect,0),this.changeSelectIndex(this.category,0)),this.isTesterRow&&this.defect.val()==this.DEFECT_VALUE_INCORRECT_DECISION&&(this.changeSelectIndex(this.category,1),this.disableElement(this.category));break;default:this.isTesterRow?this.changeSelectIndex(this.defect,2):this.isVehicleExaminerRow&&this.loading===!1&&(this.changeSelectIndex(this.defect,0),this.changeSelectIndex(this.category,0)),this.enableElement(this.defect),this.enableElement(this.category)}Backbone.Events.trigger("score-changed",{}),this.previousIndex.score=this.index(this.score),this.changingItem=null}},onDefectChange:function(){if(null===this.changingItem){this.changingItem=this.score;var a=parseInt(this.defect.val());this.defect.val()==this.DEFECT_VALUE_PLEASE_SELECT?(this.changeSelectValue(this.category,0),this.enableElement(this.category)):a===this.DEFECT_VALUE_NOT_APPLICABLE?(this.enableElement(this.category),this.isTesterRow?this.changeSelectValue(this.category,1):this.isVehicleExaminerRow&&this.changeSelectValue(this.category,0)):this.isTesterRow&&this.score.val()==this.SCORE_VALUE_NO_DEFECT&&a===this.DEFECT_VALUE_INCORRECT_DECISION&&(this.changeSelectIndex(this.category,1),this.disableElement(this.category)),this.previousIndex.defect=this.index(this.defect),this.changingItem=null}},onCategoryChange:function(){null===this.changingItem&&(this.changingItem=this.category,this.previousIndex.category=this.index(this.category),this.changingItem=null)},initScoreOptions:function(){this.isTesterRow===!0&&"20 - Other defect missed"==this.score.find("option:nth-child(6)").text().trim()&&this.score.find("option:nth-child(6)").remove(),this.isVehicleExaminerRow===!0&&"20 - No defect"==this.score.find("option:nth-child(5)").text().trim()&&this.score.find("option:nth-child(5)").remove()},initDefectOptions:function(){this.isTesterRow===!0&&"Defect missed"==this.defect.find("option:nth-child(3)").text().trim()&&this.defect.find("option:nth-child(3)").remove()},toggleNotApplicableOption:function(a,b){var c=a.find("option:contains(Not applicable)").length>0;if(!(b===!0&&c===!0||b===!1&&c===!1))return b===!0&&c===!1?void a.find("option").eq(0).after('<option value="1">Not applicable</option>'):void a.find("option:contains(Not applicable)").remove()},changeSelectValue:function(a,b){a.val(b).change()},index:function(a){return a.prop("selectedIndex")},changeSelectIndex:function(a,b){a.prop("selectedIndex",b)},disableElement:function(a){a.prop("disabled",!0)},enableElement:function(a){a.prop("disabled",!1)}}),CompareScreenSteering=jsface.Class({$statics:{CASE_OUTCOME_NO_FURTHER_ACTION:1,CASE_OUTCOME_ADVISORY_WARNING_LETTER:2,CASE_OUTCOME_DISCIPLINARY_ACTION_REPORT:3},constructor:function(a){this.models=[],this.table=null,this.selector=a.selector||null,this.isPosted=a.isPosted||!1,this.caseOutcome=null,this.totalScore=0,this.bound1=9,this.bound2=29,this.bound3=30,_.bindAll(this,"onCaseOutcomeChange")},attach:function(){var a=this;return this.table=$(this.selector),null===this.table,this.caseOutcome=this.table.find("#caseOutcome"),this.caseOutcome.on("change",this.onCaseOutcomeChange),$(this.table.find("tr.tester-row,tr.vehicle-examiner-row")).map(function(b,c){a.models.push(new CompareScreenRowSteering(c,a.isPosted))}),Backbone.Events.on("score-changed",function(){this.calcTotalScore(),this.onTotalScoreChange(!1)},this),this.calcTotalScore(),this.onTotalScoreChange(!0),this.models.map(function(a){return a.loading=!1,a}),this},calcTotalScore:function(){return this.totalScore=0,this.models.map(function(a){this.totalScore+=parseInt(a.score.find(":selected").data("value"))||0},this),this},preSelectCaseOutcome:function(){this.totalScore<this.bound1?this.caseOutcome.val(1):this.totalScore<=this.bound2?this.caseOutcome.val(2):this.totalScore>=this.bound3&&this.caseOutcome.val(3)},onTotalScoreChange:function(a){return Backbone.Events.trigger("total-score-changed",{totalScore:this.totalScore,suppressCaseOutcome:a===!0?1:0}),this},onCaseOutcomeChange:function(){var a=parseInt(this.caseOutcome.find(":selected").val());this.totalScore<=this.bound1&&"1"!=a?this.triggerCaseOutcomeJustificationRequired("Rule 1"):this.totalScore>this.bound1&&this.totalScore<=this.bound2&&"2"!=a?this.triggerCaseOutcomeJustificationRequired("Rule 2"):this.totalScore>=this.bound3&&"3"!=a&&this.triggerCaseOutcomeJustificationRequired("Rule 3")},triggerCaseOutcomeJustificationRequired:function(a){return Backbone.Events.trigger("case-outcome-justification-required",{totalScore:this.totalScore,caseOutcome:parseInt(this.caseOutcome.find(":selected").val()),rule:a}),this}});