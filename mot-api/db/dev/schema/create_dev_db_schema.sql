-- MySQL dump 10.13  Distrib 5.7.11, for osx10.11 (x86_64)
--
-- Host: mysql    Database: mot2
-- ------------------------------------------------------
-- Server version	5.6.28-76.1

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00'  */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Current Database: `mot2`
--

/*!40000 DROP DATABASE IF EXISTS `mot2`*/;

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `mot2` /*!40100 DEFAULT CHARACTER SET utf8 */;

USE `mot2`;

--
-- Table structure for table `BATCH_JOB_EXECUTION`
--

DROP TABLE IF EXISTS `BATCH_JOB_EXECUTION`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_EXECUTION` (
  `JOB_EXECUTION_ID` bigint(20) NOT NULL,
  `VERSION` bigint(20) DEFAULT NULL,
  `JOB_INSTANCE_ID` bigint(20) NOT NULL,
  `CREATE_TIME` datetime NOT NULL,
  `START_TIME` datetime DEFAULT NULL,
  `END_TIME` datetime DEFAULT NULL,
  `STATUS` varchar(10) DEFAULT NULL,
  `EXIT_CODE` varchar(2500) DEFAULT NULL,
  `EXIT_MESSAGE` varchar(2500) DEFAULT NULL,
  `LAST_UPDATED` datetime DEFAULT NULL,
  `JOB_CONFIGURATION_LOCATION` varchar(2500) DEFAULT NULL,
  PRIMARY KEY (`JOB_EXECUTION_ID`),
  KEY `JOB_INST_EXEC_FK` (`JOB_INSTANCE_ID`),
  CONSTRAINT `JOB_INST_EXEC_FK` FOREIGN KEY (`JOB_INSTANCE_ID`) REFERENCES `BATCH_JOB_INSTANCE` (`JOB_INSTANCE_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_JOB_EXECUTION_CONTEXT`
--

DROP TABLE IF EXISTS `BATCH_JOB_EXECUTION_CONTEXT`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_EXECUTION_CONTEXT` (
  `JOB_EXECUTION_ID` bigint(20) NOT NULL,
  `SHORT_CONTEXT` varchar(2500) NOT NULL,
  `SERIALIZED_CONTEXT` text,
  PRIMARY KEY (`JOB_EXECUTION_ID`),
  CONSTRAINT `JOB_EXEC_CTX_FK` FOREIGN KEY (`JOB_EXECUTION_ID`) REFERENCES `BATCH_JOB_EXECUTION` (`JOB_EXECUTION_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_JOB_EXECUTION_PARAMS`
--

DROP TABLE IF EXISTS `BATCH_JOB_EXECUTION_PARAMS`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_EXECUTION_PARAMS` (
  `JOB_EXECUTION_ID` bigint(20) NOT NULL,
  `TYPE_CD` varchar(6) NOT NULL,
  `KEY_NAME` varchar(100) NOT NULL,
  `STRING_VAL` varchar(250) DEFAULT NULL,
  `DATE_VAL` datetime DEFAULT NULL,
  `LONG_VAL` bigint(20) DEFAULT NULL,
  `DOUBLE_VAL` double DEFAULT NULL,
  `IDENTIFYING` char(1) NOT NULL,
  KEY `JOB_EXEC_PARAMS_FK` (`JOB_EXECUTION_ID`),
  CONSTRAINT `JOB_EXEC_PARAMS_FK` FOREIGN KEY (`JOB_EXECUTION_ID`) REFERENCES `BATCH_JOB_EXECUTION` (`JOB_EXECUTION_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_JOB_EXECUTION_SEQ`
--

DROP TABLE IF EXISTS `BATCH_JOB_EXECUTION_SEQ`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_EXECUTION_SEQ` (
  `ID` bigint(20) NOT NULL,
  `UNIQUE_KEY` char(1) NOT NULL,
  UNIQUE KEY `UNIQUE_KEY_UN` (`UNIQUE_KEY`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_JOB_INSTANCE`
--

DROP TABLE IF EXISTS `BATCH_JOB_INSTANCE`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_INSTANCE` (
  `JOB_INSTANCE_ID` bigint(20) NOT NULL,
  `VERSION` bigint(20) DEFAULT NULL,
  `JOB_NAME` varchar(100) NOT NULL,
  `JOB_KEY` varchar(32) NOT NULL,
  PRIMARY KEY (`JOB_INSTANCE_ID`),
  UNIQUE KEY `JOB_INST_UN` (`JOB_NAME`,`JOB_KEY`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_JOB_SEQ`
--

DROP TABLE IF EXISTS `BATCH_JOB_SEQ`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_JOB_SEQ` (
  `ID` bigint(20) NOT NULL,
  `UNIQUE_KEY` char(1) NOT NULL,
  UNIQUE KEY `UNIQUE_KEY_UN` (`UNIQUE_KEY`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_STEP_EXECUTION`
--

DROP TABLE IF EXISTS `BATCH_STEP_EXECUTION`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_STEP_EXECUTION` (
  `STEP_EXECUTION_ID` bigint(20) NOT NULL,
  `VERSION` bigint(20) NOT NULL,
  `STEP_NAME` varchar(100) NOT NULL,
  `JOB_EXECUTION_ID` bigint(20) NOT NULL,
  `START_TIME` datetime NOT NULL,
  `END_TIME` datetime DEFAULT NULL,
  `STATUS` varchar(10) DEFAULT NULL,
  `COMMIT_COUNT` bigint(20) DEFAULT NULL,
  `READ_COUNT` bigint(20) DEFAULT NULL,
  `FILTER_COUNT` bigint(20) DEFAULT NULL,
  `WRITE_COUNT` bigint(20) DEFAULT NULL,
  `READ_SKIP_COUNT` bigint(20) DEFAULT NULL,
  `WRITE_SKIP_COUNT` bigint(20) DEFAULT NULL,
  `PROCESS_SKIP_COUNT` bigint(20) DEFAULT NULL,
  `ROLLBACK_COUNT` bigint(20) DEFAULT NULL,
  `EXIT_CODE` varchar(2500) DEFAULT NULL,
  `EXIT_MESSAGE` varchar(2500) DEFAULT NULL,
  `LAST_UPDATED` datetime DEFAULT NULL,
  PRIMARY KEY (`STEP_EXECUTION_ID`),
  KEY `JOB_EXEC_STEP_FK` (`JOB_EXECUTION_ID`),
  CONSTRAINT `JOB_EXEC_STEP_FK` FOREIGN KEY (`JOB_EXECUTION_ID`) REFERENCES `BATCH_JOB_EXECUTION` (`JOB_EXECUTION_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_STEP_EXECUTION_CONTEXT`
--

DROP TABLE IF EXISTS `BATCH_STEP_EXECUTION_CONTEXT`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_STEP_EXECUTION_CONTEXT` (
  `STEP_EXECUTION_ID` bigint(20) NOT NULL,
  `SHORT_CONTEXT` varchar(2500) NOT NULL,
  `SERIALIZED_CONTEXT` text,
  PRIMARY KEY (`STEP_EXECUTION_ID`),
  CONSTRAINT `STEP_EXEC_CTX_FK` FOREIGN KEY (`STEP_EXECUTION_ID`) REFERENCES `BATCH_STEP_EXECUTION` (`STEP_EXECUTION_ID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `BATCH_STEP_EXECUTION_SEQ`
--

DROP TABLE IF EXISTS `BATCH_STEP_EXECUTION_SEQ`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `BATCH_STEP_EXECUTION_SEQ` (
  `ID` bigint(20) NOT NULL,
  `UNIQUE_KEY` char(1) NOT NULL,
  UNIQUE KEY `UNIQUE_KEY_UN` (`UNIQUE_KEY`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `address`
--

DROP TABLE IF EXISTS `address`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `address` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `address_line_1` varchar(50) DEFAULT NULL COMMENT 'SAON (secondary addressable object name) i.e. Flat or Unit NumberLegacy data my composite with PAON',
  `address_line_2` varchar(50) DEFAULT NULL COMMENT 'PAON (primary addressable object name) i.e. House name or number',
  `address_line_3` varchar(50) DEFAULT NULL,
  `address_line_4` varchar(50) DEFAULT NULL,
  `postcode` varchar(10) DEFAULT NULL,
  `town` varchar(50) DEFAULT NULL,
  `country` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  FULLTEXT KEY `ft_contact_town_postcode` (`town`,`postcode`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_address_bi`
BEFORE INSERT ON `mot2`.`address`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_address_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_address_bu`
BEFORE UPDATE ON `mot2`.`address`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_address_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_address_au`
AFTER UPDATE ON `mot2`.`address`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_address_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`address_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`address_line_1`
        ,`address_line_2`
        ,`address_line_3`
        ,`address_line_4`
        ,`postcode`
        ,`town`
        ,`country`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`address_line_1`
        ,OLD.`address_line_2`
        ,OLD.`address_line_3`
        ,OLD.`address_line_4`
        ,OLD.`postcode`
        ,OLD.`town`
        ,OLD.`country`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_address_bd`
BEFORE DELETE ON `mot2`.`address`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_address_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`address_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`address_line_1`
        ,`address_line_2`
        ,`address_line_3`
        ,`address_line_4`
        ,`postcode`
        ,`town`
        ,`country`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`address_line_1`
        ,OLD.`address_line_2`
        ,OLD.`address_line_3`
        ,OLD.`address_line_4`
        ,OLD.`postcode`
        ,OLD.`town`
        ,OLD.`country`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `address_hist`
--

DROP TABLE IF EXISTS `address_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `address_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `address_line_1` varchar(50) DEFAULT NULL,
  `address_line_2` varchar(50) DEFAULT NULL,
  `address_line_3` varchar(50) DEFAULT NULL,
  `address_line_4` varchar(50) DEFAULT NULL,
  `postcode` varchar(10) DEFAULT NULL,
  `town` varchar(50) DEFAULT NULL,
  `country` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_address_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `app_auth_site_evidence_map`
--

DROP TABLE IF EXISTS `app_auth_site_evidence_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_auth_site_evidence_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `app_for_auth_testing_mot_at_site_id` int(10) unsigned NOT NULL,
  `evidence_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_map_application_authorisation_site_evidence_1` (`app_for_auth_testing_mot_at_site_id`),
  KEY `fk_map_application_authorisation_site_evidence_2` (`evidence_id`),
  CONSTRAINT `fk_map_application_authorisation_site_evidence_1` FOREIGN KEY (`app_for_auth_testing_mot_at_site_id`) REFERENCES `app_for_auth_testing_mot_at_site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_map_application_authorisation_site_evidence_2` FOREIGN KEY (`evidence_id`) REFERENCES `evidence` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_auth_site_evidence_map_bi`
BEFORE INSERT ON `mot2`.`app_auth_site_evidence_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_auth_site_evidence_map_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `app_for_auth_for_ae`
--

DROP TABLE IF EXISTS `app_for_auth_for_ae`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_for_auth_for_ae` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `application_id` int(10) unsigned NOT NULL,
  `auth_for_ae_id` int(10) unsigned NOT NULL,
  `principle_person_id` int(10) unsigned NOT NULL COMMENT 'Principle Person at time of authorisation',
  `designated_manager_person_id` int(10) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_app_for_auth_for_ae_1` (`application_id`),
  KEY `fk_app_for_auth_for_ae_aedm` (`designated_manager_person_id`),
  KEY `fk_app_for_auth_for_ae_aep` (`principle_person_id`),
  KEY `fk_app_for_auth_for_ae_auth` (`auth_for_ae_id`),
  KEY `fk_app_for_auth_for_ae_status` (`status_id`),
  CONSTRAINT `fk_app_for_auth_for_ae_1` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_for_ae_aedm` FOREIGN KEY (`designated_manager_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_for_ae_aep` FOREIGN KEY (`principle_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_for_ae_auth` FOREIGN KEY (`auth_for_ae_id`) REFERENCES `auth_for_ae` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_for_ae_status` FOREIGN KEY (`status_id`) REFERENCES `app_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Applications for an organisation wanting to become an Authorised Examiner';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_for_auth_for_ae_bi`
BEFORE INSERT ON `mot2`.`app_for_auth_for_ae`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_for_auth_for_ae_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `app_for_auth_testing_mot`
--

DROP TABLE IF EXISTS `app_for_auth_testing_mot`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_for_auth_testing_mot` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `application_id` int(10) unsigned NOT NULL,
  `authorisation_for_testing_mot_id` int(10) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_app_for_auth_testing_mot_app` (`application_id`),
  KEY `fk_app_for_auth_testing_mot_auth` (`authorisation_for_testing_mot_id`),
  KEY `fk_app_for_auth_testing_mot_status` (`status_id`),
  CONSTRAINT `fk_app_for_auth_testing_mot_app` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_testing_mot_auth` FOREIGN KEY (`authorisation_for_testing_mot_id`) REFERENCES `auth_for_testing_mot` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_testing_mot_status` FOREIGN KEY (`status_id`) REFERENCES `app_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_for_auth_testing_mot_bi`
BEFORE INSERT ON `mot2`.`app_for_auth_testing_mot`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_for_auth_testing_mot_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `app_for_auth_testing_mot_at_site`
--

DROP TABLE IF EXISTS `app_for_auth_testing_mot_at_site`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_for_auth_testing_mot_at_site` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `application_id` int(10) unsigned DEFAULT NULL COMMENT 'MOT1 data may not be able to map back to application for first stage migration',
  `site_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_app_for_auth_testing_mot_at_site_1` (`application_id`),
  KEY `fk_app_for_auth_testing_mot_at_site_3` (`status_id`),
  CONSTRAINT `fk_app_for_auth_testing_mot_at_site_1` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_for_auth_testing_mot_at_site_3` FOREIGN KEY (`status_id`) REFERENCES `app_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_for_auth_testing_mot_at_site_bi`
BEFORE INSERT ON `mot2`.`app_for_auth_testing_mot_at_site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_for_auth_testing_mot_at_site_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `app_status`
--

DROP TABLE IF EXISTS `app_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_app_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Status of an appplication in the system (APPLIED, APPROVED IN PRINCIPLE, APPROVED, REFERRED, REJECTED)';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_status_bi`
BEFORE INSERT ON `mot2`.`app_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_status_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `app_to_auth_testing_mot_at_site_map`
--

DROP TABLE IF EXISTS `app_to_auth_testing_mot_at_site_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `app_to_auth_testing_mot_at_site_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `app_for_auth_testing_mot_at_site_id` int(10) unsigned NOT NULL,
  `authorisation_testing_mot_at_site_id` int(10) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_app_to_auth_testing_mot_at_site_map_afatmas` (`app_for_auth_testing_mot_at_site_id`),
  KEY `fk_app_to_auth_testing_mot_at_site_map_atmas` (`authorisation_testing_mot_at_site_id`),
  KEY `fk_app_to_auth_testing_mot_at_site_map_status` (`status_id`),
  CONSTRAINT `fk_app_to_auth_testing_mot_at_site_map_afatmas` FOREIGN KEY (`app_for_auth_testing_mot_at_site_id`) REFERENCES `app_for_auth_testing_mot_at_site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_to_auth_testing_mot_at_site_map_atmas` FOREIGN KEY (`authorisation_testing_mot_at_site_id`) REFERENCES `auth_for_testing_mot_at_site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_app_to_auth_testing_mot_at_site_map_status` FOREIGN KEY (`status_id`) REFERENCES `app_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_app_to_auth_testing_mot_at_site_map_bi`
BEFORE INSERT ON `mot2`.`app_to_auth_testing_mot_at_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_app_to_auth_testing_mot_at_site_map_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `application`
--

DROP TABLE IF EXISTS `application`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `application` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `application_reference` varchar(15) NOT NULL,
  `person_id` int(10) unsigned NOT NULL COMMENT 'Applying Person',
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `locked_by` int(10) unsigned DEFAULT NULL COMMENT 'Person currently editing record',
  `locked_on` datetime(6) DEFAULT NULL,
  `submitted_on` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_application_app_status` (`status_id`),
  KEY `fk_application_locked_by` (`locked_by`),
  KEY `fk_application_person` (`person_id`),
  CONSTRAINT `fk_application_app_status` FOREIGN KEY (`status_id`) REFERENCES `app_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_application_locked_by` FOREIGN KEY (`locked_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_application_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='An application made by a person for a form of authorisation in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_application_bi`
BEFORE INSERT ON `mot2`.`application`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_application_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `approval_condition_appointment_map`
--

DROP TABLE IF EXISTS `approval_condition_appointment_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `approval_condition_appointment_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_condition_approval_id` int(10) unsigned NOT NULL,
  `condition_appointment_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_site_condition_approval_condition_appointment` (`site_condition_approval_id`,`condition_appointment_id`),
  KEY `fk_enforcement_condition_appointment_lookup_id` (`condition_appointment_id`),
  CONSTRAINT `fk_enforcement_condition_appointment_lookup_id` FOREIGN KEY (`condition_appointment_id`) REFERENCES `enforcement_condition_appointment_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_condition_approval_id` FOREIGN KEY (`site_condition_approval_id`) REFERENCES `site_condition_approval` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_approval_condition_appointment_map_bi`
BEFORE INSERT ON `mot2`.`approval_condition_appointment_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_approval_condition_appointment_map_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `assembly`
--

DROP TABLE IF EXISTS `assembly`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assembly` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(10) CHARACTER SET latin1 NOT NULL,
  `assembly_type_id` smallint(5) unsigned DEFAULT NULL,
  `parent_assembly_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_assembly_code` (`code`),
  KEY `fk_assembly_assembly_type` (`assembly_type_id`),
  KEY `fk_assembly_parent_assembly_id` (`parent_assembly_id`),
  CONSTRAINT `fk_assembly_assembly_type` FOREIGN KEY (`assembly_type_id`) REFERENCES `assembly_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_assembly_parent_assembly_id` FOREIGN KEY (`parent_assembly_id`) REFERENCES `assembly` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='A was of grouping entities in the system i.e. Area, Zone, MEP also Area Offices';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_assembly_bi`
BEFORE INSERT ON `mot2`.`assembly`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_assembly_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `assembly_role_type`
--

DROP TABLE IF EXISTS `assembly_role_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assembly_role_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_assembly_role_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_assembly_role_type_bi`
BEFORE INSERT ON `mot2`.`assembly_role_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_assembly_role_type_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `assembly_type`
--

DROP TABLE IF EXISTS `assembly_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `assembly_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Classification of a assembly (group i.e. Area, MEP etc)';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_assembly_type_bi`
BEFORE INSERT ON `mot2`.`assembly_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_assembly_type_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_ae`
--

DROP TABLE IF EXISTS `auth_for_ae`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_ae` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ae_ref` varchar(12) NOT NULL,
  `organisation_id` int(10) unsigned NOT NULL,
  `ao_site_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT CURRENT_TIMESTAMP(6),
  `valid_from` datetime(6) DEFAULT NULL COMMENT 'Authorisation valid from',
  `expiry_date` datetime(6) DEFAULT NULL COMMENT 'Authorisation expiry date (normally for approval in principle)',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_auth_for_ae_ae_ref` (`ae_ref`),
  KEY `fk_auth_for_ae_ao_site_id` (`ao_site_id`),
  KEY `fk_auth_for_ae_organisation_id` (`organisation_id`),
  KEY `fk_auth_for_ae_status_id` (`status_id`),
  CONSTRAINT `fk_auth_for_ae_ao_site_id` FOREIGN KEY (`ao_site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_ae_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_ae_status_id` FOREIGN KEY (`status_id`) REFERENCES `auth_for_ae_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of the authorisation of an organisation to be an Authorised Examiner';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_bi`
BEFORE INSERT ON `mot2`.`auth_for_ae`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_bu`
BEFORE UPDATE ON `mot2`.`auth_for_ae`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_au`
AFTER UPDATE ON `mot2`.`auth_for_ae`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_ae_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`ae_ref`
        ,`organisation_id`
        ,`ao_site_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`ae_ref`
        ,OLD.`organisation_id`
        ,OLD.`ao_site_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_bd`
BEFORE DELETE ON `mot2`.`auth_for_ae`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_ae_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`ae_ref`
        ,`organisation_id`
        ,`ao_site_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`ae_ref`
        ,OLD.`organisation_id`
        ,OLD.`ao_site_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_ae_hist`
--

DROP TABLE IF EXISTS `auth_for_ae_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_ae_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `ae_ref` varchar(12) DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `ao_site_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_auth_for_ae_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `auth_for_ae_person_as_principal_map`
--

DROP TABLE IF EXISTS `auth_for_ae_person_as_principal_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_ae_person_as_principal_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `auth_for_ae_id` int(11) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_auth_for_ae_person_map_authorised_examiner` (`auth_for_ae_id`),
  KEY `fk_auth_for_ae_person_map_person_id` (`person_id`),
  CONSTRAINT `fk_auth_for_ae_person_map_authorised_examiner` FOREIGN KEY (`auth_for_ae_id`) REFERENCES `auth_for_ae` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_ae_person_map_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_person_as_principal_map_bi`
BEFORE INSERT ON `mot2`.`auth_for_ae_person_as_principal_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_person_as_principal_map_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_person_as_principal_map_bu`
BEFORE UPDATE ON `mot2`.`auth_for_ae_person_as_principal_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_person_as_principal_map_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_person_as_principal_map_au`
AFTER UPDATE ON `mot2`.`auth_for_ae_person_as_principal_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_person_as_principal_map_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_ae_person_as_principal_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`auth_for_ae_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`auth_for_ae_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_person_as_principal_map_bd`
BEFORE DELETE ON `mot2`.`auth_for_ae_person_as_principal_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_person_as_principal_map_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_ae_person_as_principal_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`auth_for_ae_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`auth_for_ae_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_ae_person_as_principal_map_hist`
--

DROP TABLE IF EXISTS `auth_for_ae_person_as_principal_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_ae_person_as_principal_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `auth_for_ae_id` int(11) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_auth_for_ae_person_as_principal_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `auth_for_ae_status`
--

DROP TABLE IF EXISTS `auth_for_ae_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_ae_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_auth_for_ae_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation for the status of an authorisation for an organisation to be an Authorised Examiner.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_ae_status_bi`
BEFORE INSERT ON `mot2`.`auth_for_ae_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_ae_status_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_testing_mot`
--

DROP TABLE IF EXISTS `auth_for_testing_mot`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT CURRENT_TIMESTAMP(6),
  `valid_from` datetime(6) DEFAULT NULL COMMENT 'Authorisation valid from',
  `expiry_date` datetime(6) DEFAULT NULL COMMENT 'Authorisation expiry date',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `person_id` (`person_id`,`vehicle_class_id`),
  KEY `fk_auth_for_testing_mot_status_id` (`status_id`),
  KEY `fk_auth_for_testing_mot_vehicle_class_id` (`vehicle_class_id`),
  CONSTRAINT `fk_auth_for_testing_mot_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_testing_mot_status_id` FOREIGN KEY (`status_id`) REFERENCES `auth_for_testing_mot_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_testing_mot_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record for the authorisation of a person to conduct an MOT on a particular vehicle class.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_bi`
BEFORE INSERT ON `mot2`.`auth_for_testing_mot`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_bu`
BEFORE UPDATE ON `mot2`.`auth_for_testing_mot`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_au`
AFTER UPDATE ON `mot2`.`auth_for_testing_mot`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_testing_mot_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_class_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_class_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_bd`
BEFORE DELETE ON `mot2`.`auth_for_testing_mot`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_testing_mot_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_class_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_class_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_testing_mot_at_site`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_at_site`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_at_site` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT CURRENT_TIMESTAMP(6),
  `valid_from` datetime(6) DEFAULT NULL COMMENT 'Authorisation valid from',
  `expiry_date` datetime(6) DEFAULT NULL COMMENT 'Authorisation expiry date ',
  `fuel_type_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Currently unused, pending decision on whether is connected to vehicle type',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_auth_for_testing_mot_at_site_auth_status_id` (`status_id`),
  KEY `fk_auth_for_testing_mot_at_site_site_id` (`site_id`),
  KEY `fk_auth_site_vehicle_class_id` (`vehicle_class_id`),
  CONSTRAINT `fk_auth_for_testing_mot_at_site_auth_status_id` FOREIGN KEY (`status_id`) REFERENCES `auth_for_testing_mot_at_site_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_testing_mot_at_site_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_site_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of the authorisation for a site to conduct an MOT';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_at_site_bi`
BEFORE INSERT ON `mot2`.`auth_for_testing_mot_at_site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_at_site_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_at_site_bu`
BEFORE UPDATE ON `mot2`.`auth_for_testing_mot_at_site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_at_site_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_at_site_au`
AFTER UPDATE ON `mot2`.`auth_for_testing_mot_at_site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_at_site_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_testing_mot_at_site_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`vehicle_class_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`fuel_type_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`vehicle_class_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`fuel_type_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_at_site_bd`
BEFORE DELETE ON `mot2`.`auth_for_testing_mot_at_site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_at_site_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`auth_for_testing_mot_at_site_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`vehicle_class_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`fuel_type_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`vehicle_class_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`fuel_type_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_testing_mot_at_site_hist`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_at_site_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_at_site_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `vehicle_class_id` smallint(5) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `fuel_type_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_auth_for_testing_mot_at_site_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `auth_for_testing_mot_at_site_status`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_at_site_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_at_site_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_auth_for_testing_mot_at_site_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation for the status of an authorisation for a site to conduct an MOT.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_at_site_status_bi`
BEFORE INSERT ON `mot2`.`auth_for_testing_mot_at_site_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_at_site_status_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_testing_mot_hist`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vehicle_class_id` smallint(5) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_auth_for_testing_mot_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `auth_for_testing_mot_role_map`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `auth_status_id` smallint(5) unsigned NOT NULL,
  `role_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_auth_for_testing_mot_role_map_auth_for_testing_mot_status_id` (`auth_status_id`),
  KEY `fk_auth_for_testing_mot_role_map_role_id` (`role_id`),
  KEY `fk_auth_for_testing_mot_role_map_vehicle_class_id` (`vehicle_class_id`),
  CONSTRAINT `fk_auth_for_testing_mot_role_map_auth_for_testing_mot_status_id` FOREIGN KEY (`auth_status_id`) REFERENCES `auth_for_testing_mot_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_testing_mot_role_map_role_id` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_auth_for_testing_mot_role_map_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_role_map_bi`
BEFORE INSERT ON `mot2`.`auth_for_testing_mot_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_role_map_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_for_testing_mot_status`
--

DROP TABLE IF EXISTS `auth_for_testing_mot_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_for_testing_mot_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_auth_for_testing_mot_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation for the status of an authorisation for a person to conduct an MOT.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_for_testing_mot_status_bi`
BEFORE INSERT ON `mot2`.`auth_for_testing_mot_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_for_testing_mot_status_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `auth_status`
--

DROP TABLE IF EXISTS `auth_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `auth_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_auth_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation for the status of an authorisation for a person to conduct an MOT.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_auth_status_bi`
BEFORE INSERT ON `mot2`.`auth_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_auth_status_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `authorised_examiner_principal`
--

DROP TABLE IF EXISTS `authorised_examiner_principal`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `authorised_examiner_principal` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `auth_for_ae_id` int(10) unsigned NOT NULL,
  `contact_detail_id` int(10) unsigned NOT NULL,
  `first_name` varchar(45) DEFAULT NULL,
  `middle_name` varchar(45) DEFAULT NULL,
  `family_name` varchar(45) NOT NULL,
  `date_of_birth` date DEFAULT NULL,
  `original_person_id` int(10) unsigned DEFAULT NULL COMMENT 'This relates to person row that contained the original data',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_aep_auth_for_ae_id_auth_for_ae_id` (`auth_for_ae_id`),
  KEY `fk_aep_contact_detail_id_contact_detail_id` (`contact_detail_id`),
  CONSTRAINT `fk_aep_auth_for_ae_id_auth_for_ae_id` FOREIGN KEY (`auth_for_ae_id`) REFERENCES `auth_for_ae` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_aep_contact_detail_id_contact_detail_id` FOREIGN KEY (`contact_detail_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_authorised_examiner_principal_bi`
BEFORE INSERT ON `mot2`.`authorised_examiner_principal`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_authorised_examiner_principal_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `body_type`
--

DROP TABLE IF EXISTS `body_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `body_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_body_type_code` (`code`),
  UNIQUE KEY `uk_body_type_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Will be removed - normalisation of unused data';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_body_type_bi`
BEFORE INSERT ON `mot2`.`body_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_body_type_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_body_type_bu`
BEFORE UPDATE ON `mot2`.`body_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_body_type_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_body_type_au`
AFTER UPDATE ON `mot2`.`body_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_body_type_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`body_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_body_type_bd`
BEFORE DELETE ON `mot2`.`body_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_body_type_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`body_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `body_type_hist`
--

DROP TABLE IF EXISTS `body_type_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `body_type_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_body_type_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `brake_test_result_class_1_2`
--

DROP TABLE IF EXISTS `brake_test_result_class_1_2`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_class_1_2` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `brake_test_type_id` smallint(5) unsigned NOT NULL,
  `vehicle_weight_front` smallint(6) unsigned DEFAULT NULL,
  `vehicle_weight_rear` smallint(6) unsigned DEFAULT NULL,
  `rider_weight` smallint(6) unsigned DEFAULT NULL,
  `sidecar_weight` smallint(6) unsigned DEFAULT NULL,
  `control_1_effort_front` int(11) DEFAULT NULL,
  `control_1_effort_rear` int(11) DEFAULT NULL,
  `control_1_effort_sidecar` int(11) DEFAULT NULL,
  `control_2_effort_front` int(11) DEFAULT NULL,
  `control_2_effort_rear` int(11) DEFAULT NULL,
  `control_2_effort_sidecar` int(11) DEFAULT NULL,
  `control_1_lock_front` tinyint(4) DEFAULT NULL,
  `control_1_lock_rear` tinyint(4) DEFAULT NULL,
  `control_2_lock_front` tinyint(4) DEFAULT NULL,
  `control_2_lock_rear` tinyint(4) DEFAULT NULL,
  `control_1_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `control_2_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `gradient_control_1_below_minimum` tinyint(4) DEFAULT NULL,
  `gradient_control_2_below_minimum` tinyint(4) DEFAULT NULL,
  `control_1_efficiency_pass` tinyint(4) NOT NULL,
  `control_2_efficiency_pass` tinyint(4) DEFAULT NULL,
  `general_pass` tinyint(4) NOT NULL,
  `is_latest` tinyint(4) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_brake_test_result_class_1_2_brake_test_type_id` (`brake_test_type_id`),
  KEY `fk_brake_test_result_class_1_2_mot_test_id` (`mot_test_id`),
  KEY `ix_brake_test_result_class_1_2_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_brake_test_result_class_1_2_brake_test_type_id` FOREIGN KEY (`brake_test_type_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of brake test inputs and results for vehicle classes 1 and 2';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_1_2_bi`
BEFORE INSERT ON `mot2`.`brake_test_result_class_1_2`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_1_2_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_1_2_bu`
BEFORE UPDATE ON `mot2`.`brake_test_result_class_1_2`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_1_2_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_1_2_au`
AFTER UPDATE ON `mot2`.`brake_test_result_class_1_2`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_1_2_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_class_1_2_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`brake_test_type_id`
        ,`vehicle_weight_front`
        ,`vehicle_weight_rear`
        ,`rider_weight`
        ,`sidecar_weight`
        ,`control_1_effort_front`
        ,`control_1_effort_rear`
        ,`control_1_effort_sidecar`
        ,`control_2_effort_front`
        ,`control_2_effort_rear`
        ,`control_2_effort_sidecar`
        ,`control_1_lock_front`
        ,`control_1_lock_rear`
        ,`control_2_lock_front`
        ,`control_2_lock_rear`
        ,`control_1_brake_efficiency`
        ,`control_2_brake_efficiency`
        ,`gradient_control_1_below_minimum`
        ,`gradient_control_2_below_minimum`
        ,`control_1_efficiency_pass`
        ,`control_2_efficiency_pass`
        ,`general_pass`
        ,`is_latest`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`brake_test_type_id`
        ,OLD.`vehicle_weight_front`
        ,OLD.`vehicle_weight_rear`
        ,OLD.`rider_weight`
        ,OLD.`sidecar_weight`
        ,OLD.`control_1_effort_front`
        ,OLD.`control_1_effort_rear`
        ,OLD.`control_1_effort_sidecar`
        ,OLD.`control_2_effort_front`
        ,OLD.`control_2_effort_rear`
        ,OLD.`control_2_effort_sidecar`
        ,OLD.`control_1_lock_front`
        ,OLD.`control_1_lock_rear`
        ,OLD.`control_2_lock_front`
        ,OLD.`control_2_lock_rear`
        ,OLD.`control_1_brake_efficiency`
        ,OLD.`control_2_brake_efficiency`
        ,OLD.`gradient_control_1_below_minimum`
        ,OLD.`gradient_control_2_below_minimum`
        ,OLD.`control_1_efficiency_pass`
        ,OLD.`control_2_efficiency_pass`
        ,OLD.`general_pass`
        ,OLD.`is_latest`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_1_2_bd`
BEFORE DELETE ON `mot2`.`brake_test_result_class_1_2`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_1_2_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_class_1_2_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`brake_test_type_id`
        ,`vehicle_weight_front`
        ,`vehicle_weight_rear`
        ,`rider_weight`
        ,`sidecar_weight`
        ,`control_1_effort_front`
        ,`control_1_effort_rear`
        ,`control_1_effort_sidecar`
        ,`control_2_effort_front`
        ,`control_2_effort_rear`
        ,`control_2_effort_sidecar`
        ,`control_1_lock_front`
        ,`control_1_lock_rear`
        ,`control_2_lock_front`
        ,`control_2_lock_rear`
        ,`control_1_brake_efficiency`
        ,`control_2_brake_efficiency`
        ,`gradient_control_1_below_minimum`
        ,`gradient_control_2_below_minimum`
        ,`control_1_efficiency_pass`
        ,`control_2_efficiency_pass`
        ,`general_pass`
        ,`is_latest`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`brake_test_type_id`
        ,OLD.`vehicle_weight_front`
        ,OLD.`vehicle_weight_rear`
        ,OLD.`rider_weight`
        ,OLD.`sidecar_weight`
        ,OLD.`control_1_effort_front`
        ,OLD.`control_1_effort_rear`
        ,OLD.`control_1_effort_sidecar`
        ,OLD.`control_2_effort_front`
        ,OLD.`control_2_effort_rear`
        ,OLD.`control_2_effort_sidecar`
        ,OLD.`control_1_lock_front`
        ,OLD.`control_1_lock_rear`
        ,OLD.`control_2_lock_front`
        ,OLD.`control_2_lock_rear`
        ,OLD.`control_1_brake_efficiency`
        ,OLD.`control_2_brake_efficiency`
        ,OLD.`gradient_control_1_below_minimum`
        ,OLD.`gradient_control_2_below_minimum`
        ,OLD.`control_1_efficiency_pass`
        ,OLD.`control_2_efficiency_pass`
        ,OLD.`general_pass`
        ,OLD.`is_latest`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `brake_test_result_class_1_2_hist`
--

DROP TABLE IF EXISTS `brake_test_result_class_1_2_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_class_1_2_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `brake_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_weight_front` smallint(6) unsigned DEFAULT NULL,
  `vehicle_weight_rear` smallint(6) unsigned DEFAULT NULL,
  `rider_weight` smallint(6) unsigned DEFAULT NULL,
  `sidecar_weight` smallint(6) unsigned DEFAULT NULL,
  `control_1_effort_front` int(11) DEFAULT NULL,
  `control_1_effort_rear` int(11) DEFAULT NULL,
  `control_1_effort_sidecar` int(11) DEFAULT NULL,
  `control_2_effort_front` int(11) DEFAULT NULL,
  `control_2_effort_rear` int(11) DEFAULT NULL,
  `control_2_effort_sidecar` int(11) DEFAULT NULL,
  `control_1_lock_front` tinyint(4) DEFAULT NULL,
  `control_1_lock_rear` tinyint(4) DEFAULT NULL,
  `control_2_lock_front` tinyint(4) DEFAULT NULL,
  `control_2_lock_rear` tinyint(4) DEFAULT NULL,
  `control_1_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `control_2_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `gradient_control_1_below_minimum` tinyint(4) DEFAULT NULL,
  `gradient_control_2_below_minimum` tinyint(4) DEFAULT NULL,
  `control_1_efficiency_pass` tinyint(4) DEFAULT NULL,
  `control_2_efficiency_pass` tinyint(4) DEFAULT NULL,
  `general_pass` tinyint(4) DEFAULT NULL,
  `is_latest` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_brake_test_result_class_1_2_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `brake_test_result_class_3_and_above`
--

DROP TABLE IF EXISTS `brake_test_result_class_3_and_above`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_class_3_and_above` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `service_brake_1_test_type_id` smallint(5) unsigned NOT NULL,
  `service_brake_2_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `parking_brake_test_type_id` smallint(5) unsigned NOT NULL,
  `service_brake_total_axles_applied_to` tinyint(4) DEFAULT NULL,
  `parking_brake_total_axles_applied_to` tinyint(4) DEFAULT NULL,
  `service_brake_1_data_id` bigint(20) unsigned DEFAULT NULL,
  `service_brake_2_data_id` bigint(20) unsigned DEFAULT NULL,
  `parking_brake_effort_nearside` int(11) DEFAULT NULL,
  `parking_brake_effort_offside` int(11) DEFAULT NULL,
  `parking_brake_effort_secondary_nearside` int(11) DEFAULT NULL,
  `parking_brake_effort_secondary_offside` int(11) DEFAULT NULL,
  `parking_brake_effort_single` int(11) DEFAULT NULL,
  `parking_brake_lock_nearside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_offside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_secondary_nearside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_secondary_offside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_single` tinyint(4) DEFAULT NULL,
  `service_brake_is_single_line` tinyint(4) NOT NULL,
  `is_single_in_front` tinyint(4) unsigned DEFAULT NULL,
  `is_commercial_vehicle` tinyint(4) DEFAULT NULL,
  `vehicle_weight` int(10) unsigned DEFAULT NULL COMMENT 'in Kg',
  `weight_type_id` smallint(5) unsigned DEFAULT NULL,
  `weight_is_unladen` tinyint(4) DEFAULT NULL,
  `service_brake_1_efficiency` smallint(5) unsigned DEFAULT NULL,
  `service_brake_2_efficiency` smallint(5) unsigned DEFAULT NULL,
  `parking_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `service_brake_1_efficiency_pass` tinyint(4) DEFAULT NULL,
  `service_brake_2_efficiency_pass` tinyint(4) DEFAULT NULL,
  `parking_brake_efficiency_pass` tinyint(4) DEFAULT NULL,
  `parking_brake_imbalance` tinyint(4) DEFAULT NULL,
  `parking_brake_secondary_imbalance` tinyint(4) DEFAULT NULL,
  `parking_brake_imbalance_pass` tinyint(4) DEFAULT NULL,
  `general_pass` tinyint(4) NOT NULL,
  `is_latest` tinyint(4) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_brake_test_result_class_3_above_parking_brake_test_type_id` (`parking_brake_test_type_id`),
  KEY `fk_brake_test_result_class_3_above_service_brake_1_test_type_id` (`service_brake_1_test_type_id`),
  KEY `fk_brake_test_result_class_3_above_service_brake_2_test_type_id` (`service_brake_2_test_type_id`),
  KEY `fk_brake_test_result_class_3_and_above_mot_test_id` (`mot_test_id`),
  KEY `fk_brake_test_result_class_3_and_above_weight_type_id` (`weight_type_id`),
  KEY `fk_brake_test_result_service_brake_data_service_brake_1` (`service_brake_1_data_id`),
  KEY `fk_brake_test_result_service_brake_data_service_brake_2` (`service_brake_2_data_id`),
  KEY `ix_brake_test_result_class_3_and_above_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_brake_test_result_class_3_above_parking_brake_test_type_id` FOREIGN KEY (`parking_brake_test_type_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_brake_test_result_class_3_above_service_brake_1_test_type_id` FOREIGN KEY (`service_brake_1_test_type_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_brake_test_result_class_3_above_service_brake_2_test_type_id` FOREIGN KEY (`service_brake_2_test_type_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_brake_test_result_class_3_and_above_weight_type_id` FOREIGN KEY (`weight_type_id`) REFERENCES `weight_source_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_brake_test_result_service_brake_data_service_brake_1` FOREIGN KEY (`service_brake_1_data_id`) REFERENCES `brake_test_result_service_brake_data` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_brake_test_result_service_brake_data_service_brake_2` FOREIGN KEY (`service_brake_2_data_id`) REFERENCES `brake_test_result_service_brake_data` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of brake test inputs and results for vehicle classes 3 to 7';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_3_and_above_bi`
BEFORE INSERT ON `mot2`.`brake_test_result_class_3_and_above`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_3_and_above_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_3_and_above_bu`
BEFORE UPDATE ON `mot2`.`brake_test_result_class_3_and_above`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_3_and_above_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_3_and_above_au`
AFTER UPDATE ON `mot2`.`brake_test_result_class_3_and_above`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_3_and_above_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_class_3_and_above_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`service_brake_1_test_type_id`
        ,`service_brake_2_test_type_id`
        ,`parking_brake_test_type_id`
        ,`service_brake_total_axles_applied_to`
        ,`parking_brake_total_axles_applied_to`
        ,`service_brake_1_data_id`
        ,`service_brake_2_data_id`
        ,`parking_brake_effort_nearside`
        ,`parking_brake_effort_offside`
        ,`parking_brake_effort_secondary_nearside`
        ,`parking_brake_effort_secondary_offside`
        ,`parking_brake_effort_single`
        ,`parking_brake_lock_nearside`
        ,`parking_brake_lock_offside`
        ,`parking_brake_lock_secondary_nearside`
        ,`parking_brake_lock_secondary_offside`
        ,`parking_brake_lock_single`
        ,`service_brake_is_single_line`
        ,`is_single_in_front`
        ,`is_commercial_vehicle`
        ,`vehicle_weight`
        ,`weight_type_id`
        ,`weight_is_unladen`
        ,`service_brake_1_efficiency`
        ,`service_brake_2_efficiency`
        ,`parking_brake_efficiency`
        ,`service_brake_1_efficiency_pass`
        ,`service_brake_2_efficiency_pass`
        ,`parking_brake_efficiency_pass`
        ,`parking_brake_imbalance`
        ,`parking_brake_secondary_imbalance`
        ,`parking_brake_imbalance_pass`
        ,`general_pass`
        ,`is_latest`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`service_brake_1_test_type_id`
        ,OLD.`service_brake_2_test_type_id`
        ,OLD.`parking_brake_test_type_id`
        ,OLD.`service_brake_total_axles_applied_to`
        ,OLD.`parking_brake_total_axles_applied_to`
        ,OLD.`service_brake_1_data_id`
        ,OLD.`service_brake_2_data_id`
        ,OLD.`parking_brake_effort_nearside`
        ,OLD.`parking_brake_effort_offside`
        ,OLD.`parking_brake_effort_secondary_nearside`
        ,OLD.`parking_brake_effort_secondary_offside`
        ,OLD.`parking_brake_effort_single`
        ,OLD.`parking_brake_lock_nearside`
        ,OLD.`parking_brake_lock_offside`
        ,OLD.`parking_brake_lock_secondary_nearside`
        ,OLD.`parking_brake_lock_secondary_offside`
        ,OLD.`parking_brake_lock_single`
        ,OLD.`service_brake_is_single_line`
        ,OLD.`is_single_in_front`
        ,OLD.`is_commercial_vehicle`
        ,OLD.`vehicle_weight`
        ,OLD.`weight_type_id`
        ,OLD.`weight_is_unladen`
        ,OLD.`service_brake_1_efficiency`
        ,OLD.`service_brake_2_efficiency`
        ,OLD.`parking_brake_efficiency`
        ,OLD.`service_brake_1_efficiency_pass`
        ,OLD.`service_brake_2_efficiency_pass`
        ,OLD.`parking_brake_efficiency_pass`
        ,OLD.`parking_brake_imbalance`
        ,OLD.`parking_brake_secondary_imbalance`
        ,OLD.`parking_brake_imbalance_pass`
        ,OLD.`general_pass`
        ,OLD.`is_latest`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_class_3_and_above_bd`
BEFORE DELETE ON `mot2`.`brake_test_result_class_3_and_above`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_class_3_and_above_bd Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_class_3_and_above_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`service_brake_1_test_type_id`
        ,`service_brake_2_test_type_id`
        ,`parking_brake_test_type_id`
        ,`service_brake_total_axles_applied_to`
        ,`parking_brake_total_axles_applied_to`
        ,`service_brake_1_data_id`
        ,`service_brake_2_data_id`
        ,`parking_brake_effort_nearside`
        ,`parking_brake_effort_offside`
        ,`parking_brake_effort_secondary_nearside`
        ,`parking_brake_effort_secondary_offside`
        ,`parking_brake_effort_single`
        ,`parking_brake_lock_nearside`
        ,`parking_brake_lock_offside`
        ,`parking_brake_lock_secondary_nearside`
        ,`parking_brake_lock_secondary_offside`
        ,`parking_brake_lock_single`
        ,`service_brake_is_single_line`
        ,`is_single_in_front`
        ,`is_commercial_vehicle`
        ,`vehicle_weight`
        ,`weight_type_id`
        ,`weight_is_unladen`
        ,`service_brake_1_efficiency`
        ,`service_brake_2_efficiency`
        ,`parking_brake_efficiency`
        ,`service_brake_1_efficiency_pass`
        ,`service_brake_2_efficiency_pass`
        ,`parking_brake_efficiency_pass`
        ,`parking_brake_imbalance`
        ,`parking_brake_secondary_imbalance`
        ,`parking_brake_imbalance_pass`
        ,`general_pass`
        ,`is_latest`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`service_brake_1_test_type_id`
        ,OLD.`service_brake_2_test_type_id`
        ,OLD.`parking_brake_test_type_id`
        ,OLD.`service_brake_total_axles_applied_to`
        ,OLD.`parking_brake_total_axles_applied_to`
        ,OLD.`service_brake_1_data_id`
        ,OLD.`service_brake_2_data_id`
        ,OLD.`parking_brake_effort_nearside`
        ,OLD.`parking_brake_effort_offside`
        ,OLD.`parking_brake_effort_secondary_nearside`
        ,OLD.`parking_brake_effort_secondary_offside`
        ,OLD.`parking_brake_effort_single`
        ,OLD.`parking_brake_lock_nearside`
        ,OLD.`parking_brake_lock_offside`
        ,OLD.`parking_brake_lock_secondary_nearside`
        ,OLD.`parking_brake_lock_secondary_offside`
        ,OLD.`parking_brake_lock_single`
        ,OLD.`service_brake_is_single_line`
        ,OLD.`is_single_in_front`
        ,OLD.`is_commercial_vehicle`
        ,OLD.`vehicle_weight`
        ,OLD.`weight_type_id`
        ,OLD.`weight_is_unladen`
        ,OLD.`service_brake_1_efficiency`
        ,OLD.`service_brake_2_efficiency`
        ,OLD.`parking_brake_efficiency`
        ,OLD.`service_brake_1_efficiency_pass`
        ,OLD.`service_brake_2_efficiency_pass`
        ,OLD.`parking_brake_efficiency_pass`
        ,OLD.`parking_brake_imbalance`
        ,OLD.`parking_brake_secondary_imbalance`
        ,OLD.`parking_brake_imbalance_pass`
        ,OLD.`general_pass`
        ,OLD.`is_latest`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `brake_test_result_class_3_and_above_hist`
--

DROP TABLE IF EXISTS `brake_test_result_class_3_and_above_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_class_3_and_above_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `service_brake_1_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `service_brake_2_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `parking_brake_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `service_brake_total_axles_applied_to` tinyint(4) DEFAULT NULL,
  `parking_brake_total_axles_applied_to` tinyint(4) DEFAULT NULL,
  `service_brake_1_data_id` bigint(20) unsigned DEFAULT NULL,
  `service_brake_2_data_id` bigint(20) unsigned DEFAULT NULL,
  `parking_brake_effort_nearside` int(11) DEFAULT NULL,
  `parking_brake_effort_offside` int(11) DEFAULT NULL,
  `parking_brake_effort_secondary_nearside` int(11) DEFAULT NULL,
  `parking_brake_effort_secondary_offside` int(11) DEFAULT NULL,
  `parking_brake_effort_single` int(11) DEFAULT NULL,
  `parking_brake_lock_nearside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_offside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_secondary_nearside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_secondary_offside` tinyint(4) DEFAULT NULL,
  `parking_brake_lock_single` tinyint(4) DEFAULT NULL,
  `service_brake_is_single_line` tinyint(4) DEFAULT NULL,
  `is_single_in_front` tinyint(4) unsigned DEFAULT NULL,
  `is_commercial_vehicle` tinyint(4) DEFAULT NULL,
  `vehicle_weight` int(10) unsigned DEFAULT NULL,
  `weight_type_id` smallint(5) unsigned DEFAULT NULL,
  `weight_is_unladen` tinyint(4) DEFAULT NULL,
  `service_brake_1_efficiency` smallint(5) unsigned DEFAULT NULL,
  `service_brake_2_efficiency` smallint(5) unsigned DEFAULT NULL,
  `parking_brake_efficiency` smallint(5) unsigned DEFAULT NULL,
  `service_brake_1_efficiency_pass` tinyint(4) DEFAULT NULL,
  `service_brake_2_efficiency_pass` tinyint(4) DEFAULT NULL,
  `parking_brake_efficiency_pass` tinyint(4) DEFAULT NULL,
  `parking_brake_imbalance` tinyint(4) DEFAULT NULL,
  `parking_brake_secondary_imbalance` tinyint(4) DEFAULT NULL,
  `parking_brake_imbalance_pass` tinyint(4) DEFAULT NULL,
  `general_pass` tinyint(4) DEFAULT NULL,
  `is_latest` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_brake_test_result_class_3_and_above_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `brake_test_result_service_brake_data`
--

DROP TABLE IF EXISTS `brake_test_result_service_brake_data`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_service_brake_data` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `effort_nearside_axle1` int(11) DEFAULT NULL,
  `effort_offside_axle1` int(11) DEFAULT NULL,
  `effort_nearside_axle2` int(11) DEFAULT NULL,
  `effort_offside_axle2` int(11) DEFAULT NULL,
  `effort_nearside_axle3` int(11) DEFAULT NULL,
  `effort_offside_axle3` int(11) DEFAULT NULL,
  `effort_single` int(11) DEFAULT NULL,
  `lock_nearside_axle1` tinyint(4) DEFAULT NULL,
  `lock_offside_axle1` tinyint(4) DEFAULT NULL,
  `lock_nearside_axle2` tinyint(4) DEFAULT NULL,
  `lock_offside_axle2` tinyint(4) DEFAULT NULL,
  `lock_nearside_axle3` tinyint(4) DEFAULT NULL,
  `lock_offside_axle3` tinyint(4) DEFAULT NULL,
  `lock_single` tinyint(4) DEFAULT NULL,
  `imbalance_axle1` tinyint(4) DEFAULT NULL,
  `imbalance_axle2` tinyint(4) DEFAULT NULL,
  `imbalance_axle3` tinyint(4) DEFAULT NULL,
  `imbalance_pass` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of service brake inputs and results';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_service_brake_data_bi`
BEFORE INSERT ON `mot2`.`brake_test_result_service_brake_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_service_brake_data_bi Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_service_brake_data_bu`
BEFORE UPDATE ON `mot2`.`brake_test_result_service_brake_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_service_brake_data_bu Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_service_brake_data_au`
AFTER UPDATE ON `mot2`.`brake_test_result_service_brake_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_service_brake_data_au Generated on 2016-12-12 11:28:58. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_service_brake_data_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`effort_nearside_axle1`
        ,`effort_offside_axle1`
        ,`effort_nearside_axle2`
        ,`effort_offside_axle2`
        ,`effort_nearside_axle3`
        ,`effort_offside_axle3`
        ,`effort_single`
        ,`lock_nearside_axle1`
        ,`lock_offside_axle1`
        ,`lock_nearside_axle2`
        ,`lock_offside_axle2`
        ,`lock_nearside_axle3`
        ,`lock_offside_axle3`
        ,`lock_single`
        ,`imbalance_axle1`
        ,`imbalance_axle2`
        ,`imbalance_axle3`
        ,`imbalance_pass`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`effort_nearside_axle1`
        ,OLD.`effort_offside_axle1`
        ,OLD.`effort_nearside_axle2`
        ,OLD.`effort_offside_axle2`
        ,OLD.`effort_nearside_axle3`
        ,OLD.`effort_offside_axle3`
        ,OLD.`effort_single`
        ,OLD.`lock_nearside_axle1`
        ,OLD.`lock_offside_axle1`
        ,OLD.`lock_nearside_axle2`
        ,OLD.`lock_offside_axle2`
        ,OLD.`lock_nearside_axle3`
        ,OLD.`lock_offside_axle3`
        ,OLD.`lock_single`
        ,OLD.`imbalance_axle1`
        ,OLD.`imbalance_axle2`
        ,OLD.`imbalance_axle3`
        ,OLD.`imbalance_pass`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_result_service_brake_data_bd`
BEFORE DELETE ON `mot2`.`brake_test_result_service_brake_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_result_service_brake_data_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`brake_test_result_service_brake_data_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`effort_nearside_axle1`
        ,`effort_offside_axle1`
        ,`effort_nearside_axle2`
        ,`effort_offside_axle2`
        ,`effort_nearside_axle3`
        ,`effort_offside_axle3`
        ,`effort_single`
        ,`lock_nearside_axle1`
        ,`lock_offside_axle1`
        ,`lock_nearside_axle2`
        ,`lock_offside_axle2`
        ,`lock_nearside_axle3`
        ,`lock_offside_axle3`
        ,`lock_single`
        ,`imbalance_axle1`
        ,`imbalance_axle2`
        ,`imbalance_axle3`
        ,`imbalance_pass`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`effort_nearside_axle1`
        ,OLD.`effort_offside_axle1`
        ,OLD.`effort_nearside_axle2`
        ,OLD.`effort_offside_axle2`
        ,OLD.`effort_nearside_axle3`
        ,OLD.`effort_offside_axle3`
        ,OLD.`effort_single`
        ,OLD.`lock_nearside_axle1`
        ,OLD.`lock_offside_axle1`
        ,OLD.`lock_nearside_axle2`
        ,OLD.`lock_offside_axle2`
        ,OLD.`lock_nearside_axle3`
        ,OLD.`lock_offside_axle3`
        ,OLD.`lock_single`
        ,OLD.`imbalance_axle1`
        ,OLD.`imbalance_axle2`
        ,OLD.`imbalance_axle3`
        ,OLD.`imbalance_pass`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `brake_test_result_service_brake_data_hist`
--

DROP TABLE IF EXISTS `brake_test_result_service_brake_data_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_result_service_brake_data_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `effort_nearside_axle1` int(11) DEFAULT NULL,
  `effort_offside_axle1` int(11) DEFAULT NULL,
  `effort_nearside_axle2` int(11) DEFAULT NULL,
  `effort_offside_axle2` int(11) DEFAULT NULL,
  `effort_nearside_axle3` int(11) DEFAULT NULL,
  `effort_offside_axle3` int(11) DEFAULT NULL,
  `effort_single` int(11) DEFAULT NULL,
  `lock_nearside_axle1` tinyint(4) DEFAULT NULL,
  `lock_offside_axle1` tinyint(4) DEFAULT NULL,
  `lock_nearside_axle2` tinyint(4) DEFAULT NULL,
  `lock_offside_axle2` tinyint(4) DEFAULT NULL,
  `lock_nearside_axle3` tinyint(4) DEFAULT NULL,
  `lock_offside_axle3` tinyint(4) DEFAULT NULL,
  `lock_single` tinyint(4) DEFAULT NULL,
  `imbalance_axle1` tinyint(4) DEFAULT NULL,
  `imbalance_axle2` tinyint(4) DEFAULT NULL,
  `imbalance_axle3` tinyint(4) DEFAULT NULL,
  `imbalance_pass` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_brake_test_result_service_brake_data_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `brake_test_type`
--

DROP TABLE IF EXISTS `brake_test_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `brake_test_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `description` varchar(250) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_brake_test_type_name` (`name`),
  UNIQUE KEY `uk_brake_test_type_code` (`code`),
  UNIQUE KEY `uk_brake_test_type_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of brake test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_brake_test_type_bi`
BEFORE INSERT ON `mot2`.`brake_test_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_brake_test_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `business_role_status`
--

DROP TABLE IF EXISTS `business_role_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `business_role_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Status of a business role in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_business_role_status_bi`
BEFORE INSERT ON `mot2`.`business_role_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_business_role_status_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `business_rule`
--

DROP TABLE IF EXISTS `business_rule`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `business_rule` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `definition` text,
  `business_rule_type_id` smallint(5) unsigned NOT NULL,
  `comparison` varchar(2) DEFAULT NULL,
  `date_value` date DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_rfr_business_rule_rfr_rule_type1` (`business_rule_type_id`),
  CONSTRAINT `fk_rfr_business_rule_rfr_rule_type1` FOREIGN KEY (`business_rule_type_id`) REFERENCES `business_rule_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='These are for filtering the RFR/Category to make them more appropriate for the vehicle';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_business_rule_bi`
BEFORE INSERT ON `mot2`.`business_rule`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_business_rule_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `business_rule_type`
--

DROP TABLE IF EXISTS `business_rule_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `business_rule_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Simple - only filter by class, Parameter - filter by class and first used date, Complex - any other rule';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_business_rule_type_bi`
BEFORE INSERT ON `mot2`.`business_rule_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_business_rule_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `card_payment_token_usage`
--

DROP TABLE IF EXISTS `card_payment_token_usage`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `card_payment_token_usage` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `token` varchar(50) NOT NULL,
  `status` varchar(50) NOT NULL,
  `payment_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_card_payment_token_usage_payment` (`payment_id`),
  CONSTRAINT `fk_card_payment_token_usage_payment` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Duplicate of test_slot_transaction?';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_card_payment_token_usage_bi`
BEFORE INSERT ON `mot2`.`card_payment_token_usage`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_card_payment_token_usage_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `censor_blacklist`
--

DROP TABLE IF EXISTS `censor_blacklist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `censor_blacklist` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `phrase` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `phrase` (`phrase`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='List of blacklisted words which the system can use to filter input to the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_censor_blacklist_bi`
BEFORE INSERT ON `mot2`.`censor_blacklist`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_censor_blacklist_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `certificate_change_different_tester_reason_lookup`
--

DROP TABLE IF EXISTS `certificate_change_different_tester_reason_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_change_different_tester_reason_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `description` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of why a certificate replacement is being performed by a different tester';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_change_different_tester_reason_lookup_bi`
BEFORE INSERT ON `mot2`.`certificate_change_different_tester_reason_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_change_different_tester_reason_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `certificate_replacement`
--

DROP TABLE IF EXISTS `certificate_replacement`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_replacement` (
  `id` bigint(10) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `mot_test_version` int(10) unsigned NOT NULL COMMENT 'version of test to identify record in history table if not current record',
  `different_tester_reason_id` smallint(5) unsigned DEFAULT NULL COMMENT 'TODO: should be NOT NULL according to SDM',
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `certificate_type_id` bigint(20) unsigned DEFAULT NULL,
  `tester_person_id` int(10) unsigned DEFAULT NULL COMMENT 'Person who entered/completed the test/certificate reissue data',
  `reason` text,
  `is_vin_vrm_expiry_changed` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `include_in_mismatch_file` tinyint(4) DEFAULT '0',
  `include_in_passes_file` tinyint(4) DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `certificate_replacement_created_on_is_vin_vrm_expiry_changed_idx` (`created_on`,`is_vin_vrm_expiry_changed`),
  KEY `fk_certificate_replacement_document_id` (`document_id`),
  KEY `fk_certificate_replacement_mot_test_id` (`mot_test_id`),
  KEY `fk_certificate_replacement_person_different_tester_reason_id` (`different_tester_reason_id`),
  KEY `fk_certificate_replacement_person_tester_person_id` (`tester_person_id`),
  KEY `ix_certificate_replacement_certificate_type_id` (`certificate_type_id`),
  KEY `ix_certificate_replacement_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_certificate_replacement_certificate_type` FOREIGN KEY (`certificate_type_id`) REFERENCES `certificate_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_certificate_replacement_document_id` FOREIGN KEY (`document_id`) REFERENCES `jasper_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_certificate_replacement_person_different_tester_reason_id` FOREIGN KEY (`different_tester_reason_id`) REFERENCES `certificate_change_different_tester_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_certificate_replacement_person_tester_person_id` FOREIGN KEY (`tester_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_bi`
BEFORE INSERT ON `mot2`.`certificate_replacement`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_bu`
BEFORE UPDATE ON `mot2`.`certificate_replacement`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_au`
AFTER UPDATE ON `mot2`.`certificate_replacement`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`certificate_replacement_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`mot_test_version`
        ,`different_tester_reason_id`
        ,`document_id`
        ,`certificate_type_id`
        ,`tester_person_id`
        ,`reason`
        ,`is_vin_vrm_expiry_changed`
        ,`include_in_mismatch_file`
        ,`include_in_passes_file`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_version`
        ,OLD.`different_tester_reason_id`
        ,OLD.`document_id`
        ,OLD.`certificate_type_id`
        ,OLD.`tester_person_id`
        ,OLD.`reason`
        ,OLD.`is_vin_vrm_expiry_changed`
        ,OLD.`include_in_mismatch_file`
        ,OLD.`include_in_passes_file`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_bd`
BEFORE DELETE ON `mot2`.`certificate_replacement`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`certificate_replacement_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`mot_test_version`
        ,`different_tester_reason_id`
        ,`document_id`
        ,`certificate_type_id`
        ,`tester_person_id`
        ,`reason`
        ,`is_vin_vrm_expiry_changed`
        ,`include_in_mismatch_file`
        ,`include_in_passes_file`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_version`
        ,OLD.`different_tester_reason_id`
        ,OLD.`document_id`
        ,OLD.`certificate_type_id`
        ,OLD.`tester_person_id`
        ,OLD.`reason`
        ,OLD.`is_vin_vrm_expiry_changed`
        ,OLD.`include_in_mismatch_file`
        ,OLD.`include_in_passes_file`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `certificate_replacement_draft`
--

DROP TABLE IF EXISTS `certificate_replacement_draft`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_replacement_draft` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL COMMENT 'Reference to mot_test_current.id or mot_test_history.id',
  `mot_test_version` int(10) unsigned NOT NULL,
  `vrm` varchar(20) DEFAULT NULL,
  `empty_vrm_reason_id` smallint(5) unsigned DEFAULT NULL,
  `vin` varchar(30) DEFAULT NULL,
  `empty_vin_reason_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_testing_station_id` int(10) unsigned DEFAULT NULL,
  `make_id` int(10) unsigned DEFAULT NULL,
  `make_name` varchar(50) DEFAULT NULL,
  `model_id` int(10) unsigned DEFAULT NULL,
  `model_name` varchar(50) DEFAULT NULL,
  `model_detail_id` int(10) unsigned DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned NOT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned NOT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `different_tester_reason_id` smallint(5) unsigned DEFAULT NULL,
  `replacement_reason` text,
  `is_vin_vrm_expiry_changed` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `include_in_mismatch_file` tinyint(4) DEFAULT '0',
  `include_in_passes_file` tinyint(4) DEFAULT '0',
  `odometer_value` int(10) unsigned DEFAULT NULL COMMENT 'Updated during test so multiple odometer values may exist over test lifetime',
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `is_deleted` tinyint(4) NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  KEY `ix_certificate_replacement_draft_mot_test_id` (`mot_test_id`),
  KEY `fk_draft_empty_vrm_reason_lookup` (`empty_vrm_reason_id`),
  KEY `fk_repl_draft_certificate_change_different_tester_reason_lookup` (`different_tester_reason_id`),
  KEY `fk_repl_draft_country_of_registration_lookup` (`country_of_registration_id`),
  KEY `fk_repl_draft_empty_vin_reason_lookup` (`empty_vin_reason_id`),
  KEY `fk_repl_draft_make` (`make_id`),
  KEY `fk_repl_draft_model` (`model_id`),
  KEY `fk_repl_draft_model_detail` (`model_detail_id`),
  KEY `fk_repl_draft_primary_colour` (`primary_colour_id`),
  KEY `fk_repl_draft_secondary_colour` (`secondary_colour_id`),
  KEY `fk_repl_draft_site` (`vehicle_testing_station_id`),
  CONSTRAINT `fk_draft_empty_vrm_reason_lookup` FOREIGN KEY (`empty_vrm_reason_id`) REFERENCES `empty_vrm_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_certificate_change_different_tester_reason_lookup` FOREIGN KEY (`different_tester_reason_id`) REFERENCES `certificate_change_different_tester_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_country_of_registration_lookup` FOREIGN KEY (`country_of_registration_id`) REFERENCES `country_of_registration_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_empty_vin_reason_lookup` FOREIGN KEY (`empty_vin_reason_id`) REFERENCES `empty_vin_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_make` FOREIGN KEY (`make_id`) REFERENCES `make` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_model` FOREIGN KEY (`model_id`) REFERENCES `model` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_model_detail` FOREIGN KEY (`model_detail_id`) REFERENCES `model_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_primary_colour` FOREIGN KEY (`primary_colour_id`) REFERENCES `colour_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_secondary_colour` FOREIGN KEY (`secondary_colour_id`) REFERENCES `colour_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_repl_draft_site` FOREIGN KEY (`vehicle_testing_station_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_draft_bi`
BEFORE INSERT ON `mot2`.`certificate_replacement_draft`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_draft_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_draft_bu`
BEFORE UPDATE ON `mot2`.`certificate_replacement_draft`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_draft_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_draft_au`
AFTER UPDATE ON `mot2`.`certificate_replacement_draft`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_draft_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`certificate_replacement_draft_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`mot_test_version`
        ,`vrm`
        ,`empty_vrm_reason_id`
        ,`vin`
        ,`empty_vin_reason_id`
        ,`vehicle_testing_station_id`
        ,`make_id`
        ,`make_name`
        ,`model_id`
        ,`model_name`
        ,`model_detail_id`
        ,`primary_colour_id`
        ,`secondary_colour_id`
        ,`country_of_registration_id`
        ,`expiry_date`
        ,`different_tester_reason_id`
        ,`replacement_reason`
        ,`is_vin_vrm_expiry_changed`
        ,`include_in_mismatch_file`
        ,`include_in_passes_file`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`is_deleted`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_version`
        ,OLD.`vrm`
        ,OLD.`empty_vrm_reason_id`
        ,OLD.`vin`
        ,OLD.`empty_vin_reason_id`
        ,OLD.`vehicle_testing_station_id`
        ,OLD.`make_id`
        ,OLD.`make_name`
        ,OLD.`model_id`
        ,OLD.`model_name`
        ,OLD.`model_detail_id`
        ,OLD.`primary_colour_id`
        ,OLD.`secondary_colour_id`
        ,OLD.`country_of_registration_id`
        ,OLD.`expiry_date`
        ,OLD.`different_tester_reason_id`
        ,OLD.`replacement_reason`
        ,OLD.`is_vin_vrm_expiry_changed`
        ,OLD.`include_in_mismatch_file`
        ,OLD.`include_in_passes_file`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`is_deleted`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_replacement_draft_bd`
BEFORE DELETE ON `mot2`.`certificate_replacement_draft`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_replacement_draft_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`certificate_replacement_draft_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`mot_test_version`
        ,`vrm`
        ,`empty_vrm_reason_id`
        ,`vin`
        ,`empty_vin_reason_id`
        ,`vehicle_testing_station_id`
        ,`make_id`
        ,`make_name`
        ,`model_id`
        ,`model_name`
        ,`model_detail_id`
        ,`primary_colour_id`
        ,`secondary_colour_id`
        ,`country_of_registration_id`
        ,`expiry_date`
        ,`different_tester_reason_id`
        ,`replacement_reason`
        ,`is_vin_vrm_expiry_changed`
        ,`include_in_mismatch_file`
        ,`include_in_passes_file`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`is_deleted`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_version`
        ,OLD.`vrm`
        ,OLD.`empty_vrm_reason_id`
        ,OLD.`vin`
        ,OLD.`empty_vin_reason_id`
        ,OLD.`vehicle_testing_station_id`
        ,OLD.`make_id`
        ,OLD.`make_name`
        ,OLD.`model_id`
        ,OLD.`model_name`
        ,OLD.`model_detail_id`
        ,OLD.`primary_colour_id`
        ,OLD.`secondary_colour_id`
        ,OLD.`country_of_registration_id`
        ,OLD.`expiry_date`
        ,OLD.`different_tester_reason_id`
        ,OLD.`replacement_reason`
        ,OLD.`is_vin_vrm_expiry_changed`
        ,OLD.`include_in_mismatch_file`
        ,OLD.`include_in_passes_file`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`is_deleted`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `certificate_replacement_draft_hist`
--

DROP TABLE IF EXISTS `certificate_replacement_draft_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_replacement_draft_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_version` int(10) unsigned DEFAULT NULL,
  `vrm` varchar(20) DEFAULT NULL,
  `empty_vrm_reason_id` smallint(5) unsigned DEFAULT NULL,
  `vin` varchar(30) DEFAULT NULL,
  `empty_vin_reason_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_testing_station_id` int(10) unsigned DEFAULT NULL,
  `make_id` int(10) unsigned DEFAULT NULL,
  `make_name` varchar(50) DEFAULT NULL,
  `model_id` int(10) unsigned DEFAULT NULL,
  `model_name` varchar(50) DEFAULT NULL,
  `model_detail_id` int(10) unsigned DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned DEFAULT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `different_tester_reason_id` smallint(5) unsigned DEFAULT NULL,
  `replacement_reason` text,
  `is_vin_vrm_expiry_changed` tinyint(3) unsigned DEFAULT NULL,
  `include_in_mismatch_file` tinyint(4) DEFAULT NULL,
  `include_in_passes_file` tinyint(4) DEFAULT NULL,
  `odometer_value` int(10) unsigned DEFAULT NULL,
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `is_deleted` tinyint(4) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_certificate_replacement_draft_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `certificate_replacement_hist`
--

DROP TABLE IF EXISTS `certificate_replacement_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_replacement_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(10) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_version` int(10) unsigned DEFAULT NULL,
  `different_tester_reason_id` smallint(5) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `certificate_type_id` bigint(20) unsigned DEFAULT NULL,
  `tester_person_id` int(10) unsigned DEFAULT NULL,
  `reason` text,
  `is_vin_vrm_expiry_changed` tinyint(3) unsigned DEFAULT NULL,
  `include_in_mismatch_file` tinyint(4) DEFAULT NULL,
  `include_in_passes_file` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_certificate_replacement_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `certificate_status`
--

DROP TABLE IF EXISTS `certificate_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the MOT test status';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_status_bi`
BEFORE INSERT ON `mot2`.`certificate_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_status_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `certificate_type`
--

DROP TABLE IF EXISTS `certificate_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `certificate_type` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_certificate_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the MOT test type';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_certificate_type_bi`
BEFORE INSERT ON `mot2`.`certificate_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_certificate_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `colour_lookup`
--

DROP TABLE IF EXISTS `colour_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `colour_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DVLA vehicle colours';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_colour_lookup_bi`
BEFORE INSERT ON `mot2`.`colour_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_colour_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `comment`
--

DROP TABLE IF EXISTS `comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `comment` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `comment` text NOT NULL,
  `author_person_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_comment_person_id` (`author_person_id`),
  CONSTRAINT `fk_comment_person_id` FOREIGN KEY (`author_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records comments made about various entities in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_comment_bi`
BEFORE INSERT ON `mot2`.`comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_comment_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_comment_bu`
BEFORE UPDATE ON `mot2`.`comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_comment_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_comment_au`
AFTER UPDATE ON `mot2`.`comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_comment_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`comment`
        ,`author_person_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`comment`
        ,OLD.`author_person_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_comment_bd`
BEFORE DELETE ON `mot2`.`comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_comment_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`comment`
        ,`author_person_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`comment`
        ,OLD.`author_person_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `comment_hist`
--

DROP TABLE IF EXISTS `comment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `comment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `comment` text,
  `author_person_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_comment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `company_type`
--

DROP TABLE IF EXISTS `company_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `company_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_company_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of an organisations legal status';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_company_type_bi`
BEFORE INSERT ON `mot2`.`company_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_company_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_company_type_bu`
BEFORE UPDATE ON `mot2`.`company_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_company_type_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_company_type_au`
AFTER UPDATE ON `mot2`.`company_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_company_type_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`company_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_company_type_bd`
BEFORE DELETE ON `mot2`.`company_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_company_type_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`company_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `company_type_hist`
--

DROP TABLE IF EXISTS `company_type_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `company_type_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_company_type_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `configuration`
--

DROP TABLE IF EXISTS `configuration`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `configuration` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `key` varchar(50) NOT NULL,
  `value` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Configurable values within the system that can be changed without a redeployment';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_configuration_bi`
BEFORE INSERT ON `mot2`.`configuration`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_configuration_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_configuration_bu`
BEFORE UPDATE ON `mot2`.`configuration`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_configuration_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_configuration_au`
AFTER UPDATE ON `mot2`.`configuration`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_configuration_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`configuration_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`key`
        ,`value`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`key`
        ,OLD.`value`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_configuration_bd`
BEFORE DELETE ON `mot2`.`configuration`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_configuration_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`configuration_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`key`
        ,`value`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`key`
        ,OLD.`value`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `configuration_hist`
--

DROP TABLE IF EXISTS `configuration_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `configuration_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `key` varchar(50) DEFAULT NULL,
  `value` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_configuration_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contact_detail`
--

DROP TABLE IF EXISTS `contact_detail`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_detail` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `for_attention_of` varchar(50) DEFAULT NULL,
  `address_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_contact_detail_address` (`address_id`),
  CONSTRAINT `fk_contact_detail_address` FOREIGN KEY (`address_id`) REFERENCES `address` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Container object to link all the contact elements, such as address, phone and email.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_contact_detail_bi`
BEFORE INSERT ON `mot2`.`contact_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_contact_detail_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_contact_detail_bu`
BEFORE UPDATE ON `mot2`.`contact_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_contact_detail_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_contact_detail_au`
AFTER UPDATE ON `mot2`.`contact_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_contact_detail_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`contact_detail_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`for_attention_of`
        ,`address_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`for_attention_of`
        ,OLD.`address_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_contact_detail_bd`
BEFORE DELETE ON `mot2`.`contact_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_contact_detail_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`contact_detail_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`for_attention_of`
        ,`address_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`for_attention_of`
        ,OLD.`address_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `contact_detail_hist`
--

DROP TABLE IF EXISTS `contact_detail_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_detail_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `for_attention_of` varchar(50) DEFAULT NULL,
  `address_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_contact_detail_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `contact_type`
--

DROP TABLE IF EXISTS `contact_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `contact_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_contact_type_bi`
BEFORE INSERT ON `mot2`.`contact_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_contact_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `content_type`
--

DROP TABLE IF EXISTS `content_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `content_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_content_type_bi`
BEFORE INSERT ON `mot2`.`content_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_content_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `conviction`
--

DROP TABLE IF EXISTS `conviction`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `conviction` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `application_id` int(10) unsigned NOT NULL,
  `reference` varchar(100) NOT NULL,
  `date_time` date NOT NULL,
  `court` varchar(50) NOT NULL,
  `offence` varchar(50) NOT NULL,
  `creation_time` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_conviction_application` (`application_id`),
  CONSTRAINT `fk_conviction_application` FOREIGN KEY (`application_id`) REFERENCES `application` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Conviction held by a person. Used in the application process.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_conviction_bi`
BEFORE INSERT ON `mot2`.`conviction`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_conviction_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `country_lookup`
--

DROP TABLE IF EXISTS `country_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `country_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `iso_code` varchar(5) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_country_lookup_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the country of registration for a vehicle and certificate replacement records';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_country_lookup_bi`
BEFORE INSERT ON `mot2`.`country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_country_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_country_lookup_bu`
BEFORE UPDATE ON `mot2`.`country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_country_lookup_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_country_lookup_au`
AFTER UPDATE ON `mot2`.`country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_country_lookup_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`country_lookup_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`display_order`
        ,`iso_code`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`display_order`
        ,OLD.`iso_code`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_country_lookup_bd`
BEFORE DELETE ON `mot2`.`country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_country_lookup_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`country_lookup_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`display_order`
        ,`iso_code`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`display_order`
        ,OLD.`iso_code`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `country_lookup_hist`
--

DROP TABLE IF EXISTS `country_lookup_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `country_lookup_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `iso_code` varchar(5) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_country_lookup_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `country_of_registration_lookup`
--

DROP TABLE IF EXISTS `country_of_registration_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `country_of_registration_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `country_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `licensing_copy` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_country_of_registration_lookup_country_lookup_id` (`country_lookup_id`),
  CONSTRAINT `fk_country_of_registration_lookup_country_lookup_id` FOREIGN KEY (`country_lookup_id`) REFERENCES `country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_country_of_registration_lookup_bi`
BEFORE INSERT ON `mot2`.`country_of_registration_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_country_of_registration_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `cpms_notification`
--

DROP TABLE IF EXISTS `cpms_notification`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cpms_notification` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `notification_id` varchar(36) NOT NULL COMMENT 'This ID is generated by CPMS, and is independent of any message ID generated by the underlying queueing software',
  `type_id` bigint(20) unsigned NOT NULL COMMENT 'Notification type is currently mandate or payment',
  `scope_id` bigint(20) unsigned NOT NULL COMMENT 'Payment Scopes is the CPMS term for the different types of payment that are supported by MOT et al',
  `status_id` bigint(20) unsigned NOT NULL COMMENT 'This is a status internal to us which stores whether the notification has been processed by us',
  `receipt_reference` varchar(32) DEFAULT NULL COMMENT 'The unique ID of this payment',
  `mandate_reference` varchar(32) DEFAULT NULL COMMENT 'If the payment scope is direct debit, this will contain the reference to the associated mandate',
  `received_count` int(10) unsigned NOT NULL DEFAULT '1' COMMENT 'The number of times this notification was sent by CPMS (includes the original message and its duplicates)',
  `raw_notification` text NOT NULL COMMENT 'The raw JSON payload from CPMS',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `notification_id` (`notification_id`),
  KEY `ix_cpms_notification_scope_id_cpms_notification_scope_id` (`scope_id`),
  KEY `ix_cpms_notification_status_id_cpms_notification_status_id` (`status_id`),
  KEY `ix_cpms_notification_type_id_cpms_notification_type_id` (`type_id`),
  CONSTRAINT `ix_cpms_notification_scope_id_cpms_notification_scope_id` FOREIGN KEY (`scope_id`) REFERENCES `cpms_notification_scope` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `ix_cpms_notification_status_id_cpms_notification_status_id` FOREIGN KEY (`status_id`) REFERENCES `cpms_notification_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `ix_cpms_notification_type_id_cpms_notification_type_id` FOREIGN KEY (`type_id`) REFERENCES `cpms_notification_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_cpms_notification_bi`
BEFORE INSERT ON `mot2`.`cpms_notification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_cpms_notification_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `cpms_notification_scope`
--

DROP TABLE IF EXISTS `cpms_notification_scope`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cpms_notification_scope` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `code` varchar(20) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ix_cpms_notification_scope_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_cpms_notification_scope_bi`
BEFORE INSERT ON `mot2`.`cpms_notification_scope`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_cpms_notification_scope_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `cpms_notification_status`
--

DROP TABLE IF EXISTS `cpms_notification_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cpms_notification_status` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ix_cpms_notification_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_cpms_notification_status_bi`
BEFORE INSERT ON `mot2`.`cpms_notification_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_cpms_notification_status_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `cpms_notification_type`
--

DROP TABLE IF EXISTS `cpms_notification_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `cpms_notification_type` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ix_cpms_notification_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_cpms_notification_type_bi`
BEFORE INSERT ON `mot2`.`cpms_notification_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_cpms_notification_type_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ctrl_sequence`
--

DROP TABLE IF EXISTS `ctrl_sequence`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ctrl_sequence` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `sequence_name` varchar(50) NOT NULL,
  `code` varchar(10) NOT NULL COMMENT 'Unique code for the app to identify the desired sequence',
  `prefix_str` varchar(50) DEFAULT NULL COMMENT 'An optional string to prefix to the sequence',
  `padding` tinyint(3) unsigned DEFAULT '0' COMMENT 'Optional padding for zero-padded strings. Use 0 for no padding',
  `sequence_number` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The actual sequence value used to generate the sequence',
  `increment_val` smallint(6) NOT NULL DEFAULT '1' COMMENT 'The increment value to add to the sequence',
  `min_val` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The minimum value for the sequence',
  `max_val` int(10) unsigned NOT NULL COMMENT 'The maximum value for the sequence',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_ctrl_sequence_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Sequences used by the application: use the sp_sequence(:code) stored procedure to get the next sequence to use';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_ctrl_sequence_bi`
BEFORE INSERT ON `mot2`.`ctrl_sequence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_ctrl_sequence_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `database_version`
--

DROP TABLE IF EXISTS `database_version`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `database_version` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `version_name` varchar(255) NOT NULL,
  `applied_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `direct_debit`
--

DROP TABLE IF EXISTS `direct_debit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `direct_debit` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `mandate_reference` varchar(50) DEFAULT NULL COMMENT 'Unique reference to direct debit mandate created in CPMS',
  `unique_identifier` varchar(8) DEFAULT NULL COMMENT 'Last 8 char of mandate_reference searched on',
  `slots` int(10) unsigned NOT NULL,
  `setup_date` datetime NOT NULL,
  `next_collection_date` date NOT NULL,
  `last_increment_date` date DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `is_active` tinyint(1) DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `mandate_id` (`mandate_reference`),
  UNIQUE KEY `ux_direct_debit_mandate_reference_id` (`mandate_reference`,`id`),
  KEY `direct_debit_status_id_is_active_next_collection_date_idx` (`status_id`,`is_active`,`next_collection_date`),
  KEY `direct_debit_unique_identifier_idx` (`unique_identifier`),
  KEY `fk_direct_debit_organisation` (`organisation_id`),
  KEY `fk_direct_debit_person` (`person_id`),
  CONSTRAINT `fk_direct_debit_organisation` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_direct_debit_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_direct_debit_status` FOREIGN KEY (`status_id`) REFERENCES `direct_debit_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Direct debit mandates of organisations wanting to purchase slots regularly';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_bi`
BEFORE INSERT ON `mot2`.`direct_debit`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_bu`
BEFORE UPDATE ON `mot2`.`direct_debit`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_au`
AFTER UPDATE ON `mot2`.`direct_debit`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`direct_debit_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`person_id`
        ,`status_id`
        ,`mandate_reference`
        ,`unique_identifier`
        ,`slots`
        ,`setup_date`
        ,`next_collection_date`
        ,`last_increment_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`is_active`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`person_id`
        ,OLD.`status_id`
        ,OLD.`mandate_reference`
        ,OLD.`unique_identifier`
        ,OLD.`slots`
        ,OLD.`setup_date`
        ,OLD.`next_collection_date`
        ,OLD.`last_increment_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`is_active`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_bd`
BEFORE DELETE ON `mot2`.`direct_debit`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`direct_debit_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`person_id`
        ,`status_id`
        ,`mandate_reference`
        ,`unique_identifier`
        ,`slots`
        ,`setup_date`
        ,`next_collection_date`
        ,`last_increment_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`is_active`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`person_id`
        ,OLD.`status_id`
        ,OLD.`mandate_reference`
        ,OLD.`unique_identifier`
        ,OLD.`slots`
        ,OLD.`setup_date`
        ,OLD.`next_collection_date`
        ,OLD.`last_increment_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`is_active`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `direct_debit_hist`
--

DROP TABLE IF EXISTS `direct_debit_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `direct_debit_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `mandate_reference` varchar(50) DEFAULT NULL,
  `unique_identifier` varchar(8) DEFAULT NULL,
  `slots` int(10) unsigned DEFAULT NULL,
  `setup_date` datetime DEFAULT NULL,
  `next_collection_date` date DEFAULT NULL,
  `last_increment_date` date DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_direct_debit_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `direct_debit_history`
--

DROP TABLE IF EXISTS `direct_debit_history`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `direct_debit_history` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `direct_debit_id` int(10) unsigned NOT NULL,
  `transaction_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `increment_date` datetime NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_direct_debit_history_dd_id` (`direct_debit_id`),
  KEY `fk_direct_debit_history_status` (`status_id`),
  KEY `fk_direct_debit_history_transaction` (`transaction_id`),
  CONSTRAINT `fk_direct_debit_history_dd_id` FOREIGN KEY (`direct_debit_id`) REFERENCES `direct_debit` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_direct_debit_history_status` FOREIGN KEY (`status_id`) REFERENCES `direct_debit_history_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_direct_debit_history_transaction` FOREIGN KEY (`transaction_id`) REFERENCES `test_slot_transaction` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_history_bi`
BEFORE INSERT ON `mot2`.`direct_debit_history`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_history_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `direct_debit_history_status`
--

DROP TABLE IF EXISTS `direct_debit_history_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `direct_debit_history_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_history_status_bi`
BEFORE INSERT ON `mot2`.`direct_debit_history_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_history_status_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `direct_debit_status`
--

DROP TABLE IF EXISTS `direct_debit_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `direct_debit_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `cpms_code` varchar(5) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of status of direct debit mandate';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_direct_debit_status_bi`
BEFORE INSERT ON `mot2`.`direct_debit_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_direct_debit_status_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dvla_make`
--

DROP TABLE IF EXISTS `dvla_make`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_make` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_dvla_make_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DVLA vehicle makes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_make_bi`
BEFORE INSERT ON `mot2`.`dvla_make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_make_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_make_bu`
BEFORE UPDATE ON `mot2`.`dvla_make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_make_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_make_au`
AFTER UPDATE ON `mot2`.`dvla_make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_make_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_make_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_make_bd`
BEFORE DELETE ON `mot2`.`dvla_make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_make_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_make_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dvla_make_hist`
--

DROP TABLE IF EXISTS `dvla_make_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_make_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_dvla_make_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `dvla_model`
--

DROP TABLE IF EXISTS `dvla_model`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_model` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL COMMENT 'Sometimes not provided during DVLA batch import process',
  `make_code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_dvla_model_make_model_code` (`make_code`,`code`),
  CONSTRAINT `fk_dvla_model_dvla_make_code` FOREIGN KEY (`make_code`) REFERENCES `dvla_make` (`code`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DVLA vehicle models';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_bi`
BEFORE INSERT ON `mot2`.`dvla_model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_bu`
BEFORE UPDATE ON `mot2`.`dvla_model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_au`
AFTER UPDATE ON `mot2`.`dvla_model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_model_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`make_code`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`make_code`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_bd`
BEFORE DELETE ON `mot2`.`dvla_model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_model_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`make_code`
        ,`code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`make_code`
        ,OLD.`code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dvla_model_hist`
--

DROP TABLE IF EXISTS `dvla_model_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_model_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `make_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_dvla_model_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `dvla_model_model_detail_code_map`
--

DROP TABLE IF EXISTS `dvla_model_model_detail_code_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_model_model_detail_code_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `dvla_make_code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `dvla_model_code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `make_id` int(10) unsigned NOT NULL,
  `model_id` int(10) unsigned DEFAULT NULL,
  `vsi_code` varchar(10) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_dvla_model_model_detail_code_map_dvla_model_code` (`dvla_make_code`,`dvla_model_code`),
  KEY `fk_dvla_model_model_detail_code_map_make` (`make_id`),
  KEY `fk_dvla_model_model_detail_code_map_model` (`model_id`),
  CONSTRAINT `fk_dvla_model_model_detail_code_map_dvla_make_code` FOREIGN KEY (`dvla_make_code`) REFERENCES `dvla_make` (`code`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_model_model_detail_code_map_dvla_model_code` FOREIGN KEY (`dvla_make_code`, `dvla_model_code`) REFERENCES `dvla_model` (`make_code`, `code`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_model_model_detail_code_map_make` FOREIGN KEY (`make_id`) REFERENCES `make` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_model_model_detail_code_map_model` FOREIGN KEY (`model_id`) REFERENCES `model` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_model_detail_code_map_bi`
BEFORE INSERT ON `mot2`.`dvla_model_model_detail_code_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_model_detail_code_map_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_model_detail_code_map_bu`
BEFORE UPDATE ON `mot2`.`dvla_model_model_detail_code_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_model_detail_code_map_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_model_detail_code_map_au`
AFTER UPDATE ON `mot2`.`dvla_model_model_detail_code_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_model_detail_code_map_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_model_model_detail_code_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`dvla_make_code`
        ,`dvla_model_code`
        ,`make_id`
        ,`model_id`
        ,`vsi_code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`dvla_make_code`
        ,OLD.`dvla_model_code`
        ,OLD.`make_id`
        ,OLD.`model_id`
        ,OLD.`vsi_code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_model_model_detail_code_map_bd`
BEFORE DELETE ON `mot2`.`dvla_model_model_detail_code_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_model_model_detail_code_map_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_model_model_detail_code_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`dvla_make_code`
        ,`dvla_model_code`
        ,`make_id`
        ,`model_id`
        ,`vsi_code`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`dvla_make_code`
        ,OLD.`dvla_model_code`
        ,OLD.`make_id`
        ,OLD.`model_id`
        ,OLD.`vsi_code`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dvla_model_model_detail_code_map_hist`
--

DROP TABLE IF EXISTS `dvla_model_model_detail_code_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_model_model_detail_code_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `dvla_make_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `dvla_model_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `make_id` int(10) unsigned DEFAULT NULL,
  `model_id` int(10) unsigned DEFAULT NULL,
  `vsi_code` varchar(10) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_dvla_model_model_detail_code_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `dvla_vehicle`
--

DROP TABLE IF EXISTS `dvla_vehicle`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_vehicle` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `registration` varchar(7) CHARACTER SET latin1 DEFAULT NULL,
  `registration_collapsed` varchar(13) CHARACTER SET latin1 DEFAULT NULL COMMENT 'registration/VRM with special characters removed by trigger',
  `registration_validation_character` varchar(1) DEFAULT NULL,
  `vin` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `vin_collapsed` varchar(20) CHARACTER SET latin1 DEFAULT NULL COMMENT 'vin with special characters removed by trigger',
  `model_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `make_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `make_in_full` varchar(20) DEFAULT NULL COMMENT 'Make Full Text populated when the make id and model id are null',
  `colour_1_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `colour_2_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `propulsion_code` varchar(2) CHARACTER SET latin1 DEFAULT NULL,
  `designed_gross_weight` int(11) DEFAULT NULL,
  `unladen_weight` int(11) DEFAULT NULL,
  `engine_number` varchar(20) DEFAULT NULL,
  `engine_capacity` int(11) DEFAULT NULL,
  `seating_capacity` smallint(5) unsigned DEFAULT NULL,
  `manufacture_date` date DEFAULT NULL,
  `first_registration_date` date DEFAULT NULL,
  `is_seriously_damaged` tinyint(4) DEFAULT NULL,
  `recent_v5_document_number` varchar(11) DEFAULT NULL,
  `is_vehicle_new_at_first_registration` tinyint(4) DEFAULT NULL,
  `body_type_code` varchar(2) CHARACTER SET latin1 DEFAULT NULL,
  `wheelplan_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `sva_emission_standard` varchar(6) DEFAULT NULL,
  `ct_related_mark` varchar(13) DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `dvla_vehicle_id` int(9) unsigned DEFAULT NULL,
  `eu_classification` varchar(2) DEFAULT NULL,
  `mass_in_service_weight` int(9) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `dvla_vehicle_colour_1_code_idx` (`colour_1_code`),
  KEY `dvla_vehicle_colour_2_code_idx` (`colour_2_code`),
  KEY `dvla_vehicle_dvla_vehicle_id_idx` (`dvla_vehicle_id`),
  KEY `dvla_vehicle_registration_idx` (`registration`),
  KEY `dvla_vehicle_vin_idx` (`vin`),
  KEY `dvla_vehicle_registration_collapsed_idx` (`registration_collapsed`),
  KEY `dvla_vehicle_vin_collapsed_idx` (`vin_collapsed`),
  KEY `fk_dvla_vehicle_vehicle` (`vehicle_id`),
  CONSTRAINT `fk_dvla_vehicle_vehicle` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Vehicle data imported from the DVLA';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_vehicle_bi`
BEFORE INSERT ON `mot2`.`dvla_vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_vehicle_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
    SET NEW.`registration_collapsed` = f_collapse(NEW.`registration`);
    SET NEW.`vin_collapsed` = f_collapse(NEW.`vin`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_vehicle_bu`
BEFORE UPDATE ON `mot2`.`dvla_vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_vehicle_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
    SET NEW.`registration_collapsed` = f_collapse(NEW.`registration`);
    SET NEW.`vin_collapsed` = f_collapse(NEW.`vin`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_vehicle_au`
AFTER UPDATE ON `mot2`.`dvla_vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_vehicle_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_vehicle_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`registration`
        ,`registration_collapsed`
        ,`registration_validation_character`
        ,`vin`
        ,`vin_collapsed`
        ,`model_code`
        ,`make_code`
        ,`make_in_full`
        ,`colour_1_code`
        ,`colour_2_code`
        ,`propulsion_code`
        ,`designed_gross_weight`
        ,`unladen_weight`
        ,`engine_number`
        ,`engine_capacity`
        ,`seating_capacity`
        ,`manufacture_date`
        ,`first_registration_date`
        ,`is_seriously_damaged`
        ,`recent_v5_document_number`
        ,`is_vehicle_new_at_first_registration`
        ,`body_type_code`
        ,`wheelplan_code`
        ,`sva_emission_standard`
        ,`ct_related_mark`
        ,`vehicle_id`
        ,`dvla_vehicle_id`
        ,`eu_classification`
        ,`mass_in_service_weight`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`registration`
        ,OLD.`registration_collapsed`
        ,OLD.`registration_validation_character`
        ,OLD.`vin`
        ,OLD.`vin_collapsed`
        ,OLD.`model_code`
        ,OLD.`make_code`
        ,OLD.`make_in_full`
        ,OLD.`colour_1_code`
        ,OLD.`colour_2_code`
        ,OLD.`propulsion_code`
        ,OLD.`designed_gross_weight`
        ,OLD.`unladen_weight`
        ,OLD.`engine_number`
        ,OLD.`engine_capacity`
        ,OLD.`seating_capacity`
        ,OLD.`manufacture_date`
        ,OLD.`first_registration_date`
        ,OLD.`is_seriously_damaged`
        ,OLD.`recent_v5_document_number`
        ,OLD.`is_vehicle_new_at_first_registration`
        ,OLD.`body_type_code`
        ,OLD.`wheelplan_code`
        ,OLD.`sva_emission_standard`
        ,OLD.`ct_related_mark`
        ,OLD.`vehicle_id`
        ,OLD.`dvla_vehicle_id`
        ,OLD.`eu_classification`
        ,OLD.`mass_in_service_weight`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_vehicle_bd`
BEFORE DELETE ON `mot2`.`dvla_vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_vehicle_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`dvla_vehicle_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`registration`
        ,`registration_collapsed`
        ,`registration_validation_character`
        ,`vin`
        ,`vin_collapsed`
        ,`model_code`
        ,`make_code`
        ,`make_in_full`
        ,`colour_1_code`
        ,`colour_2_code`
        ,`propulsion_code`
        ,`designed_gross_weight`
        ,`unladen_weight`
        ,`engine_number`
        ,`engine_capacity`
        ,`seating_capacity`
        ,`manufacture_date`
        ,`first_registration_date`
        ,`is_seriously_damaged`
        ,`recent_v5_document_number`
        ,`is_vehicle_new_at_first_registration`
        ,`body_type_code`
        ,`wheelplan_code`
        ,`sva_emission_standard`
        ,`ct_related_mark`
        ,`vehicle_id`
        ,`dvla_vehicle_id`
        ,`eu_classification`
        ,`mass_in_service_weight`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`registration`
        ,OLD.`registration_collapsed`
        ,OLD.`registration_validation_character`
        ,OLD.`vin`
        ,OLD.`vin_collapsed`
        ,OLD.`model_code`
        ,OLD.`make_code`
        ,OLD.`make_in_full`
        ,OLD.`colour_1_code`
        ,OLD.`colour_2_code`
        ,OLD.`propulsion_code`
        ,OLD.`designed_gross_weight`
        ,OLD.`unladen_weight`
        ,OLD.`engine_number`
        ,OLD.`engine_capacity`
        ,OLD.`seating_capacity`
        ,OLD.`manufacture_date`
        ,OLD.`first_registration_date`
        ,OLD.`is_seriously_damaged`
        ,OLD.`recent_v5_document_number`
        ,OLD.`is_vehicle_new_at_first_registration`
        ,OLD.`body_type_code`
        ,OLD.`wheelplan_code`
        ,OLD.`sva_emission_standard`
        ,OLD.`ct_related_mark`
        ,OLD.`vehicle_id`
        ,OLD.`dvla_vehicle_id`
        ,OLD.`eu_classification`
        ,OLD.`mass_in_service_weight`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `dvla_vehicle_hist`
--

DROP TABLE IF EXISTS `dvla_vehicle_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_vehicle_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `registration` varchar(7) CHARACTER SET latin1 DEFAULT NULL,
  `registration_collapsed` varchar(13) CHARACTER SET latin1 DEFAULT NULL,
  `registration_validation_character` varchar(1) DEFAULT NULL,
  `vin` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `vin_collapsed` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `model_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `make_code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `make_in_full` varchar(20) DEFAULT NULL,
  `colour_1_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `colour_2_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `propulsion_code` varchar(2) CHARACTER SET latin1 DEFAULT NULL,
  `designed_gross_weight` int(11) DEFAULT NULL,
  `unladen_weight` int(11) DEFAULT NULL,
  `engine_number` varchar(20) DEFAULT NULL,
  `engine_capacity` int(11) DEFAULT NULL,
  `seating_capacity` smallint(5) unsigned DEFAULT NULL,
  `manufacture_date` date DEFAULT NULL,
  `first_registration_date` date DEFAULT NULL,
  `is_seriously_damaged` tinyint(4) DEFAULT NULL,
  `recent_v5_document_number` varchar(11) DEFAULT NULL,
  `is_vehicle_new_at_first_registration` tinyint(4) DEFAULT NULL,
  `body_type_code` varchar(2) CHARACTER SET latin1 DEFAULT NULL,
  `wheelplan_code` varchar(1) CHARACTER SET latin1 DEFAULT NULL,
  `sva_emission_standard` varchar(6) DEFAULT NULL,
  `ct_related_mark` varchar(13) DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `dvla_vehicle_id` int(9) unsigned DEFAULT NULL,
  `eu_classification` varchar(2) DEFAULT NULL,
  `mass_in_service_weight` int(9) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_dvla_vehicle_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `dvla_vehicle_import_change_log`
--

DROP TABLE IF EXISTS `dvla_vehicle_import_change_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `dvla_vehicle_import_change_log` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_id` int(10) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `main_colour_code` varchar(5) NOT NULL COMMENT 'TODO:  CHARACTER SET latin1 ',
  `secondary_colour_code` varchar(5) DEFAULT NULL COMMENT 'TODO:  CHARACTER SET latin1 ',
  `fuel_type_code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `imported` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_dvla_vehicle_import_change_log_fuel_type_code` (`fuel_type_code`),
  KEY `fk_dvla_vehicle_import_change_log_main_colour` (`main_colour_code`),
  KEY `fk_dvla_vehicle_import_change_log_person_id` (`person_id`),
  KEY `fk_dvla_vehicle_import_change_log_secondary_colour` (`secondary_colour_code`),
  KEY `fk_dvla_vehicle_import_change_log_vehicle_class_id` (`vehicle_class_id`),
  KEY `fk_dvla_vehicle_import_change_log_vehicle_id` (`vehicle_id`),
  CONSTRAINT `fk_dvla_vehicle_import_change_log_fuel_type_code` FOREIGN KEY (`fuel_type_code`) REFERENCES `fuel_type` (`code`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_vehicle_import_change_log_main_colour` FOREIGN KEY (`main_colour_code`) REFERENCES `colour_lookup` (`code`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_vehicle_import_change_log_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_vehicle_import_change_log_secondary_colour` FOREIGN KEY (`secondary_colour_code`) REFERENCES `colour_lookup` (`code`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_vehicle_import_change_log_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_dvla_vehicle_import_change_log_vehicle_id` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Log of changes made to DVLA vehicle data by tester at start of test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_dvla_vehicle_import_change_log_bi`
BEFORE INSERT ON `mot2`.`dvla_vehicle_import_change_log`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_dvla_vehicle_import_change_log_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `email`
--

DROP TABLE IF EXISTS `email`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `email` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `contact_detail_id` int(10) unsigned NOT NULL,
  `email` varchar(255) NOT NULL,
  `is_primary` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_email_contact_detail_id` (`contact_detail_id`),
  CONSTRAINT `fk_email_contact_detail_id` FOREIGN KEY (`contact_detail_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of a email address';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_email_bi`
BEFORE INSERT ON `mot2`.`email`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_email_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_email_bu`
BEFORE UPDATE ON `mot2`.`email`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_email_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_email_au`
AFTER UPDATE ON `mot2`.`email`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_email_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`email_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_detail_id`
        ,`email`
        ,`is_primary`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`contact_detail_id`
        ,OLD.`email`
        ,OLD.`is_primary`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_email_bd`
BEFORE DELETE ON `mot2`.`email`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_email_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`email_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_detail_id`
        ,`email`
        ,`is_primary`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`contact_detail_id`
        ,OLD.`email`
        ,OLD.`is_primary`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `email_hist`
--

DROP TABLE IF EXISTS `email_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `email_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `contact_detail_id` int(10) unsigned DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `is_primary` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_email_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `emergency_log`
--

DROP TABLE IF EXISTS `emergency_log`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `emergency_log` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `number` varchar(10) NOT NULL COMMENT 'The emergency log code',
  `description` varchar(250) DEFAULT NULL COMMENT 'Full text description to explain reason for the code',
  `start_date` date DEFAULT NULL COMMENT 'Starting date for the contingency code',
  `end_date` date DEFAULT NULL COMMENT 'Ending date for using this code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Log of emergency outages and the codes used';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_emergency_log_bi`
BEFORE INSERT ON `mot2`.`emergency_log`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_emergency_log_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_emergency_log_bu`
BEFORE UPDATE ON `mot2`.`emergency_log`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_emergency_log_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_emergency_log_au`
AFTER UPDATE ON `mot2`.`emergency_log`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_emergency_log_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`emergency_log_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`number`
        ,`description`
        ,`start_date`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`number`
        ,OLD.`description`
        ,OLD.`start_date`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_emergency_log_bd`
BEFORE DELETE ON `mot2`.`emergency_log`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_emergency_log_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`emergency_log_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`number`
        ,`description`
        ,`start_date`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`number`
        ,OLD.`description`
        ,OLD.`start_date`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `emergency_log_hist`
--

DROP TABLE IF EXISTS `emergency_log_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `emergency_log_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `number` varchar(10) DEFAULT NULL,
  `description` varchar(250) DEFAULT NULL,
  `start_date` date DEFAULT NULL,
  `end_date` date DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_emergency_log_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `emergency_reason_lookup`
--

DROP TABLE IF EXISTS `emergency_reason_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `emergency_reason_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'Short name displayed to users in the GUI',
  `code` varchar(5) NOT NULL COMMENT 'Internal code assigned to contingency testing reasons',
  `description` varchar(50) DEFAULT NULL COMMENT 'Longer descriptive text for the reason code',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Codes and descriptions for reasons due to which contingency testing has to take place';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_emergency_reason_lookup_bi`
BEFORE INSERT ON `mot2`.`emergency_reason_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_emergency_reason_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `empty_reason_map`
--

DROP TABLE IF EXISTS `empty_reason_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `empty_reason_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_id` int(10) unsigned NOT NULL,
  `empty_vin_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `empty_vrm_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_empty_reason_map_vehicle` (`vehicle_id`),
  KEY `fk_empty_reason_map_empty_vrm_reason_lookup` (`empty_vrm_reason_lookup_id`),
  KEY `fk_empty_reason_map_empty_vin_reason_lookup` (`empty_vin_reason_lookup_id`),
  CONSTRAINT `fk_empty_reason_map_empty_vin_reason_lookup` FOREIGN KEY (`empty_vin_reason_lookup_id`) REFERENCES `empty_vin_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_empty_reason_map_empty_vrm_reason_lookup` FOREIGN KEY (`empty_vrm_reason_lookup_id`) REFERENCES `empty_vrm_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_empty_reason_map_vehicle` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_reason_map_bi`
BEFORE INSERT ON `mot2`.`empty_reason_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_reason_map_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = latin1 */ ;
/*!50003 SET character_set_results = latin1 */ ;
/*!50003 SET collation_connection  = latin1_swedish_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_reason_map_bu`
BEFORE UPDATE ON `mot2`.`empty_reason_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_reason_map_bu Generated on 2016-07-04 12:27:10. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = latin1 */ ;
/*!50003 SET character_set_results = latin1 */ ;
/*!50003 SET collation_connection  = latin1_swedish_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_reason_map_au`
AFTER UPDATE ON `mot2`.`empty_reason_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_reason_map_au Generated on 2016-07-04 12:27:10. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`empty_reason_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`vehicle_id`
        ,`empty_vin_reason_lookup_id`
        ,`empty_vrm_reason_lookup_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`vehicle_id`
        ,OLD.`empty_vin_reason_lookup_id`
        ,OLD.`empty_vrm_reason_lookup_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = latin1 */ ;
/*!50003 SET character_set_results = latin1 */ ;
/*!50003 SET collation_connection  = latin1_swedish_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_reason_map_bd`
BEFORE DELETE ON `mot2`.`empty_reason_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_reason_map_bd Generated on 2016-07-04 12:27:10. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`empty_reason_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`vehicle_id`
        ,`empty_vin_reason_lookup_id`
        ,`empty_vrm_reason_lookup_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`vehicle_id`
        ,OLD.`empty_vin_reason_lookup_id`
        ,OLD.`empty_vrm_reason_lookup_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `empty_reason_map_hist`
--

DROP TABLE IF EXISTS `empty_reason_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `empty_reason_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `empty_vin_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `empty_vrm_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NULL DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_empty_reason_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `empty_vin_reason_lookup`
--

DROP TABLE IF EXISTS `empty_vin_reason_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `empty_vin_reason_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_vin_reason_lookup_bi`
BEFORE INSERT ON `mot2`.`empty_vin_reason_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_vin_reason_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `empty_vrm_reason_lookup`
--

DROP TABLE IF EXISTS `empty_vrm_reason_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `empty_vrm_reason_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_empty_vrm_reason_lookup_bi`
BEFORE INSERT ON `mot2`.`empty_vrm_reason_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_empty_vrm_reason_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_condition_appointment_lookup`
--

DROP TABLE IF EXISTS `enforcement_condition_appointment_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_condition_appointment_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `description` varchar(50) DEFAULT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Descriptions of conditions of approval for recording a new Site by the VE';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_condition_appointment_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_condition_appointment_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_condition_appointment_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_decision_category_lookup`
--

DROP TABLE IF EXISTS `enforcement_decision_category_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_decision_category_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `category` varchar(50) DEFAULT NULL COMMENT 'The outcome category description',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Enumerates the decisions a VE can make at the RFR level when comparing a VE Test to a Testers Test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_decision_category_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_decision_category_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_decision_category_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_decision_lookup`
--

DROP TABLE IF EXISTS `enforcement_decision_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_decision_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `decision` varchar(100) NOT NULL COMMENT 'Plain text description of the decision',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Comparison screen decision results';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_decision_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_decision_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_decision_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_decision_outcome_lookup`
--

DROP TABLE IF EXISTS `enforcement_decision_outcome_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_decision_outcome_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `outcome` varchar(50) DEFAULT NULL COMMENT 'Plain text description of the outcome result',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Enforcement decision outcome reasons';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_decision_outcome_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_decision_outcome_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_decision_outcome_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_decision_reinspection_outcome_lookup`
--

DROP TABLE IF EXISTS `enforcement_decision_reinspection_outcome_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_decision_reinspection_outcome_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `decision` varchar(50) DEFAULT NULL COMMENT 'Textual description of the outcome value',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='List of approved reinspection outcomes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_decision_reinspection_outcome_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_decision_reinspection_outcome_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_decision_reinspection_outcome_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_decision_score_lookup`
--

DROP TABLE IF EXISTS `enforcement_decision_score_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_decision_score_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `score` smallint(5) unsigned DEFAULT NULL COMMENT 'The numerical value of this score',
  `description` varchar(50) NOT NULL COMMENT 'The descriptive text for the score',
  `display_order` smallint(5) unsigned DEFAULT NULL COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Comparison screen decision score selections';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_decision_score_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_decision_score_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_decision_score_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_fuel_type_lookup`
--

DROP TABLE IF EXISTS `enforcement_fuel_type_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_fuel_type_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `description` varchar(50) DEFAULT NULL COMMENT 'Descriptive text for the fuel type',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Permissible fuel types for which a Site is approved';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_fuel_type_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_fuel_type_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_fuel_type_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_full_partial_retest_lookup`
--

DROP TABLE IF EXISTS `enforcement_full_partial_retest_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_full_partial_retest_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT 'Printable name for the test type',
  `description` varchar(50) DEFAULT NULL COMMENT 'Text description for the test type',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record whether the VEs Test is full or partial';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_full_partial_retest_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_full_partial_retest_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_full_partial_retest_lookup_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_mot_demo_test`
--

DROP TABLE IF EXISTS `enforcement_mot_demo_test`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_demo_test` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL COMMENT 'The MOT test demo test identifier',
  `result_id` tinyint(4) NOT NULL COMMENT 'The result of the demonstration test',
  `is_satisfactory` tinyint(4) NOT NULL DEFAULT '0',
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_enforcement_mot_demo_test_comment` (`comment_id`),
  KEY `fk_enforcement_mot_demo_test_mot_test_id` (`mot_test_id`),
  KEY `ix_enforcement_mot_demo_test_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_enforcement_mot_demo_test_comment` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Demonstration tests, not for public viewing';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_demo_test_bi`
BEFORE INSERT ON `mot2`.`enforcement_mot_demo_test`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_demo_test_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_mot_test_differences`
--

DROP TABLE IF EXISTS `enforcement_mot_test_differences`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_test_differences` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `enforcement_mot_test_result_id` int(10) unsigned NOT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL COMMENT 'denormalisation',
  `mot_test_id` bigint(20) unsigned NOT NULL COMMENT 'denormalisation',
  `mot_test_rfr_map_id` bigint(20) unsigned NOT NULL,
  `mot_test_type_id` smallint(5) unsigned NOT NULL COMMENT 'denormalisation',
  `enforcement_decision_score_lookup_id` smallint(5) unsigned NOT NULL,
  `enforcement_decision_lookup_id` smallint(5) unsigned NOT NULL,
  `enforcement_decision_category_lookup_id` smallint(5) unsigned NOT NULL,
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_comment_enforcement_mot_test_differences` (`comment_id`),
  KEY `fk_enforcement_decision_category_lookup` (`enforcement_decision_category_lookup_id`),
  KEY `fk_enforcement_decision_lookup` (`enforcement_decision_lookup_id`),
  KEY `fk_enforcement_decision_score_lookup` (`enforcement_decision_score_lookup_id`),
  KEY `fk_enforcement_mot_test_differences_rfr_id` (`rfr_id`),
  KEY `fk_enforcement_mot_test_difference_mot_test_id` (`mot_test_id`),
  KEY `fk_enforcement_mot_test_result` (`enforcement_mot_test_result_id`),
  KEY `fk_mot_test_type_id` (`mot_test_type_id`),
  KEY `ix_enforcement_mot_test_difference_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_comment_enforcement_mot_test_differences` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_decision_category_lookup` FOREIGN KEY (`enforcement_decision_category_lookup_id`) REFERENCES `enforcement_decision_category_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_decision_lookup` FOREIGN KEY (`enforcement_decision_lookup_id`) REFERENCES `enforcement_decision_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_decision_score_lookup` FOREIGN KEY (`enforcement_decision_score_lookup_id`) REFERENCES `enforcement_decision_score_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_mot_test_differences_rfr_id` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_mot_test_result` FOREIGN KEY (`enforcement_mot_test_result_id`) REFERENCES `enforcement_mot_test_result` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_type_id` FOREIGN KEY (`mot_test_type_id`) REFERENCES `mot_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Differences between tests: the comparison process output';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_differences_bi`
BEFORE INSERT ON `mot2`.`enforcement_mot_test_differences`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_differences_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_differences_bu`
BEFORE UPDATE ON `mot2`.`enforcement_mot_test_differences`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_differences_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_differences_au`
AFTER UPDATE ON `mot2`.`enforcement_mot_test_differences`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_differences_au Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_mot_test_differences_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`enforcement_mot_test_result_id`
        ,`rfr_id`
        ,`mot_test_id`
        ,`mot_test_rfr_map_id`
        ,`mot_test_type_id`
        ,`enforcement_decision_score_lookup_id`
        ,`enforcement_decision_lookup_id`
        ,`enforcement_decision_category_lookup_id`
        ,`comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`enforcement_mot_test_result_id`
        ,OLD.`rfr_id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_rfr_map_id`
        ,OLD.`mot_test_type_id`
        ,OLD.`enforcement_decision_score_lookup_id`
        ,OLD.`enforcement_decision_lookup_id`
        ,OLD.`enforcement_decision_category_lookup_id`
        ,OLD.`comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_differences_bd`
BEFORE DELETE ON `mot2`.`enforcement_mot_test_differences`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_differences_bd Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_mot_test_differences_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`enforcement_mot_test_result_id`
        ,`rfr_id`
        ,`mot_test_id`
        ,`mot_test_rfr_map_id`
        ,`mot_test_type_id`
        ,`enforcement_decision_score_lookup_id`
        ,`enforcement_decision_lookup_id`
        ,`enforcement_decision_category_lookup_id`
        ,`comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`enforcement_mot_test_result_id`
        ,OLD.`rfr_id`
        ,OLD.`mot_test_id`
        ,OLD.`mot_test_rfr_map_id`
        ,OLD.`mot_test_type_id`
        ,OLD.`enforcement_decision_score_lookup_id`
        ,OLD.`enforcement_decision_lookup_id`
        ,OLD.`enforcement_decision_category_lookup_id`
        ,OLD.`comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_mot_test_differences_hist`
--

DROP TABLE IF EXISTS `enforcement_mot_test_differences_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_test_differences_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `enforcement_mot_test_result_id` int(10) unsigned DEFAULT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_rfr_map_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `enforcement_decision_score_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `enforcement_decision_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `enforcement_decision_category_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_enforcement_mot_test_differences_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enforcement_mot_test_result`
--

DROP TABLE IF EXISTS `enforcement_mot_test_result`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_test_result` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `re_inspection_mot_test_id` bigint(20) unsigned NOT NULL COMMENT 'Re-inspection MOT Test Id',
  `mot_test_id` bigint(20) unsigned NOT NULL COMMENT 'MOT Test Id',
  `total_score` smallint(5) unsigned NOT NULL COMMENT 'Total points awarded on completion of the test',
  `enforcement_decision_outcome_lookup_id` smallint(5) unsigned NOT NULL COMMENT 'The awarded outcome decision',
  `comment_id` bigint(20) unsigned DEFAULT NULL COMMENT 'Link to free text comment made (optional)',
  `step` varchar(100) DEFAULT NULL COMMENT 'Application internal state: transition group operation',
  `enforcement_decision_reinspection_outcome_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `awl_advice_given` varchar(255) DEFAULT NULL COMMENT 'Advisory warning letter: contents of the advisory warning letter text field',
  `awl_immediate_attention` varchar(255) DEFAULT NULL COMMENT 'Advisory warning letter: contents of the immediate attention text field',
  `awl_reply_comments` varchar(255) DEFAULT NULL COMMENT 'Advisory warning letter: comments from the VE who performed the test',
  `awl_name_a_ere` varchar(255) DEFAULT NULL COMMENT 'Advisory warning letter: Name of the AE of the Site the test took place at',
  `awl_mot_roles` varchar(255) DEFAULT NULL COMMENT 'Advisory warning letter: Roles',
  `awl_position_vts` varchar(255) DEFAULT NULL,
  `awl_user_id` varchar(255) DEFAULT NULL,
  `complainant_name` varchar(255) DEFAULT NULL COMMENT 'Who raised the need for the test',
  `complaint_detail` varchar(255) DEFAULT NULL COMMENT 'Details about the complainant',
  `repairs_detail` varchar(255) DEFAULT NULL,
  `complainant_address` varchar(255) DEFAULT NULL,
  `complainant_postcode` varchar(255) DEFAULT NULL,
  `complainant_phone_number` varchar(255) DEFAULT NULL,
  `ve_completed` varchar(255) DEFAULT NULL,
  `agree_vehicle_to_certificate` varchar(255) DEFAULT NULL,
  `input_agree_vehicle_to_certificate` varchar(255) DEFAULT NULL,
  `agree_vehicle_to_fail` varchar(255) DEFAULT NULL,
  `input_agree_vehicle_to_fail` varchar(255) DEFAULT NULL,
  `vehicle_switch` varchar(255) DEFAULT NULL,
  `input_vehicle_switch` varchar(255) DEFAULT NULL,
  `switch_police_status_report` varchar(255) DEFAULT NULL,
  `input_switch_detail_report` varchar(255) DEFAULT NULL,
  `switch_vehicle_result` varchar(255) DEFAULT NULL,
  `input_switch_police_status_report` varchar(255) DEFAULT NULL,
  `promote_sale_interest` varchar(255) DEFAULT NULL,
  `input_promote_sale_interest` varchar(255) DEFAULT NULL,
  `vehicle_defects` varchar(255) DEFAULT NULL,
  `reason_of_defects` varchar(255) DEFAULT NULL,
  `items_discussed` varchar(255) DEFAULT NULL,
  `concluding_remarks_tester` varchar(255) DEFAULT NULL,
  `concluding_remarks_ae` varchar(4000) DEFAULT NULL,
  `concluding_remarks_recommendation` varchar(4000) DEFAULT NULL,
  `concluding_remarks_name` varchar(200) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_comment` (`comment_id`),
  KEY `fk_enforcement_decision_outcome_lookup` (`enforcement_decision_outcome_lookup_id`),
  KEY `fk_enforcement_decision_reinspection_outcome_lookup` (`enforcement_decision_reinspection_outcome_lookup_id`),
  KEY `fk_enforcement_mot_test_result_mot_test_id` (`mot_test_id`),
  KEY `fk_enforcement_mot_test_result_re_inspection_mot_test_id` (`re_inspection_mot_test_id`),
  KEY `ix_enforcement_mot_test_result_mot_test_id` (`mot_test_id`),
  KEY `ix_enforcement_mot_test_result_re_inspection_mot_test_id` (`re_inspection_mot_test_id`),
  CONSTRAINT `fk_comment` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_decision_outcome_lookup` FOREIGN KEY (`enforcement_decision_outcome_lookup_id`) REFERENCES `enforcement_decision_outcome_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_decision_reinspection_outcome_lookup` FOREIGN KEY (`enforcement_decision_reinspection_outcome_lookup_id`) REFERENCES `enforcement_decision_reinspection_outcome_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_result_bi`
BEFORE INSERT ON `mot2`.`enforcement_mot_test_result`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_result_bi Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_result_bu`
BEFORE UPDATE ON `mot2`.`enforcement_mot_test_result`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_result_bu Generated on 2016-12-12 11:28:59. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_result_au`
AFTER UPDATE ON `mot2`.`enforcement_mot_test_result`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_result_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_mot_test_result_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`re_inspection_mot_test_id`
        ,`mot_test_id`
        ,`total_score`
        ,`enforcement_decision_outcome_lookup_id`
        ,`comment_id`
        ,`step`
        ,`enforcement_decision_reinspection_outcome_lookup_id`
        ,`awl_advice_given`
        ,`awl_immediate_attention`
        ,`awl_reply_comments`
        ,`awl_name_a_ere`
        ,`awl_mot_roles`
        ,`awl_position_vts`
        ,`awl_user_id`
        ,`complainant_name`
        ,`complaint_detail`
        ,`repairs_detail`
        ,`complainant_address`
        ,`complainant_postcode`
        ,`complainant_phone_number`
        ,`ve_completed`
        ,`agree_vehicle_to_certificate`
        ,`input_agree_vehicle_to_certificate`
        ,`agree_vehicle_to_fail`
        ,`input_agree_vehicle_to_fail`
        ,`vehicle_switch`
        ,`input_vehicle_switch`
        ,`switch_police_status_report`
        ,`input_switch_detail_report`
        ,`switch_vehicle_result`
        ,`input_switch_police_status_report`
        ,`promote_sale_interest`
        ,`input_promote_sale_interest`
        ,`vehicle_defects`
        ,`reason_of_defects`
        ,`items_discussed`
        ,`concluding_remarks_tester`
        ,`concluding_remarks_ae`
        ,`concluding_remarks_recommendation`
        ,`concluding_remarks_name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`re_inspection_mot_test_id`
        ,OLD.`mot_test_id`
        ,OLD.`total_score`
        ,OLD.`enforcement_decision_outcome_lookup_id`
        ,OLD.`comment_id`
        ,OLD.`step`
        ,OLD.`enforcement_decision_reinspection_outcome_lookup_id`
        ,OLD.`awl_advice_given`
        ,OLD.`awl_immediate_attention`
        ,OLD.`awl_reply_comments`
        ,OLD.`awl_name_a_ere`
        ,OLD.`awl_mot_roles`
        ,OLD.`awl_position_vts`
        ,OLD.`awl_user_id`
        ,OLD.`complainant_name`
        ,OLD.`complaint_detail`
        ,OLD.`repairs_detail`
        ,OLD.`complainant_address`
        ,OLD.`complainant_postcode`
        ,OLD.`complainant_phone_number`
        ,OLD.`ve_completed`
        ,OLD.`agree_vehicle_to_certificate`
        ,OLD.`input_agree_vehicle_to_certificate`
        ,OLD.`agree_vehicle_to_fail`
        ,OLD.`input_agree_vehicle_to_fail`
        ,OLD.`vehicle_switch`
        ,OLD.`input_vehicle_switch`
        ,OLD.`switch_police_status_report`
        ,OLD.`input_switch_detail_report`
        ,OLD.`switch_vehicle_result`
        ,OLD.`input_switch_police_status_report`
        ,OLD.`promote_sale_interest`
        ,OLD.`input_promote_sale_interest`
        ,OLD.`vehicle_defects`
        ,OLD.`reason_of_defects`
        ,OLD.`items_discussed`
        ,OLD.`concluding_remarks_tester`
        ,OLD.`concluding_remarks_ae`
        ,OLD.`concluding_remarks_recommendation`
        ,OLD.`concluding_remarks_name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_result_bd`
BEFORE DELETE ON `mot2`.`enforcement_mot_test_result`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_result_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_mot_test_result_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`re_inspection_mot_test_id`
        ,`mot_test_id`
        ,`total_score`
        ,`enforcement_decision_outcome_lookup_id`
        ,`comment_id`
        ,`step`
        ,`enforcement_decision_reinspection_outcome_lookup_id`
        ,`awl_advice_given`
        ,`awl_immediate_attention`
        ,`awl_reply_comments`
        ,`awl_name_a_ere`
        ,`awl_mot_roles`
        ,`awl_position_vts`
        ,`awl_user_id`
        ,`complainant_name`
        ,`complaint_detail`
        ,`repairs_detail`
        ,`complainant_address`
        ,`complainant_postcode`
        ,`complainant_phone_number`
        ,`ve_completed`
        ,`agree_vehicle_to_certificate`
        ,`input_agree_vehicle_to_certificate`
        ,`agree_vehicle_to_fail`
        ,`input_agree_vehicle_to_fail`
        ,`vehicle_switch`
        ,`input_vehicle_switch`
        ,`switch_police_status_report`
        ,`input_switch_detail_report`
        ,`switch_vehicle_result`
        ,`input_switch_police_status_report`
        ,`promote_sale_interest`
        ,`input_promote_sale_interest`
        ,`vehicle_defects`
        ,`reason_of_defects`
        ,`items_discussed`
        ,`concluding_remarks_tester`
        ,`concluding_remarks_ae`
        ,`concluding_remarks_recommendation`
        ,`concluding_remarks_name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`re_inspection_mot_test_id`
        ,OLD.`mot_test_id`
        ,OLD.`total_score`
        ,OLD.`enforcement_decision_outcome_lookup_id`
        ,OLD.`comment_id`
        ,OLD.`step`
        ,OLD.`enforcement_decision_reinspection_outcome_lookup_id`
        ,OLD.`awl_advice_given`
        ,OLD.`awl_immediate_attention`
        ,OLD.`awl_reply_comments`
        ,OLD.`awl_name_a_ere`
        ,OLD.`awl_mot_roles`
        ,OLD.`awl_position_vts`
        ,OLD.`awl_user_id`
        ,OLD.`complainant_name`
        ,OLD.`complaint_detail`
        ,OLD.`repairs_detail`
        ,OLD.`complainant_address`
        ,OLD.`complainant_postcode`
        ,OLD.`complainant_phone_number`
        ,OLD.`ve_completed`
        ,OLD.`agree_vehicle_to_certificate`
        ,OLD.`input_agree_vehicle_to_certificate`
        ,OLD.`agree_vehicle_to_fail`
        ,OLD.`input_agree_vehicle_to_fail`
        ,OLD.`vehicle_switch`
        ,OLD.`input_vehicle_switch`
        ,OLD.`switch_police_status_report`
        ,OLD.`input_switch_detail_report`
        ,OLD.`switch_vehicle_result`
        ,OLD.`input_switch_police_status_report`
        ,OLD.`promote_sale_interest`
        ,OLD.`input_promote_sale_interest`
        ,OLD.`vehicle_defects`
        ,OLD.`reason_of_defects`
        ,OLD.`items_discussed`
        ,OLD.`concluding_remarks_tester`
        ,OLD.`concluding_remarks_ae`
        ,OLD.`concluding_remarks_recommendation`
        ,OLD.`concluding_remarks_name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_mot_test_result_hist`
--

DROP TABLE IF EXISTS `enforcement_mot_test_result_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_test_result_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `re_inspection_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `total_score` smallint(5) unsigned DEFAULT NULL,
  `enforcement_decision_outcome_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `step` varchar(100) DEFAULT NULL,
  `enforcement_decision_reinspection_outcome_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `awl_advice_given` varchar(255) DEFAULT NULL,
  `awl_immediate_attention` varchar(255) DEFAULT NULL,
  `awl_reply_comments` varchar(255) DEFAULT NULL,
  `awl_name_a_ere` varchar(255) DEFAULT NULL,
  `awl_mot_roles` varchar(255) DEFAULT NULL,
  `awl_position_vts` varchar(255) DEFAULT NULL,
  `awl_user_id` varchar(255) DEFAULT NULL,
  `complainant_name` varchar(255) DEFAULT NULL,
  `complaint_detail` varchar(255) DEFAULT NULL,
  `repairs_detail` varchar(255) DEFAULT NULL,
  `complainant_address` varchar(255) DEFAULT NULL,
  `complainant_postcode` varchar(255) DEFAULT NULL,
  `complainant_phone_number` varchar(255) DEFAULT NULL,
  `ve_completed` varchar(255) DEFAULT NULL,
  `agree_vehicle_to_certificate` varchar(255) DEFAULT NULL,
  `input_agree_vehicle_to_certificate` varchar(255) DEFAULT NULL,
  `agree_vehicle_to_fail` varchar(255) DEFAULT NULL,
  `input_agree_vehicle_to_fail` varchar(255) DEFAULT NULL,
  `vehicle_switch` varchar(255) DEFAULT NULL,
  `input_vehicle_switch` varchar(255) DEFAULT NULL,
  `switch_police_status_report` varchar(255) DEFAULT NULL,
  `input_switch_detail_report` varchar(255) DEFAULT NULL,
  `switch_vehicle_result` varchar(255) DEFAULT NULL,
  `input_switch_police_status_report` varchar(255) DEFAULT NULL,
  `promote_sale_interest` varchar(255) DEFAULT NULL,
  `input_promote_sale_interest` varchar(255) DEFAULT NULL,
  `vehicle_defects` varchar(255) DEFAULT NULL,
  `reason_of_defects` varchar(255) DEFAULT NULL,
  `items_discussed` varchar(255) DEFAULT NULL,
  `concluding_remarks_tester` varchar(255) DEFAULT NULL,
  `concluding_remarks_ae` varchar(4000) DEFAULT NULL,
  `concluding_remarks_recommendation` varchar(4000) DEFAULT NULL,
  `concluding_remarks_name` varchar(200) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_enforcement_mot_test_result_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enforcement_mot_test_result_witnesses`
--

DROP TABLE IF EXISTS `enforcement_mot_test_result_witnesses`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_mot_test_result_witnesses` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL COMMENT 'Name of the witness',
  `position` varchar(255) DEFAULT NULL COMMENT 'Recognised position of the witness',
  `enforcement_mot_test_result_id` int(10) unsigned NOT NULL,
  `type` varchar(20) DEFAULT NULL COMMENT 'The type of the witness',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `enforcement_mot_test_result_witnesses_ibfk_1` (`enforcement_mot_test_result_id`),
  CONSTRAINT `fk_enforcement_mot_test_result_witnesses_enforcement_mot_result` FOREIGN KEY (`enforcement_mot_test_result_id`) REFERENCES `enforcement_mot_test_result` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records witnesses to a test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_mot_test_result_witnesses_bi`
BEFORE INSERT ON `mot2`.`enforcement_mot_test_result_witnesses`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_mot_test_result_witnesses_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_site_assessment`
--

DROP TABLE IF EXISTS `enforcement_site_assessment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_site_assessment` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL COMMENT 'The site that was inspected / assessed',
  `ae_organisation_id` int(10) unsigned NOT NULL,
  `site_assessment_score` decimal(9,2) DEFAULT NULL COMMENT 'The final asessment score',
  `ae_representative_person_id` int(11) unsigned DEFAULT NULL,
  `ae_representative_name` varchar(100) DEFAULT NULL COMMENT 'Free text AE or AEs representatives name',
  `ae_representative_position` varchar(100) DEFAULT NULL COMMENT 'Free text AE or AEs representative position in the organisation',
  `tester_person_id` int(10) unsigned DEFAULT NULL COMMENT 'Reference to the tester who was present during the on-site Site assessment',
  `examiner_person_id` int(10) unsigned NOT NULL,
  `visit_date` datetime(6) NOT NULL COMMENT 'The date the visit took place',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_enforcement_site_assessment_ae_representative_person_id` (`ae_representative_person_id`),
  KEY `fk_enforcement_site_assessment_examiner_person_id` (`examiner_person_id`),
  KEY `fk_enforcement_site_assessment_site_id` (`site_id`),
  KEY `fk_enforcement_site_assessment_tester_person_id` (`tester_person_id`),
  CONSTRAINT `fk_enforcement_site_assessment_ae_representative_person_id` FOREIGN KEY (`ae_representative_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_site_assessment_examiner_person_id` FOREIGN KEY (`examiner_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_site_assessment_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_enforcement_site_assessment_tester_person_id` FOREIGN KEY (`tester_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Result table for a site assessment visit scoring';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_site_assessment_bi`
BEFORE INSERT ON `mot2`.`enforcement_site_assessment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_site_assessment_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_site_assessment_bu`
BEFORE UPDATE ON `mot2`.`enforcement_site_assessment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_site_assessment_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_site_assessment_au`
AFTER UPDATE ON `mot2`.`enforcement_site_assessment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_site_assessment_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_site_assessment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`ae_organisation_id`
        ,`site_assessment_score`
        ,`ae_representative_person_id`
        ,`ae_representative_name`
        ,`ae_representative_position`
        ,`tester_person_id`
        ,`examiner_person_id`
        ,`visit_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`ae_organisation_id`
        ,OLD.`site_assessment_score`
        ,OLD.`ae_representative_person_id`
        ,OLD.`ae_representative_name`
        ,OLD.`ae_representative_position`
        ,OLD.`tester_person_id`
        ,OLD.`examiner_person_id`
        ,OLD.`visit_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_site_assessment_bd`
BEFORE DELETE ON `mot2`.`enforcement_site_assessment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_site_assessment_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`enforcement_site_assessment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`ae_organisation_id`
        ,`site_assessment_score`
        ,`ae_representative_person_id`
        ,`ae_representative_name`
        ,`ae_representative_position`
        ,`tester_person_id`
        ,`examiner_person_id`
        ,`visit_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`ae_organisation_id`
        ,OLD.`site_assessment_score`
        ,OLD.`ae_representative_person_id`
        ,OLD.`ae_representative_name`
        ,OLD.`ae_representative_position`
        ,OLD.`tester_person_id`
        ,OLD.`examiner_person_id`
        ,OLD.`visit_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `enforcement_site_assessment_hist`
--

DROP TABLE IF EXISTS `enforcement_site_assessment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_site_assessment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `ae_organisation_id` int(10) unsigned DEFAULT NULL,
  `site_assessment_score` decimal(9,2) DEFAULT NULL,
  `ae_representative_person_id` int(11) unsigned DEFAULT NULL,
  `ae_representative_name` varchar(100) DEFAULT NULL,
  `ae_representative_position` varchar(100) DEFAULT NULL,
  `tester_person_id` int(10) unsigned DEFAULT NULL,
  `examiner_person_id` int(10) unsigned DEFAULT NULL,
  `visit_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_enforcement_site_assessment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `enforcement_visit_outcome_lookup`
--

DROP TABLE IF EXISTS `enforcement_visit_outcome_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `enforcement_visit_outcome_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `description` varchar(50) DEFAULT NULL COMMENT 'Text description of the outcome',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Preferred display order',
  `code` varchar(5) DEFAULT NULL COMMENT 'Internal representation code',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of Enforcement site visit outcomes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_enforcement_visit_outcome_lookup_bi`
BEFORE INSERT ON `mot2`.`enforcement_visit_outcome_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_enforcement_visit_outcome_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment`
--

DROP TABLE IF EXISTS `equipment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `equipment_model_id` int(10) unsigned NOT NULL,
  `site_id` int(10) unsigned NOT NULL,
  `serial_number` varchar(50) NOT NULL,
  `date_added` datetime(6) NOT NULL,
  `date_removed` datetime(6) DEFAULT NULL,
  `equipment_status_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `bk_equipment` (`equipment_model_id`,`site_id`,`serial_number`),
  KEY `equipment_ibfk_2` (`site_id`),
  KEY `equipment_ibfk_3` (`equipment_status_id`),
  CONSTRAINT `equipment_ibfk_1` FOREIGN KEY (`equipment_model_id`) REFERENCES `equipment_model` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `equipment_ibfk_2` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `equipment_ibfk_3` FOREIGN KEY (`equipment_status_id`) REFERENCES `equipment_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='An instance of a piece of equipment at a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_bi`
BEFORE INSERT ON `mot2`.`equipment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_make`
--

DROP TABLE IF EXISTS `equipment_make`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_make` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `bk_equipment_make` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='List of different makes of equipment.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_make_bi`
BEFORE INSERT ON `mot2`.`equipment_make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_make_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_model`
--

DROP TABLE IF EXISTS `equipment_model`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_model` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(8) NOT NULL,
  `name` varchar(100) NOT NULL,
  `equipment_identification_number` varchar(25) DEFAULT NULL COMMENT 'Identifier given by DVSA',
  `equipment_make_id` int(10) unsigned NOT NULL,
  `equipment_type_id` int(10) unsigned NOT NULL,
  `software_version` varchar(20) DEFAULT NULL,
  `certified` date DEFAULT NULL,
  `last_used_date` datetime(6) DEFAULT NULL COMMENT 'After this DATE the status should be changed to WITHDRAWN, column currently for migration only.',
  `last_installable_date` datetime(6) DEFAULT NULL COMMENT 'After this DATE the status should be changed to NOT_INSTALLABLE, column currently for migration only.',
  `equipment_model_status_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `bk_equipment_model` (`code`,`equipment_identification_number`,`equipment_make_id`,`equipment_type_id`),
  KEY `equipment_model_ibfk_1` (`equipment_make_id`),
  KEY `equipment_model_ibfk_2` (`equipment_type_id`),
  KEY `equipment_model_ibfk_5` (`equipment_model_status_id`),
  CONSTRAINT `equipment_model_ibfk_1` FOREIGN KEY (`equipment_make_id`) REFERENCES `equipment_make` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `equipment_model_ibfk_2` FOREIGN KEY (`equipment_type_id`) REFERENCES `equipment_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `equipment_model_ibfk_5` FOREIGN KEY (`equipment_model_status_id`) REFERENCES `equipment_model_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_model_bi`
BEFORE INSERT ON `mot2`.`equipment_model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_model_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_model_status`
--

DROP TABLE IF EXISTS `equipment_model_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_model_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `description` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_equipment_model_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the equipment model status';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_model_status_bi`
BEFORE INSERT ON `mot2`.`equipment_model_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_model_status_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_model_vehicle_class_link`
--

DROP TABLE IF EXISTS `equipment_model_vehicle_class_link`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_model_vehicle_class_link` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `equipment_model_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `bk_equipment_model_vehicle_class_map` (`equipment_model_id`,`vehicle_class_id`),
  KEY `fk_equipment_model_vehicle_class_map_vehicle_class_id` (`vehicle_class_id`),
  CONSTRAINT `fk_equipment_model_vehicle_class_map_equipment_model_id` FOREIGN KEY (`equipment_model_id`) REFERENCES `equipment_model` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_equipment_model_vehicle_class_map_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Used to link a piece of equipment to the vehicle class(es) it is valid for';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_model_vehicle_class_link_bi`
BEFORE INSERT ON `mot2`.`equipment_model_vehicle_class_link`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_model_vehicle_class_link_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_status`
--

DROP TABLE IF EXISTS `equipment_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `description` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_equipment_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of a piece of equipments status';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_status_bi`
BEFORE INSERT ON `mot2`.`equipment_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_status_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `equipment_type`
--

DROP TABLE IF EXISTS `equipment_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `equipment_type` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `bk_equipment_type` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_equipment_type_bi`
BEFORE INSERT ON `mot2`.`equipment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_equipment_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event`
--

DROP TABLE IF EXISTS `event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `event_type_id` smallint(5) unsigned NOT NULL,
  `event_outcome_id` smallint(5) unsigned DEFAULT NULL,
  `description` varchar(500) NOT NULL DEFAULT '',
  `comment_id` bigint(20) unsigned DEFAULT NULL COMMENT 'Optional long description',
  `is_manual_event` tinyint(4) NOT NULL DEFAULT '0',
  `event_date` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_event_comment_id_comment_id` (`comment_id`),
  KEY `fk_event_event_outcome_id_event_outcome_id` (`event_outcome_id`),
  KEY `fk_event_event_type_id_event_type_id` (`event_type_id`),
  CONSTRAINT `fk_event_comment_id_comment_id` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_event_outcome_id_event_outcome_id` FOREIGN KEY (`event_outcome_id`) REFERENCES `event_outcome_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_event_type_id_event_type_id` FOREIGN KEY (`event_type_id`) REFERENCES `event_type_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='System and manual events';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_bi`
BEFORE INSERT ON `mot2`.`event`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_bu`
BEFORE UPDATE ON `mot2`.`event`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_au`
AFTER UPDATE ON `mot2`.`event`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_type_id`
        ,`event_outcome_id`
        ,`description`
        ,`comment_id`
        ,`is_manual_event`
        ,`event_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`event_type_id`
        ,OLD.`event_outcome_id`
        ,OLD.`description`
        ,OLD.`comment_id`
        ,OLD.`is_manual_event`
        ,OLD.`event_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_bd`
BEFORE DELETE ON `mot2`.`event`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_type_id`
        ,`event_outcome_id`
        ,`description`
        ,`comment_id`
        ,`is_manual_event`
        ,`event_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`event_type_id`
        ,OLD.`event_outcome_id`
        ,OLD.`description`
        ,OLD.`comment_id`
        ,OLD.`is_manual_event`
        ,OLD.`event_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_category_lookup`
--

DROP TABLE IF EXISTS `event_category_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_category_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `description` varchar(250) NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  UNIQUE KEY `uk_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Category of events';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_category_lookup_bi`
BEFORE INSERT ON `mot2`.`event_category_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_category_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_hist`
--

DROP TABLE IF EXISTS `event_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `event_type_id` smallint(5) unsigned DEFAULT NULL,
  `event_outcome_id` smallint(5) unsigned DEFAULT NULL,
  `description` varchar(500) DEFAULT NULL,
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `is_manual_event` tinyint(4) DEFAULT NULL,
  `event_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_event_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:07';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `event_organisation_map`
--

DROP TABLE IF EXISTS `event_organisation_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_organisation_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `event_id` int(10) unsigned NOT NULL,
  `organisation_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_event_org_map_event_id_event_id` (`event_id`),
  KEY `fk_event_org_map_org_id_org_id` (`organisation_id`),
  CONSTRAINT `fk_event_org_map_event_id_event_id` FOREIGN KEY (`event_id`) REFERENCES `event` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_org_map_org_id_org_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Map table to join event and organisation';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_organisation_map_bi`
BEFORE INSERT ON `mot2`.`event_organisation_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_organisation_map_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_organisation_map_bu`
BEFORE UPDATE ON `mot2`.`event_organisation_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_organisation_map_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_organisation_map_au`
AFTER UPDATE ON `mot2`.`event_organisation_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_organisation_map_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_organisation_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`organisation_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`organisation_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_organisation_map_bd`
BEFORE DELETE ON `mot2`.`event_organisation_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_organisation_map_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_organisation_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`organisation_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`organisation_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_organisation_map_hist`
--

DROP TABLE IF EXISTS `event_organisation_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_organisation_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `event_id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_event_organisation_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `event_outcome_lookup`
--

DROP TABLE IF EXISTS `event_outcome_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_outcome_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(100) NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  UNIQUE KEY `uk_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Event outcomes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_outcome_lookup_bi`
BEFORE INSERT ON `mot2`.`event_outcome_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_outcome_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_person_map`
--

DROP TABLE IF EXISTS `event_person_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_person_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `event_id` int(10) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_event_person_map_event_id_event_id` (`event_id`),
  KEY `fk_event_person_map_person_id_person_id` (`person_id`),
  CONSTRAINT `fk_event_person_map_event_id_event_id` FOREIGN KEY (`event_id`) REFERENCES `event` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_person_map_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Map table to join event and person';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_person_map_bi`
BEFORE INSERT ON `mot2`.`event_person_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_person_map_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_person_map_bu`
BEFORE UPDATE ON `mot2`.`event_person_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_person_map_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_person_map_au`
AFTER UPDATE ON `mot2`.`event_person_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_person_map_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_person_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`person_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`person_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_person_map_bd`
BEFORE DELETE ON `mot2`.`event_person_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_person_map_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_person_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`person_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`person_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_person_map_hist`
--

DROP TABLE IF EXISTS `event_person_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_person_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `event_id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_event_person_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `event_site_map`
--

DROP TABLE IF EXISTS `event_site_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_site_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `event_id` int(10) unsigned NOT NULL,
  `site_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_event_site_map_event_id_event_id` (`event_id`),
  KEY `fk_event_site_map_site_id_site_id` (`site_id`),
  CONSTRAINT `fk_event_site_map_event_id_event_id` FOREIGN KEY (`event_id`) REFERENCES `event` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_site_map_site_id_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Map table to join event and site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_site_map_bi`
BEFORE INSERT ON `mot2`.`event_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_site_map_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_site_map_bu`
BEFORE UPDATE ON `mot2`.`event_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_site_map_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_site_map_au`
AFTER UPDATE ON `mot2`.`event_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_site_map_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_site_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`site_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`site_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_site_map_bd`
BEFORE DELETE ON `mot2`.`event_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_site_map_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`event_site_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`event_id`
        ,`site_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`event_id`
        ,OLD.`site_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_site_map_hist`
--

DROP TABLE IF EXISTS `event_site_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_site_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `event_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_event_site_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `event_type_lookup`
--

DROP TABLE IF EXISTS `event_type_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_type_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `start_date` date NOT NULL,
  `end_date` date DEFAULT NULL COMMENT 'information is required from the business as to whether end_date is expected for all events',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`),
  UNIQUE KEY `uk_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Event types lookup table. Populated with MOT1 data';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_type_lookup_bi`
BEFORE INSERT ON `mot2`.`event_type_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_type_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `event_type_outcome_category_map`
--

DROP TABLE IF EXISTS `event_type_outcome_category_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `event_type_outcome_category_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `event_type_id` smallint(5) unsigned NOT NULL,
  `event_outcome_id` smallint(5) unsigned NOT NULL,
  `event_category_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_event_type_outcome_category_map_type_outcome_category` (`event_type_id`,`event_outcome_id`,`event_category_id`),
  KEY `fk_event_type_outcome_category_map_event_category_id` (`event_category_id`),
  KEY `fk_event_type_outcome_category_map_event_outcome_id` (`event_outcome_id`),
  CONSTRAINT `fk_event_type_outcome_category_map_event_category_id` FOREIGN KEY (`event_category_id`) REFERENCES `event_category_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_type_outcome_category_map_event_outcome_id` FOREIGN KEY (`event_outcome_id`) REFERENCES `event_outcome_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_event_type_outcome_category_map_event_type_id` FOREIGN KEY (`event_type_id`) REFERENCES `event_type_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Restrict event outcome for a specific event type by categories';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_event_type_outcome_category_map_bi`
BEFORE INSERT ON `mot2`.`event_type_outcome_category_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_event_type_outcome_category_map_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `evidence`
--

DROP TABLE IF EXISTS `evidence`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `evidence` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `document_type_id` smallint(5) unsigned NOT NULL,
  `document_ref` varchar(45) DEFAULT NULL,
  `method_of_delivery_id` smallint(5) unsigned zerofill NOT NULL,
  `recieved_on` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_evidence_bi`
BEFORE INSERT ON `mot2`.`evidence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_evidence_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `experience`
--

DROP TABLE IF EXISTS `experience`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `experience` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `employer` varchar(100) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `date_from` datetime(6) DEFAULT NULL,
  `date_to` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_experience_person` (`person_id`),
  CONSTRAINT `fk_experience_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Experience a person has of work relating to the MOT trade, use in applications';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_experience_bi`
BEFORE INSERT ON `mot2`.`experience`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_experience_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `facility_type`
--

DROP TABLE IF EXISTS `facility_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `facility_type` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_facility_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of facility types at a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_facility_type_bi`
BEFORE INSERT ON `mot2`.`facility_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_facility_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `failure_location_lookup`
--

DROP TABLE IF EXISTS `failure_location_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `failure_location_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Location of a failure';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_failure_location_lookup_bi`
BEFORE INSERT ON `mot2`.`failure_location_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_failure_location_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `fuel_type`
--

DROP TABLE IF EXISTS `fuel_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `fuel_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `dvla_propulsion_code` varchar(2) CHARACTER SET latin1 DEFAULT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_fuel_type_code` (`code`),
  UNIQUE KEY `uk_fuel_type_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of the various fuel types';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_fuel_type_bi`
BEFORE INSERT ON `mot2`.`fuel_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_fuel_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `gender`
--

DROP TABLE IF EXISTS `gender`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `gender` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='normalisation of a persons gender';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_gender_bi`
BEFORE INSERT ON `mot2`.`gender`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_gender_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `identifying_token`
--

DROP TABLE IF EXISTS `identifying_token`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `identifying_token` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `serial_number` varchar(20) DEFAULT NULL,
  `token_lookup_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_identifying_token_token_lookup1` (`token_lookup_id`),
  CONSTRAINT `fk_identifying_token_token_lookup1` FOREIGN KEY (`token_lookup_id`) REFERENCES `token_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_identifying_token_bi`
BEFORE INSERT ON `mot2`.`identifying_token`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_identifying_token_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `incognito_vehicle`
--

DROP TABLE IF EXISTS `incognito_vehicle`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `incognito_vehicle` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_id` int(10) unsigned NOT NULL,
  `start_date` datetime DEFAULT NULL,
  `end_date` datetime DEFAULT NULL,
  `test_date` date DEFAULT NULL COMMENT 'visible date of last test',
  `expiry_date` date DEFAULT NULL COMMENT 'visible expiry date',
  `site_id` int(10) unsigned DEFAULT NULL COMMENT 'AO for this Vehicle',
  `person_id` int(10) unsigned DEFAULT NULL COMMENT 'VE for this vehicle',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_incognito_vehicle_person_id` (`person_id`),
  KEY `fk_incognito_vehicle_site_id` (`site_id`),
  KEY `fk_incognito_vehicle_vehicle_id` (`vehicle_id`),
  CONSTRAINT `fk_incognito_vehicle_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_incognito_vehicle_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_incognito_vehicle_vehicle_id` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_incognito_vehicle_bi`
BEFORE INSERT ON `mot2`.`incognito_vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_incognito_vehicle_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `jasper_document`
--

DROP TABLE IF EXISTS `jasper_document`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_document` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `template_id` int(10) unsigned NOT NULL,
  `document_content` text COMMENT 'Column to store serialised data (json) used by jasper reports o generate documents. Max length 64k',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_jasper_document_template` (`template_id`),
  CONSTRAINT `fk_jasper_document_template` FOREIGN KEY (`template_id`) REFERENCES `jasper_template` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Jasper Reports related table.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_document_bi`
BEFORE INSERT ON `mot2`.`jasper_document`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_document_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_document_bu`
BEFORE UPDATE ON `mot2`.`jasper_document`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_document_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_document_au`
AFTER UPDATE ON `mot2`.`jasper_document`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_document_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`jasper_document_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`template_id`
        ,`document_content`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`template_id`
        ,OLD.`document_content`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_document_bd`
BEFORE DELETE ON `mot2`.`jasper_document`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_document_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`jasper_document_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`template_id`
        ,`document_content`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`template_id`
        ,OLD.`document_content`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `jasper_document_hist`
--

DROP TABLE IF EXISTS `jasper_document_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_document_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `template_id` int(10) unsigned DEFAULT NULL,
  `document_content` text,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_jasper_document_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `jasper_hard_copy`
--

DROP TABLE IF EXISTS `jasper_hard_copy`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_hard_copy` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `file_path` varchar(255) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `hard_copy_ibfk_1` (`document_id`),
  CONSTRAINT `hard_copy_ibfk_1` FOREIGN KEY (`document_id`) REFERENCES `jasper_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Jasper Reports related table.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_hard_copy_bi`
BEFORE INSERT ON `mot2`.`jasper_hard_copy`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_hard_copy_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `jasper_template`
--

DROP TABLE IF EXISTS `jasper_template`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_template` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `template_type_id` int(10) unsigned NOT NULL,
  `jasper_report_name` varchar(255) NOT NULL,
  `is_active` tinyint(4) NOT NULL,
  `active_from` datetime(6) NOT NULL,
  `active_to` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_jasper_template_jasper_template_type` (`template_type_id`),
  CONSTRAINT `fk_jasper_template_jasper_template_type` FOREIGN KEY (`template_type_id`) REFERENCES `jasper_template_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Jasper Reports related table.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_template_bi`
BEFORE INSERT ON `mot2`.`jasper_template`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_template_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `jasper_template_type`
--

DROP TABLE IF EXISTS `jasper_template_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_template_type` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Jasper Reports related table.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_template_type_bi`
BEFORE INSERT ON `mot2`.`jasper_template_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_template_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `jasper_template_variation`
--

DROP TABLE IF EXISTS `jasper_template_variation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `jasper_template_variation` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `template_id` int(10) unsigned NOT NULL,
  `name` varchar(255) NOT NULL,
  `jasper_report_name` varchar(255) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `jasper_template_variation_ibfk_1` (`template_id`),
  CONSTRAINT `jasper_template_variation_ibfk_1` FOREIGN KEY (`template_id`) REFERENCES `jasper_template` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Jasper Reports related table.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_jasper_template_variation_bi`
BEFORE INSERT ON `mot2`.`jasper_template_variation`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_jasper_template_variation_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `language_type`
--

DROP TABLE IF EXISTS `language_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `language_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Written languages used in application';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_language_type_bi`
BEFORE INSERT ON `mot2`.`language_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_language_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `licence`
--

DROP TABLE IF EXISTS `licence`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `licence` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `licence_number` varchar(45) NOT NULL,
  `licence_type_id` smallint(5) unsigned NOT NULL,
  `licence_country_id` bigint(20) unsigned DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_licence_licence_country_id` (`licence_country_id`),
  KEY `fk_licence_licence_type` (`licence_type_id`),
  CONSTRAINT `fk_licence_licence_country_id` FOREIGN KEY (`licence_country_id`) REFERENCES `licence_country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_licence_licence_type` FOREIGN KEY (`licence_type_id`) REFERENCES `licence_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='License held by a person, such as drivers license';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_bi`
BEFORE INSERT ON `mot2`.`licence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_bu`
BEFORE UPDATE ON `mot2`.`licence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_au`
AFTER UPDATE ON `mot2`.`licence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`licence_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`licence_number`
        ,`licence_type_id`
        ,`licence_country_id`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`licence_number`
        ,OLD.`licence_type_id`
        ,OLD.`licence_country_id`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_bd`
BEFORE DELETE ON `mot2`.`licence`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`licence_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`licence_number`
        ,`licence_type_id`
        ,`licence_country_id`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`licence_number`
        ,OLD.`licence_type_id`
        ,OLD.`licence_country_id`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `licence_country_lookup`
--

DROP TABLE IF EXISTS `licence_country_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `licence_country_lookup` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Lookup for a licence''s issuing country';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_country_lookup_bi`
BEFORE INSERT ON `mot2`.`licence_country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_country_lookup_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `licence_hist`
--

DROP TABLE IF EXISTS `licence_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `licence_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `licence_number` varchar(45) DEFAULT NULL,
  `licence_type_id` smallint(5) unsigned DEFAULT NULL,
  `licence_country_id` bigint(20) unsigned DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_licence_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `licence_type`
--

DROP TABLE IF EXISTS `licence_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `licence_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_licence_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Type of license i.e. Driving Licence';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_licence_type_bi`
BEFORE INSERT ON `mot2`.`licence_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_licence_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `make`
--

DROP TABLE IF EXISTS `make`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `make` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) DEFAULT NULL,
  `is_verified` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'Verified and visible for dropdowns etc',
  `is_selectable` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ux_make_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Vehicle makes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_make_bi`
BEFORE INSERT ON `mot2`.`make`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_make_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `message`
--

DROP TABLE IF EXISTS `message`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `message` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `message_type_id` smallint(5) unsigned NOT NULL,
  `issue_date` datetime DEFAULT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `is_acknowledged` tinyint(4) NOT NULL DEFAULT '0',
  `token` varchar(64) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_message_token` (`token`),
  KEY `fk_message_message_type1` (`message_type_id`),
  KEY `fk_message_person` (`person_id`),
  CONSTRAINT `fk_message_message_type1` FOREIGN KEY (`message_type_id`) REFERENCES `message_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_message_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Messages sent from the system i.e. Forgotten password';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_bi`
BEFORE INSERT ON `mot2`.`message`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_bu`
BEFORE UPDATE ON `mot2`.`message`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_au`
AFTER UPDATE ON `mot2`.`message`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`message_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`message_type_id`
        ,`issue_date`
        ,`expiry_date`
        ,`is_acknowledged`
        ,`token`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`message_type_id`
        ,OLD.`issue_date`
        ,OLD.`expiry_date`
        ,OLD.`is_acknowledged`
        ,OLD.`token`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_bd`
BEFORE DELETE ON `mot2`.`message`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`message_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`message_type_id`
        ,`issue_date`
        ,`expiry_date`
        ,`is_acknowledged`
        ,`token`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`message_type_id`
        ,OLD.`issue_date`
        ,OLD.`expiry_date`
        ,OLD.`is_acknowledged`
        ,OLD.`token`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `message_content`
--

DROP TABLE IF EXISTS `message_content`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `message_content` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `message_id` int(10) unsigned NOT NULL,
  `recipient_email` varchar(255) NOT NULL,
  `title` varchar(100) NOT NULL,
  `content` text NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_message_content_message1` (`message_id`),
  CONSTRAINT `fk_message_content_message1` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Content of messages sent from the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_content_bi`
BEFORE INSERT ON `mot2`.`message_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_content_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `message_hist`
--

DROP TABLE IF EXISTS `message_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `message_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `message_type_id` smallint(5) unsigned DEFAULT NULL,
  `issue_date` datetime DEFAULT NULL,
  `expiry_date` datetime DEFAULT NULL,
  `is_acknowledged` tinyint(4) DEFAULT NULL,
  `token` varchar(64) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_message_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `message_type`
--

DROP TABLE IF EXISTS `message_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `message_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `expiry_period` smallint(6) unsigned DEFAULT NULL COMMENT 'How long after sending do URLs expire (in hours)',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_message_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Types of messages i.e. Forgotten password, Username reminder etc';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_type_bi`
BEFORE INSERT ON `mot2`.`message_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_type_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `message_url`
--

DROP TABLE IF EXISTS `message_url`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `message_url` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `message_id` int(10) unsigned NOT NULL,
  `url_type_id` smallint(5) unsigned NOT NULL,
  `name` varchar(100) NOT NULL,
  `url` varchar(255) NOT NULL,
  `used_count` smallint(6) unsigned NOT NULL DEFAULT '0',
  `is_expired` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_message_url_message1` (`message_id`),
  KEY `fk_message_url_url_type1` (`url_type_id`),
  CONSTRAINT `fk_message_url_message1` FOREIGN KEY (`message_id`) REFERENCES `message` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_message_url_url_type1` FOREIGN KEY (`url_type_id`) REFERENCES `url_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='URLs used in messages';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_message_url_bi`
BEFORE INSERT ON `mot2`.`message_url`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_message_url_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model`
--

DROP TABLE IF EXISTS `model`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `make_id` int(10) unsigned NOT NULL,
  `code` varchar(5) DEFAULT NULL COMMENT 'NULL for non DVLA models',
  `name` varchar(50) NOT NULL,
  `is_verified` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `ddr_make_id_model_name_unq` (`make_id`,`name`),
  CONSTRAINT `fk_model_make_id` FOREIGN KEY (`make_id`) REFERENCES `make` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Vehicle models';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_bi`
BEFORE INSERT ON `mot2`.`model`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model_detail`
--

DROP TABLE IF EXISTS `model_detail`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model_detail` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `model_id` int(10) unsigned DEFAULT NULL,
  `is_verified` tinyint(4) NOT NULL DEFAULT '0',
  `vehicle_class_id` smallint(5) unsigned DEFAULT NULL,
  `body_type_id` smallint(5) unsigned DEFAULT NULL,
  `fuel_type_id` smallint(5) unsigned DEFAULT NULL,
  `wheelplan_type_id` smallint(5) unsigned DEFAULT NULL,
  `transmission_type_id` smallint(5) unsigned DEFAULT NULL,
  `eu_classification` varchar(2) DEFAULT NULL,
  `cylinder_capacity` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `sha1_concat_ws_chksum` char(40) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `model_detail_sha1_unq` (`sha1_concat_ws_chksum`) COMMENT 'unique index to allow model_details to be derived from the vehicle table',
  KEY `fk_model_detail_model_id` (`model_id`),
  KEY `fk_model_detail_vehicle_class_id` (`vehicle_class_id`),
  KEY `fk_model_detail_body_type_id` (`body_type_id`),
  KEY `fk_model_detail_fuel_type_id` (`fuel_type_id`),
  KEY `fk_model_detail_transmission_type_id` (`transmission_type_id`),
  CONSTRAINT `fk_model_detail_body_type_id` FOREIGN KEY (`body_type_id`) REFERENCES `body_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_model_detail_fuel_type_id` FOREIGN KEY (`fuel_type_id`) REFERENCES `fuel_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_model_detail_model_id` FOREIGN KEY (`model_id`) REFERENCES `model` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_model_detail_transmission_type_id` FOREIGN KEY (`transmission_type_id`) REFERENCES `transmission_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_model_detail_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Model detail that would have come from the VSI.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_detail_bi`
BEFORE INSERT ON `mot2`.`model_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_detail_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model_technical_data`
--

DROP TABLE IF EXISTS `model_technical_data`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model_technical_data` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `sub_model_name` varchar(100) DEFAULT NULL COMMENT 'Additional info to differentiate technical data within a model range',
  `model_id` int(10) unsigned NOT NULL,
  `fuel_type_id` smallint(6) DEFAULT NULL,
  `manufacture_start_date` datetime DEFAULT NULL,
  `manufacture_end_date` datetime DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_model_technical_data_created_by` (`created_by`),
  KEY `ix_model_technical_data_last_updated_by` (`last_updated_by`),
  KEY `ix_model_technical_data_fuel_type_id` (`fuel_type_id`),
  KEY `ix_model_technical_data_model_id` (`model_id`),
  KEY `ix_model_technical_data_model_id_manufacture_date` (`model_id`,`manufacture_start_date`),
  CONSTRAINT `fk_model_technical_data_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_model_id_model_id` FOREIGN KEY (`model_id`) REFERENCES `model` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_bi`
BEFORE INSERT ON `mot2`.`model_technical_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_bi Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_bu`
BEFORE UPDATE ON `mot2`.`model_technical_data`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_bu Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model_technical_data_category`
--

DROP TABLE IF EXISTS `model_technical_data_category`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model_technical_data_category` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL COMMENT 'Short description of model technical data category',
  `display_order` smallint(5) unsigned DEFAULT NULL COMMENT 'To allow VTD to be ordered by category in a prescribed manner',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_model_technical_data_category_created_by` (`created_by`),
  KEY `ix_model_technical_data_category_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_model_technical_data_category_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_category_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_category_bi`
BEFORE INSERT ON `mot2`.`model_technical_data_category`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_category_bi Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_category_bu`
BEFORE UPDATE ON `mot2`.`model_technical_data_category`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_category_bu Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model_technical_data_content`
--

DROP TABLE IF EXISTS `model_technical_data_content`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model_technical_data_content` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `short_description` varchar(50) NOT NULL COMMENT 'Short summary of model technical data description',
  `description` varchar(4000) NOT NULL COMMENT 'Full vehicle technical information for tester',
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `model_technical_data_category_id` bigint(20) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_model_technical_data_content_created_by` (`created_by`),
  KEY `ix_model_technical_data_content_last_updated_by` (`last_updated_by`),
  KEY `ix_model_technical_data_content_model_technical_data_category_id` (`model_technical_data_category_id`),
  CONSTRAINT `fk_model_technical_data_content_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_content_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_content_model_technical_data_category_id` FOREIGN KEY (`model_technical_data_category_id`) REFERENCES `model_technical_data_category` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_content_bi`
BEFORE INSERT ON `mot2`.`model_technical_data_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_content_bi Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_content_bu`
BEFORE UPDATE ON `mot2`.`model_technical_data_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_content_bu Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `model_technical_data_content_map`
--

DROP TABLE IF EXISTS `model_technical_data_content_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `model_technical_data_content_map` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `model_technical_data_id` bigint(20) unsigned NOT NULL,
  `model_technical_data_content_id` bigint(20) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_model_technical_data_content_map_created_by` (`created_by`),
  KEY `ix_model_technical_data_content_map_last_updated_by` (`last_updated_by`),
  KEY `ix_model_technical_data_content_map_model_technical_data_id` (`model_technical_data_id`),
  KEY `ix_model_technical_data_content_map_mtd_content_id` (`model_technical_data_content_id`),
  CONSTRAINT `fk_model_technical_data_content_map_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_content_map_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_model_technical_data_content_map_model_technical_data_id` FOREIGN KEY (`model_technical_data_id`) REFERENCES `model_technical_data` (`id`),
  CONSTRAINT `fk_model_technical_data_content_map_mtd_content_id` FOREIGN KEY (`model_technical_data_content_id`) REFERENCES `model_technical_data_content` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_content_map_bi`
BEFORE INSERT ON `mot2`.`model_technical_data_content_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_content_map_bi Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_model_technical_data_content_map_bu`
BEFORE UPDATE ON `mot2`.`model_technical_data_content_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_model_technical_data_content_map_bu Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot1_vts_device_status`
--

DROP TABLE IF EXISTS `mot1_vts_device_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot1_vts_device_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot1_vts_device_status_bi`
BEFORE INSERT ON `mot2`.`mot1_vts_device_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot1_vts_device_status_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_address_comment`
--

DROP TABLE IF EXISTS `mot_test_address_comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_address_comment` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'Reference to mot_test_current.id or mot_test_history.id',
  `address_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_address_comment_comment` (`address_comment_id`),
  CONSTRAINT `fk_mot_test_address_comment_comment` FOREIGN KEY (`address_comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_address_comment_bi`
BEFORE INSERT ON `mot2`.`mot_test_address_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_address_comment_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_address_comment_bu`
BEFORE UPDATE ON `mot2`.`mot_test_address_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_address_comment_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_address_comment_au`
AFTER UPDATE ON `mot2`.`mot_test_address_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_address_comment_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_address_comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`address_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`address_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_address_comment_bd`
BEFORE DELETE ON `mot2`.`mot_test_address_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_address_comment_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_address_comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`address_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`address_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_address_comment_hist`
--

DROP TABLE IF EXISTS `mot_test_address_comment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_address_comment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `address_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_address_comment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_cancelled`
--

DROP TABLE IF EXISTS `mot_test_cancelled`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_cancelled` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'Reference to mot_test_current.id or mot_test_history.id',
  `mot_test_reason_for_cancel_id` smallint(5) unsigned DEFAULT NULL,
  `reason_for_cancel_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_cancelled_comment` (`reason_for_cancel_comment_id`),
  KEY `fk_mot_test_cancelled_mot_test_reason_for_cancel` (`mot_test_reason_for_cancel_id`),
  CONSTRAINT `fk_mot_test_cancelled_comment` FOREIGN KEY (`reason_for_cancel_comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_cancelled_mot_test_reason_for_cancel` FOREIGN KEY (`mot_test_reason_for_cancel_id`) REFERENCES `mot_test_reason_for_cancel_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_cancelled_bi`
BEFORE INSERT ON `mot2`.`mot_test_cancelled`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_cancelled_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_cancelled_bu`
BEFORE UPDATE ON `mot2`.`mot_test_cancelled`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_cancelled_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_cancelled_au`
AFTER UPDATE ON `mot2`.`mot_test_cancelled`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_cancelled_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_cancelled_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_reason_for_cancel_id`
        ,`reason_for_cancel_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_reason_for_cancel_id`
        ,OLD.`reason_for_cancel_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_cancelled_bd`
BEFORE DELETE ON `mot2`.`mot_test_cancelled`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_cancelled_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_cancelled_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_reason_for_cancel_id`
        ,`reason_for_cancel_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_reason_for_cancel_id`
        ,OLD.`reason_for_cancel_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_cancelled_hist`
--

DROP TABLE IF EXISTS `mot_test_cancelled_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_cancelled_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_reason_for_cancel_id` smallint(5) unsigned DEFAULT NULL,
  `reason_for_cancel_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_cancelled_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_complaint_ref`
--

DROP TABLE IF EXISTS `mot_test_complaint_ref`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_complaint_ref` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'FK to mot_test_current.id',
  `complaint_ref` varchar(30) NOT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_complaint_ref_bi`
BEFORE INSERT ON `mot2`.`mot_test_complaint_ref`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_complaint_ref_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_complaint_ref_bu`
BEFORE UPDATE ON `mot2`.`mot_test_complaint_ref`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_complaint_ref_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_complaint_ref_au`
AFTER UPDATE ON `mot2`.`mot_test_complaint_ref`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_complaint_ref_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_complaint_ref_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`complaint_ref`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`complaint_ref`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_complaint_ref_bd`
BEFORE DELETE ON `mot2`.`mot_test_complaint_ref`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_complaint_ref_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_complaint_ref_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`complaint_ref`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`complaint_ref`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_complaint_ref_hist`
--

DROP TABLE IF EXISTS `mot_test_complaint_ref_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_complaint_ref_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `complaint_ref` varchar(30) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_complaint_ref_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_current`
--

DROP TABLE IF EXISTS `mot_test_current`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_current` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `vehicle_id` int(10) unsigned NOT NULL,
  `vehicle_version` int(10) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `has_registration` tinyint(4) unsigned NOT NULL,
  `mot_test_type_id` smallint(5) unsigned NOT NULL,
  `started_date` datetime(6) NOT NULL COMMENT 'It is populated by application due to contingency testing',
  `completed_date` datetime(6) DEFAULT NULL,
  `submitted_date` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `issued_date` datetime(6) DEFAULT NULL,
  `expiry_date` date DEFAULT NULL,
  `mot_test_id_original` bigint(20) unsigned DEFAULT NULL,
  `prs_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `number` decimal(12,0) DEFAULT NULL COMMENT 'Non-sequential Test number',
  `vehicle_weight_source_lookup_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Source of vehicle_weight',
  `vehicle_weight` int(10) unsigned DEFAULT NULL COMMENT 'Brake test weight from MOT1 VEHTESTBRAKEWEIGHT should be used in the calculation of brake efficiency. Recorded in kilograms. Migrated from MOT1 as brake test are not migrated',
  `incognito_vehicle_id` int(10) unsigned DEFAULT NULL,
  `odometer_value` int(10) unsigned DEFAULT NULL COMMENT 'Updated during test so multiple odometer values may exist over test lifetime',
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `client_ip` varchar(45) DEFAULT '0.0.0.0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mot_test_number` (`number`) USING HASH,
  KEY `fk_mot_test_current_vehicle` (`vehicle_id`),
  KEY `fk_mot_test_current_jasper_document` (`document_id`),
  KEY `fk_mot_test_current_mot_test_type` (`mot_test_type_id`),
  KEY `fk_mot_test_current_status` (`status_id`),
  KEY `fk_mot_test_current_vehicle_weight_source_lookup` (`vehicle_weight_source_lookup_id`),
  KEY `fk_mot_test_current_incognito_vehicle` (`incognito_vehicle_id`),
  KEY `ix_mot_test_current_last_updated_on` (`last_updated_on`),
  KEY `ix_mot_test_current_completed_date` (`completed_date`),
  KEY `ix_mot_test_current_submitted_date` (`submitted_date`),
  KEY `ix_mot_test_current_site_id_started_date_completed_date` (`site_id`,`started_date`,`completed_date`),
  KEY `ix_mot_test_current_person_id_started_date_completed_date` (`person_id`,`started_date`,`completed_date`),
  KEY `ix_mot_test_current_site_id_status_id` (`site_id`,`status_id`),
  KEY `ix_mot_test_current_person_id_status_id` (`person_id`,`status_id`),
  KEY `ix_mot_test_current_mot_test_id_original` (`mot_test_id_original`),
  KEY `ix_mot_test_current_prs_mot_test_id` (`prs_mot_test_id`),
  CONSTRAINT `fk_mot_test_current_incognito_vehicle` FOREIGN KEY (`incognito_vehicle_id`) REFERENCES `incognito_vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_jasper_document` FOREIGN KEY (`document_id`) REFERENCES `jasper_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_mot_test_type` FOREIGN KEY (`mot_test_type_id`) REFERENCES `mot_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_status` FOREIGN KEY (`status_id`) REFERENCES `mot_test_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_vehicle` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_vehicle_weight_source_lookup` FOREIGN KEY (`vehicle_weight_source_lookup_id`) REFERENCES `weight_source_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_bi`
BEFORE INSERT ON `mot2`.`mot_test_current`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    DECLARE c_active_status_id INTEGER DEFAULT 4;

    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;

    IF (NEW.`status_id` != c_active_status_id AND NEW.`completed_date` IS NULL)
    THEN
        SIGNAL SQLSTATE '10001' SET MESSAGE_TEXT = 'completed_date needs to be set for non ACTIVE mot tests';
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_bu`
BEFORE UPDATE ON `mot2`.`mot_test_current`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    DECLARE c_active_status_id INTEGER DEFAULT 4;

    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;

    IF (NEW.`status_id` != c_active_status_id AND NEW.`completed_date` IS NULL)
    THEN
        SIGNAL SQLSTATE '10001' SET MESSAGE_TEXT = 'completed_date needs to be set for non ACTIVE mot tests';
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_au`
AFTER UPDATE ON `mot2`.`mot_test_current`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_au Generated on 2016-12-12 11:29:01. $Id$';
    
    DECLARE v_mot_test_current_status_code VARCHAR(5);

    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_current_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_id`
        ,`vehicle_version`
        ,`document_id`
        ,`organisation_id`
        ,`site_id`
        ,`has_registration`
        ,`mot_test_type_id`
        ,`started_date`
        ,`completed_date`
        ,`submitted_date`
        ,`status_id`
        ,`issued_date`
        ,`expiry_date`
        ,`mot_test_id_original`
        ,`prs_mot_test_id`
        ,`number`
        ,`vehicle_weight_source_lookup_id`
        ,`vehicle_weight`
        ,`incognito_vehicle_id`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`client_ip`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_id`
        ,OLD.`vehicle_version`
        ,OLD.`document_id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`has_registration`
        ,OLD.`mot_test_type_id`
        ,OLD.`started_date`
        ,OLD.`completed_date`
        ,OLD.`submitted_date`
        ,OLD.`status_id`
        ,OLD.`issued_date`
        ,OLD.`expiry_date`
        ,OLD.`mot_test_id_original`
        ,OLD.`prs_mot_test_id`
        ,OLD.`number`
        ,OLD.`vehicle_weight_source_lookup_id`
        ,OLD.`vehicle_weight`
        ,OLD.`incognito_vehicle_id`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`client_ip`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_bd`
BEFORE DELETE ON `mot2`.`mot_test_current`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_current_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_id`
        ,`vehicle_version`
        ,`document_id`
        ,`organisation_id`
        ,`site_id`
        ,`has_registration`
        ,`mot_test_type_id`
        ,`started_date`
        ,`completed_date`
        ,`submitted_date`
        ,`status_id`
        ,`issued_date`
        ,`expiry_date`
        ,`mot_test_id_original`
        ,`prs_mot_test_id`
        ,`number`
        ,`vehicle_weight_source_lookup_id`
        ,`vehicle_weight`
        ,`incognito_vehicle_id`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`client_ip`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_id`
        ,OLD.`vehicle_version`
        ,OLD.`document_id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`has_registration`
        ,OLD.`mot_test_type_id`
        ,OLD.`started_date`
        ,OLD.`completed_date`
        ,OLD.`submitted_date`
        ,OLD.`status_id`
        ,OLD.`issued_date`
        ,OLD.`expiry_date`
        ,OLD.`mot_test_id_original`
        ,OLD.`prs_mot_test_id`
        ,OLD.`number`
        ,OLD.`vehicle_weight_source_lookup_id`
        ,OLD.`vehicle_weight`
        ,OLD.`incognito_vehicle_id`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`client_ip`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_current_hist`
--

DROP TABLE IF EXISTS `mot_test_current_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_current_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `vehicle_version` int(10) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `has_registration` tinyint(4) unsigned DEFAULT NULL,
  `mot_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `started_date` datetime(6) DEFAULT NULL,
  `completed_date` datetime(6) DEFAULT NULL,
  `submitted_date` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `issued_date` datetime(6) DEFAULT NULL,
  `expiry_date` date DEFAULT NULL,
  `mot_test_id_original` bigint(20) unsigned DEFAULT NULL,
  `prs_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `number` decimal(12,0) DEFAULT NULL,
  `vehicle_weight_source_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_weight` int(10) unsigned DEFAULT NULL,
  `incognito_vehicle_id` int(10) unsigned DEFAULT NULL,
  `odometer_value` int(10) unsigned DEFAULT NULL,
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `client_ip` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_current_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:53';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_current_rfr_map`
--

DROP TABLE IF EXISTS `mot_test_current_rfr_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_current_rfr_map` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `rfr_type_id` int(10) unsigned NOT NULL,
  `mot_test_rfr_location_type_id` smallint(5) unsigned DEFAULT NULL,
  `failure_dangerous` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'User option available when can_be_dangerous flag is set in test_item_selector_rfr',
  `generated` tinyint(4) NOT NULL,
  `on_original_test` tinyint(4) NOT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_current_rfr_map_reason_for_rejection_type` (`rfr_type_id`),
  KEY `fk_mot_test_current_rfr_map_reason_for_rejection` (`rfr_id`),
  KEY `fk_mot_test_current_rfr_map_mot_test_rfr_location_type` (`mot_test_rfr_location_type_id`),
  KEY `ix_mot_test_current_rfr_map_last_updated_on` (`last_updated_on`),
  KEY `ix_mot_test_current_rfr_map_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_mot_test_current_rfr_map_mot_test_rfr_location_type` FOREIGN KEY (`mot_test_rfr_location_type_id`) REFERENCES `mot_test_rfr_location_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_rfr_map_reason_for_rejection` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_current_rfr_map_reason_for_rejection_type` FOREIGN KEY (`rfr_type_id`) REFERENCES `reason_for_rejection_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records the RFR details of vehicle tests';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_rfr_map_bi`
BEFORE INSERT ON `mot2`.`mot_test_current_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_rfr_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_rfr_map_bu`
BEFORE UPDATE ON `mot2`.`mot_test_current_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_rfr_map_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_rfr_map_au`
AFTER UPDATE ON `mot2`.`mot_test_current_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_rfr_map_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_current_rfr_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`rfr_id`
        ,`rfr_type_id`
        ,`mot_test_rfr_location_type_id`
        ,`failure_dangerous`
        ,`generated`
        ,`on_original_test`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`rfr_id`
        ,OLD.`rfr_type_id`
        ,OLD.`mot_test_rfr_location_type_id`
        ,OLD.`failure_dangerous`
        ,OLD.`generated`
        ,OLD.`on_original_test`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_current_rfr_map_bd`
BEFORE DELETE ON `mot2`.`mot_test_current_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_current_rfr_map_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_current_rfr_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`rfr_id`
        ,`rfr_type_id`
        ,`mot_test_rfr_location_type_id`
        ,`failure_dangerous`
        ,`generated`
        ,`on_original_test`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`rfr_id`
        ,OLD.`rfr_type_id`
        ,OLD.`mot_test_rfr_location_type_id`
        ,OLD.`failure_dangerous`
        ,OLD.`generated`
        ,OLD.`on_original_test`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_current_rfr_map_hist`
--

DROP TABLE IF EXISTS `mot_test_current_rfr_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_current_rfr_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `rfr_type_id` int(10) unsigned DEFAULT NULL,
  `mot_test_rfr_location_type_id` smallint(5) unsigned DEFAULT NULL,
  `failure_dangerous` tinyint(4) DEFAULT NULL,
  `generated` tinyint(4) DEFAULT NULL,
  `on_original_test` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_current_rfr_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_emergency_reason`
--

DROP TABLE IF EXISTS `mot_test_emergency_reason`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_emergency_reason` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'FK to mot_test_current.id',
  `emergency_log_id` int(10) unsigned DEFAULT NULL COMMENT 'This should be only have an entry if the Test is an emergency/contingency Test',
  `emergency_reason_lookup_id` smallint(5) unsigned DEFAULT NULL COMMENT 'An emergency/contingency Test should always have an emergency reason entered by the Tester or the person who enters the Test on the system',
  `emergency_reason_comment_id` bigint(20) unsigned DEFAULT NULL COMMENT 'Free text comments should be only be entered when the emergency_reason_lookup_id is "Other"',
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_emergency_reason_emergency_log` (`emergency_log_id`),
  KEY `fk_mot_test_emergency_reason_emergency_reason_comment` (`emergency_reason_comment_id`),
  KEY `fk_mot_test_emergency_reason_emergency_reason_lookup` (`emergency_reason_lookup_id`),
  CONSTRAINT `fk_mot_test_emergency_reason_emergency_log` FOREIGN KEY (`emergency_log_id`) REFERENCES `emergency_log` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_emergency_reason_emergency_reason_comment` FOREIGN KEY (`emergency_reason_comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_emergency_reason_emergency_reason_lookup` FOREIGN KEY (`emergency_reason_lookup_id`) REFERENCES `emergency_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_emergency_reason_bi`
BEFORE INSERT ON `mot2`.`mot_test_emergency_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_emergency_reason_bi Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_emergency_reason_bu`
BEFORE UPDATE ON `mot2`.`mot_test_emergency_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_emergency_reason_bu Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_emergency_reason_au`
AFTER UPDATE ON `mot2`.`mot_test_emergency_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_emergency_reason_au Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_emergency_reason_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`emergency_log_id`
        ,`emergency_reason_lookup_id`
        ,`emergency_reason_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`emergency_log_id`
        ,OLD.`emergency_reason_lookup_id`
        ,OLD.`emergency_reason_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_emergency_reason_bd`
BEFORE DELETE ON `mot2`.`mot_test_emergency_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_emergency_reason_bd Generated on 2016-12-12 11:29:00. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_emergency_reason_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`emergency_log_id`
        ,`emergency_reason_lookup_id`
        ,`emergency_reason_comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`emergency_log_id`
        ,OLD.`emergency_reason_lookup_id`
        ,OLD.`emergency_reason_comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_emergency_reason_hist`
--

DROP TABLE IF EXISTS `mot_test_emergency_reason_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_emergency_reason_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `emergency_log_id` int(10) unsigned DEFAULT NULL,
  `emergency_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `emergency_reason_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_emergency_reason_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_event`
--

DROP TABLE IF EXISTS `mot_test_event`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_event` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `mot_test_version` smallint(5) unsigned NOT NULL COMMENT 'version of test to identify record in history table if not current record',
  `tester_person_id` int(10) unsigned DEFAULT NULL COMMENT 'Person who entered/completed the test/certificate reissue data',
  `certificate_status_id` smallint(5) unsigned NOT NULL,
  `different_tester_reason_id` smallint(5) unsigned DEFAULT NULL,
  `reason_comment_id` bigint(20) unsigned DEFAULT NULL COMMENT 'Free text for further clarification of reason for different tester',
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_certificate_status` (`certificate_status_id`),
  KEY `fk_mot_test_different_tester_reason_id_lookup` (`different_tester_reason_id`),
  KEY `fk_mot_test_event_mot_test_id` (`mot_test_id`),
  KEY `fk_mot_test_reason` (`reason_comment_id`),
  KEY `fk_test_event_document` (`document_id`),
  KEY `fk_test_event_person` (`tester_person_id`),
  KEY `ix_mot_test_event_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_mot_test_certificate_status` FOREIGN KEY (`certificate_status_id`) REFERENCES `certificate_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_different_tester_reason_id_lookup` FOREIGN KEY (`different_tester_reason_id`) REFERENCES `certificate_change_different_tester_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_reason` FOREIGN KEY (`reason_comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_event_document` FOREIGN KEY (`document_id`) REFERENCES `jasper_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_event_person` FOREIGN KEY (`tester_person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records details of a vehicle test (including non-MOT) with one record per certificate issuance';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_event_bi`
BEFORE INSERT ON `mot2`.`mot_test_event`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_event_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_hist`
--

DROP TABLE IF EXISTS `mot_test_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `vehicle_version` int(10) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_class_id` smallint(5) unsigned DEFAULT NULL,
  `tested_as_fuel_type_id` smallint(5) unsigned DEFAULT NULL,
  `vin` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `empty_vin_reason_id` smallint(5) unsigned DEFAULT NULL,
  `registration` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `empty_vrm_reason_id` smallint(5) unsigned DEFAULT NULL,
  `make_id` int(10) unsigned DEFAULT NULL,
  `model_id` int(10) unsigned DEFAULT NULL,
  `model_detail_id` int(10) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned DEFAULT NULL,
  `has_registration` tinyint(4) unsigned DEFAULT NULL,
  `mot_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `started_date` datetime(6) DEFAULT NULL,
  `completed_date` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `issued_date` datetime(6) DEFAULT NULL,
  `expiry_date` date DEFAULT NULL,
  `mot_test_id_original` bigint(20) unsigned DEFAULT NULL,
  `prs_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_reason_for_cancel_id` smallint(5) unsigned DEFAULT NULL,
  `reason_for_cancel_comment_id` bigint(20) unsigned DEFAULT NULL,
  `reason_for_termination_comment` varchar(240) DEFAULT NULL,
  `full_partial_retest_id` smallint(5) unsigned DEFAULT NULL,
  `partial_reinspection_comment_id` bigint(20) unsigned DEFAULT NULL,
  `items_not_tested_comment_id` bigint(20) unsigned DEFAULT NULL,
  `one_person_test` tinyint(3) unsigned DEFAULT NULL,
  `one_person_reinspection` tinyint(3) unsigned DEFAULT NULL,
  `complaint_ref` varchar(30) DEFAULT NULL,
  `number` decimal(12,0) DEFAULT NULL,
  `odometer_reading_id` bigint(20) unsigned DEFAULT NULL,
  `private` tinyint(3) unsigned DEFAULT NULL,
  `emergency_log_id` int(10) unsigned DEFAULT NULL,
  `emergency_reason_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `emergency_reason_comment_id` bigint(20) unsigned DEFAULT NULL,
  `vehicle_weight_source_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_weight` int(10) unsigned DEFAULT NULL,
  `incognito_vehicle_id` int(10) unsigned DEFAULT NULL,
  `address_comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `make_name` varchar(50) DEFAULT NULL,
  `model_name` varchar(50) DEFAULT NULL,
  `model_detail_name` varchar(50) DEFAULT NULL,
  `client_ip` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  KEY `uq_mot_test_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_history`
--

DROP TABLE IF EXISTS `mot_test_history`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_history` (
  `id` bigint(20) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `vehicle_id` int(10) unsigned NOT NULL,
  `vehicle_version` int(10) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `has_registration` tinyint(4) unsigned NOT NULL,
  `mot_test_type_id` smallint(5) unsigned NOT NULL,
  `started_date` datetime(6) NOT NULL COMMENT 'It is populated by application due to contingency testing',
  `completed_date` datetime(6) DEFAULT NULL,
  `submitted_date` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `issued_date` datetime(6) DEFAULT NULL,
  `expiry_date` date DEFAULT NULL,
  `mot_test_id_original` bigint(20) unsigned DEFAULT NULL,
  `prs_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `number` decimal(12,0) DEFAULT NULL COMMENT 'Non-sequential Test number',
  `vehicle_weight_source_lookup_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Source of vehicle_weight',
  `vehicle_weight` int(10) unsigned DEFAULT NULL COMMENT 'Brake test weight from MOT1 VEHTESTBRAKEWEIGHT should be used in the calculation of brake efficiency. Recorded in kilograms. Migrated from MOT1 as brake test are not migrated',
  `incognito_vehicle_id` int(10) unsigned DEFAULT NULL,
  `odometer_value` int(10) unsigned DEFAULT NULL COMMENT 'Updated during test so multiple odometer values may exist over test lifetime',
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `client_ip` varchar(45) DEFAULT '0.0.0.0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mot_test_number` (`number`) USING HASH,
  KEY `fk_mot_test_history_vehicle` (`vehicle_id`),
  KEY `fk_mot_test_history_jasper_document` (`document_id`),
  KEY `fk_mot_test_history_mot_test_type` (`mot_test_type_id`),
  KEY `fk_mot_test_history_status` (`status_id`),
  KEY `fk_mot_test_history_vehicle_weight_source_lookup` (`vehicle_weight_source_lookup_id`),
  KEY `fk_mot_test_history_incognito_vehicle` (`incognito_vehicle_id`),
  KEY `ix_mot_test_history_completed_date` (`completed_date`),
  KEY `ix_mot_test_history_submitted_date` (`submitted_date`),
  KEY `ix_mot_test_history_site_id_started_date_completed_date` (`site_id`,`started_date`,`completed_date`),
  KEY `ix_mot_test_history_person_id_started_date_completed_date` (`person_id`,`started_date`,`completed_date`),
  KEY `ix_mot_test_history_site_id_status_id` (`site_id`,`status_id`),
  KEY `ix_mot_test_history_person_id_status_id` (`person_id`,`status_id`),
  KEY `ix_mot_test_history_mot_test_id_original` (`mot_test_id_original`),
  KEY `ix_mot_test_history_prs_mot_test_id` (`prs_mot_test_id`),
  CONSTRAINT `fk_mot_test_history_incognito_vehicle` FOREIGN KEY (`incognito_vehicle_id`) REFERENCES `incognito_vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_jasper_document` FOREIGN KEY (`document_id`) REFERENCES `jasper_document` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_mot_test_type` FOREIGN KEY (`mot_test_type_id`) REFERENCES `mot_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_status` FOREIGN KEY (`status_id`) REFERENCES `mot_test_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_vehicle` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_vehicle_weight_source_lookup` FOREIGN KEY (`vehicle_weight_source_lookup_id`) REFERENCES `weight_source_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_bi`
BEFORE INSERT ON `mot2`.`mot_test_history`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_bu`
BEFORE UPDATE ON `mot2`.`mot_test_history`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_au`
AFTER UPDATE ON `mot2`.`mot_test_history`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_history_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_id`
        ,`vehicle_version`
        ,`document_id`
        ,`organisation_id`
        ,`site_id`
        ,`has_registration`
        ,`mot_test_type_id`
        ,`started_date`
        ,`completed_date`
        ,`submitted_date`
        ,`status_id`
        ,`issued_date`
        ,`expiry_date`
        ,`mot_test_id_original`
        ,`prs_mot_test_id`
        ,`number`
        ,`vehicle_weight_source_lookup_id`
        ,`vehicle_weight`
        ,`incognito_vehicle_id`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`client_ip`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_id`
        ,OLD.`vehicle_version`
        ,OLD.`document_id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`has_registration`
        ,OLD.`mot_test_type_id`
        ,OLD.`started_date`
        ,OLD.`completed_date`
        ,OLD.`submitted_date`
        ,OLD.`status_id`
        ,OLD.`issued_date`
        ,OLD.`expiry_date`
        ,OLD.`mot_test_id_original`
        ,OLD.`prs_mot_test_id`
        ,OLD.`number`
        ,OLD.`vehicle_weight_source_lookup_id`
        ,OLD.`vehicle_weight`
        ,OLD.`incognito_vehicle_id`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`client_ip`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_bd`
BEFORE DELETE ON `mot2`.`mot_test_history`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_history_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_id`
        ,`vehicle_version`
        ,`document_id`
        ,`organisation_id`
        ,`site_id`
        ,`has_registration`
        ,`mot_test_type_id`
        ,`started_date`
        ,`completed_date`
        ,`submitted_date`
        ,`status_id`
        ,`issued_date`
        ,`expiry_date`
        ,`mot_test_id_original`
        ,`prs_mot_test_id`
        ,`number`
        ,`vehicle_weight_source_lookup_id`
        ,`vehicle_weight`
        ,`incognito_vehicle_id`
        ,`odometer_value`
        ,`odometer_unit`
        ,`odometer_result_type`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`
        ,`client_ip`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_id`
        ,OLD.`vehicle_version`
        ,OLD.`document_id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`has_registration`
        ,OLD.`mot_test_type_id`
        ,OLD.`started_date`
        ,OLD.`completed_date`
        ,OLD.`submitted_date`
        ,OLD.`status_id`
        ,OLD.`issued_date`
        ,OLD.`expiry_date`
        ,OLD.`mot_test_id_original`
        ,OLD.`prs_mot_test_id`
        ,OLD.`number`
        ,OLD.`vehicle_weight_source_lookup_id`
        ,OLD.`vehicle_weight`
        ,OLD.`incognito_vehicle_id`
        ,OLD.`odometer_value`
        ,OLD.`odometer_unit`
        ,OLD.`odometer_result_type`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`
        ,OLD.`client_ip`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_history_hist`
--

DROP TABLE IF EXISTS `mot_test_history_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_history_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `vehicle_version` int(10) unsigned DEFAULT NULL,
  `document_id` bigint(20) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `has_registration` tinyint(4) unsigned DEFAULT NULL,
  `mot_test_type_id` smallint(5) unsigned DEFAULT NULL,
  `started_date` datetime(6) DEFAULT NULL,
  `completed_date` datetime(6) DEFAULT NULL,
  `submitted_date` datetime(6) DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `issued_date` datetime(6) DEFAULT NULL,
  `expiry_date` date DEFAULT NULL,
  `mot_test_id_original` bigint(20) unsigned DEFAULT NULL,
  `prs_mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `number` decimal(12,0) DEFAULT NULL,
  `vehicle_weight_source_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `vehicle_weight` int(10) unsigned DEFAULT NULL,
  `incognito_vehicle_id` int(10) unsigned DEFAULT NULL,
  `odometer_value` int(10) unsigned DEFAULT NULL,
  `odometer_unit` enum('km','mi') CHARACTER SET latin1 DEFAULT NULL,
  `odometer_result_type` enum('OK','NOT_READ','NO_METER') CHARACTER SET latin1 DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  `client_ip` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_history_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_history_rfr_map`
--

DROP TABLE IF EXISTS `mot_test_history_rfr_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_history_rfr_map` (
  `id` bigint(20) unsigned NOT NULL,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `rfr_type_id` int(10) unsigned NOT NULL,
  `mot_test_rfr_location_type_id` smallint(5) unsigned DEFAULT NULL,
  `failure_dangerous` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'User option available when can_be_dangerous flag is set in test_item_selector_rfr',
  `generated` tinyint(4) NOT NULL,
  `on_original_test` tinyint(4) NOT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_mot_test_history_rfr_map_reason_for_rejection_type` (`rfr_type_id`),
  KEY `fk_mot_test_history_rfr_map_reason_for_rejection` (`rfr_id`),
  KEY `fk_mot_test_history_rfr_map_mot_test_rfr_location_type` (`mot_test_rfr_location_type_id`),
  KEY `ix_mot_test_history_rfr_map_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_mot_test_history_rfr_map_mot_test_rfr_location_type` FOREIGN KEY (`mot_test_rfr_location_type_id`) REFERENCES `mot_test_rfr_location_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_rfr_map_reason_for_rejection` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_history_rfr_map_reason_for_rejection_type` FOREIGN KEY (`rfr_type_id`) REFERENCES `reason_for_rejection_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records the RFR details of vehicle tests';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_rfr_map_bi`
BEFORE INSERT ON `mot2`.`mot_test_history_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_rfr_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_rfr_map_bu`
BEFORE UPDATE ON `mot2`.`mot_test_history_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_rfr_map_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_rfr_map_au`
AFTER UPDATE ON `mot2`.`mot_test_history_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_rfr_map_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_history_rfr_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`rfr_id`
        ,`rfr_type_id`
        ,`mot_test_rfr_location_type_id`
        ,`failure_dangerous`
        ,`generated`
        ,`on_original_test`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`rfr_id`
        ,OLD.`rfr_type_id`
        ,OLD.`mot_test_rfr_location_type_id`
        ,OLD.`failure_dangerous`
        ,OLD.`generated`
        ,OLD.`on_original_test`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_history_rfr_map_bd`
BEFORE DELETE ON `mot2`.`mot_test_history_rfr_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_history_rfr_map_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_history_rfr_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`mot_test_id`
        ,`rfr_id`
        ,`rfr_type_id`
        ,`mot_test_rfr_location_type_id`
        ,`failure_dangerous`
        ,`generated`
        ,`on_original_test`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`mot_test_id`
        ,OLD.`rfr_id`
        ,OLD.`rfr_type_id`
        ,OLD.`mot_test_rfr_location_type_id`
        ,OLD.`failure_dangerous`
        ,OLD.`generated`
        ,OLD.`on_original_test`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_history_rfr_map_hist`
--

DROP TABLE IF EXISTS `mot_test_history_rfr_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_history_rfr_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `rfr_type_id` int(10) unsigned DEFAULT NULL,
  `mot_test_rfr_location_type_id` smallint(5) unsigned DEFAULT NULL,
  `failure_dangerous` tinyint(4) DEFAULT NULL,
  `generated` tinyint(4) DEFAULT NULL,
  `on_original_test` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_history_rfr_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_reason_for_cancel_lookup`
--

DROP TABLE IF EXISTS `mot_test_reason_for_cancel_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_reason_for_cancel_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `reason` varchar(250) NOT NULL,
  `reason_cy` varchar(250) DEFAULT NULL COMMENT 'Welsh',
  `is_system_generated` tinyint(4) unsigned NOT NULL DEFAULT '0' COMMENT 'Legacy from mot1. CRON jobs aborted long mot tests, e.g. 24h',
  `is_displayable` tinyint(4) unsigned NOT NULL DEFAULT '0' COMMENT 'Some values are not used anymore in MOT 2, but we keep the them as legacy from MOT 1',
  `is_abandoned` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Reasons for canceling a test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_reason_for_cancel_lookup_bi`
BEFORE INSERT ON `mot2`.`mot_test_reason_for_cancel_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_reason_for_cancel_lookup_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_reason_for_refusal_lookup`
--

DROP TABLE IF EXISTS `mot_test_reason_for_refusal_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_reason_for_refusal_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `reason` varchar(250) NOT NULL COMMENT 'English',
  `reason_cy` varchar(250) DEFAULT NULL COMMENT 'Welsh translation - if available',
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `mot_test_reason_for_refusal_lookup_code` (`code`),
  UNIQUE KEY `mot_test_reason_for_refusal_lookup_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Reasons for refusing to test';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_reason_for_refusal_lookup_bi`
BEFORE INSERT ON `mot2`.`mot_test_reason_for_refusal_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_reason_for_refusal_lookup_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_rfr_location_type`
--

DROP TABLE IF EXISTS `mot_test_rfr_location_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_location_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `lateral` varchar(50) DEFAULT NULL,
  `longitudinal` varchar(50) DEFAULT NULL,
  `vertical` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  `sha1_concat_ws_chksum` char(40) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mot_test_rfr_location_type_lat_long_vertical` (`lateral`,`longitudinal`,`vertical`),
  UNIQUE KEY `uk_mot_test_rfr_location_type_sha1` (`sha1_concat_ws_chksum`) USING HASH
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='unique index to allow RFR location types to be derived from the mot_test_rfr_map table';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_location_type_bi`
BEFORE INSERT ON `mot2`.`mot_test_rfr_location_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_location_type_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_rfr_map_comment`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_comment` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'Reference to mot_test_current_rfr_map.id or mot_test_history_rfr_map.id',
  `comment` varchar(255) NOT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_comment_bi`
BEFORE INSERT ON `mot2`.`mot_test_rfr_map_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_comment_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_comment_bu`
BEFORE UPDATE ON `mot2`.`mot_test_rfr_map_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_comment_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_comment_au`
AFTER UPDATE ON `mot2`.`mot_test_rfr_map_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_comment_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_rfr_map_comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`comment`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`comment`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_comment_bd`
BEFORE DELETE ON `mot2`.`mot_test_rfr_map_comment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_comment_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_rfr_map_comment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`comment`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`comment`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_rfr_map_comment_hist`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_comment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_comment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `comment` varchar(255) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_rfr_map_comment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:52';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_rfr_map_custom_description`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_custom_description`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_custom_description` (
  `id` bigint(20) unsigned NOT NULL COMMENT 'Reference to mot_test_current_rfr_map.id or mot_test_history_rfr_map.id',
  `custom_description` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_custom_description_bi`
BEFORE INSERT ON `mot2`.`mot_test_rfr_map_custom_description`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_custom_description_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_custom_description_bu`
BEFORE UPDATE ON `mot2`.`mot_test_rfr_map_custom_description`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_custom_description_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_custom_description_au`
AFTER UPDATE ON `mot2`.`mot_test_rfr_map_custom_description`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_custom_description_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_rfr_map_custom_description_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`custom_description`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`custom_description`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_rfr_map_custom_description_bd`
BEFORE DELETE ON `mot2`.`mot_test_rfr_map_custom_description`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_rfr_map_custom_description_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`mot_test_rfr_map_custom_description_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`custom_description`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`custom_description`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_rfr_map_custom_description_hist`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_custom_description_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_custom_description_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `custom_description` varchar(100) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_rfr_map_custom_description_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-12-12 11:28:53';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_rfr_map_hist`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `mot_test_id` bigint(20) unsigned DEFAULT NULL,
  `rfr_id` int(10) unsigned DEFAULT NULL,
  `type` varchar(50) DEFAULT NULL,
  `location_lateral` varchar(50) DEFAULT NULL,
  `location_longitudinal` varchar(50) DEFAULT NULL,
  `location_vertical` varchar(50) DEFAULT NULL,
  `comment` varchar(255) DEFAULT NULL,
  `failure_dangerous` tinyint(4) DEFAULT NULL,
  `generated` tinyint(4) DEFAULT NULL,
  `custom_description` varchar(100) DEFAULT NULL,
  `on_original_test` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_mot_test_rfr_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_rfr_map_marked_as_repaired`
--

DROP TABLE IF EXISTS `mot_test_rfr_map_marked_as_repaired`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_rfr_map_marked_as_repaired` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_rfr_map_id` bigint(20) unsigned NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `mot_test_rfr_map_id` (`mot_test_rfr_map_id`),
  CONSTRAINT `fk_mot_test_rfr_map_id` FOREIGN KEY (`mot_test_rfr_map_id`) REFERENCES `mot_test_current_rfr_map` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records the id of RFRs from a vehicle test that have been marked as repaired by the tester but have not yet been removed from the mot_test_rfr_map table';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `mot_test_status`
--

DROP TABLE IF EXISTS `mot_test_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(10) NOT NULL,
  `description` varchar(250) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mot_test_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_status_bi`
BEFORE INSERT ON `mot2`.`mot_test_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_status_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_survey`
--

DROP TABLE IF EXISTS `mot_test_survey`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_survey` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `mot_test_id` bigint(20) unsigned NOT NULL,
  `token` char(36) DEFAULT NULL,
  `has_been_presented` tinyint(4) NOT NULL DEFAULT '0',
  `has_been_submitted` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_mot_test_survey_person_created_by` (`created_by`),
  KEY `ix_mot_test_survey_person_last_updated_by` (`last_updated_by`),
  KEY `fk_mot_test_id_mot_test_id` (`mot_test_id`),
  CONSTRAINT `fk_mot_test_survey_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_mot_test_survey_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_survey_bi`
BEFORE INSERT ON `mot2`.`mot_test_survey`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_survey_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `mot_test_type`
--

DROP TABLE IF EXISTS `mot_test_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `mot_test_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `description` varchar(50) DEFAULT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `is_demo` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `is_slot_consuming` tinyint(3) unsigned NOT NULL DEFAULT '1',
  `is_reinspection` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of test performed';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_mot_test_type_bi`
BEFORE INSERT ON `mot2`.`mot_test_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_mot_test_type_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `non_working_day_country_lookup`
--

DROP TABLE IF EXISTS `non_working_day_country_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `non_working_day_country_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `country_lookup_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_non_working_day_country_lookup_country_lookup_id` (`country_lookup_id`),
  CONSTRAINT `fk_non_working_day_country_lookup_country_lookup_id` FOREIGN KEY (`country_lookup_id`) REFERENCES `country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_non_working_day_country_lookup_bi`
BEFORE INSERT ON `mot2`.`non_working_day_country_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_non_working_day_country_lookup_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `non_working_day_lookup`
--

DROP TABLE IF EXISTS `non_working_day_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `non_working_day_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `non_working_day_country_lookup_id` smallint(5) unsigned NOT NULL,
  `day` date NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_non_working_day_lookup_non_working_day_country_id_day,` (`non_working_day_country_lookup_id`,`day`),
  CONSTRAINT `fk_non_working_day_lookup_non_working_day_country_lookup_id` FOREIGN KEY (`non_working_day_country_lookup_id`) REFERENCES `non_working_day_country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_non_working_day_lookup_bi`
BEFORE INSERT ON `mot2`.`non_working_day_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_non_working_day_lookup_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification`
--

DROP TABLE IF EXISTS `notification`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `notification_template_id` int(10) unsigned NOT NULL,
  `recipient_id` int(10) unsigned NOT NULL,
  `read_on` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_notification_notification_template_id` (`notification_template_id`),
  KEY `fk_notification_person_id` (`recipient_id`),
  CONSTRAINT `fk_notification_notification_template_id` FOREIGN KEY (`notification_template_id`) REFERENCES `notification_template` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_notification_person_id` FOREIGN KEY (`recipient_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records instances of notifications to persons. Note these are different from Special Notices.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_bi`
BEFORE INSERT ON `mot2`.`notification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_bu`
BEFORE UPDATE ON `mot2`.`notification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_au`
AFTER UPDATE ON `mot2`.`notification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`notification_template_id`
        ,`recipient_id`
        ,`read_on`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`notification_template_id`
        ,OLD.`recipient_id`
        ,OLD.`read_on`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_bd`
BEFORE DELETE ON `mot2`.`notification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`notification_template_id`
        ,`recipient_id`
        ,`read_on`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`notification_template_id`
        ,OLD.`recipient_id`
        ,OLD.`read_on`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_action_lookup`
--

DROP TABLE IF EXISTS `notification_action_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_action_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `action` varchar(100) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `code` varchar(5) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_notification_action_lookup_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the types of action that can be taken for all types of notification';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_action_lookup_bi`
BEFORE INSERT ON `mot2`.`notification_action_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_action_lookup_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_action_map`
--

DROP TABLE IF EXISTS `notification_action_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_action_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `notification_id` int(10) unsigned NOT NULL,
  `action_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_notification_action_1` (`notification_id`),
  KEY `fk_notification_action_2` (`action_id`),
  CONSTRAINT `fk_notification_action_1` FOREIGN KEY (`notification_id`) REFERENCES `notification` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_notification_action_2` FOREIGN KEY (`action_id`) REFERENCES `notification_action_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Record of the action taken as a result of a notification';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_action_map_bi`
BEFORE INSERT ON `mot2`.`notification_action_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_action_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_field`
--

DROP TABLE IF EXISTS `notification_field`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_field` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `notification_id` int(10) unsigned NOT NULL,
  `field` varchar(30) NOT NULL,
  `content` varchar(250) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_notification_fields_1` (`notification_id`),
  CONSTRAINT `fk_notification_fields_1` FOREIGN KEY (`notification_id`) REFERENCES `notification` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records the strings substituted into notification instances';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_field_bi`
BEFORE INSERT ON `mot2`.`notification_field`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_field_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_field_bu`
BEFORE UPDATE ON `mot2`.`notification_field`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_field_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_field_au`
AFTER UPDATE ON `mot2`.`notification_field`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_field_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_field_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`notification_id`
        ,`field`
        ,`content`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`notification_id`
        ,OLD.`field`
        ,OLD.`content`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_field_bd`
BEFORE DELETE ON `mot2`.`notification_field`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_field_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_field_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`notification_id`
        ,`field`
        ,`content`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`notification_id`
        ,OLD.`field`
        ,OLD.`content`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_field_hist`
--

DROP TABLE IF EXISTS `notification_field_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_field_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `notification_id` int(10) unsigned DEFAULT NULL,
  `field` varchar(30) DEFAULT NULL,
  `content` varchar(250) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_notification_field_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `notification_hist`
--

DROP TABLE IF EXISTS `notification_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `notification_template_id` int(10) unsigned DEFAULT NULL,
  `recipient_id` int(10) unsigned DEFAULT NULL,
  `read_on` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_notification_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `notification_template`
--

DROP TABLE IF EXISTS `notification_template`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_template` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `content` text,
  `subject` varchar(255) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Template text of notification including placeholder fields';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_template_bi`
BEFORE INSERT ON `mot2`.`notification_template`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_template_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_template_bu`
BEFORE UPDATE ON `mot2`.`notification_template`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_template_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_template_au`
AFTER UPDATE ON `mot2`.`notification_template`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_template_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_template_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`content`
        ,`subject`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`content`
        ,OLD.`subject`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_template_bd`
BEFORE DELETE ON `mot2`.`notification_template`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_template_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`notification_template_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`content`
        ,`subject`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`content`
        ,OLD.`subject`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_template_action`
--

DROP TABLE IF EXISTS `notification_template_action`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_template_action` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `notification_template_id` int(10) unsigned NOT NULL,
  `action_id` smallint(5) unsigned NOT NULL,
  `label` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_notification_template_action_1` (`notification_template_id`),
  KEY `fk_notification_template_action_2` (`action_id`),
  CONSTRAINT `fk_notification_template_action_1` FOREIGN KEY (`notification_template_id`) REFERENCES `notification_template` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_notification_template_action_2` FOREIGN KEY (`action_id`) REFERENCES `notification_action_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Names of actions that can be taken for a given notification template';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_notification_template_action_bi`
BEFORE INSERT ON `mot2`.`notification_template_action`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_notification_template_action_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `notification_template_hist`
--

DROP TABLE IF EXISTS `notification_template_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `notification_template_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `content` text,
  `subject` varchar(255) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_notification_template_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `odometer_reading_hist`
--

DROP TABLE IF EXISTS `odometer_reading_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `odometer_reading_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` bigint(20) unsigned DEFAULT NULL,
  `recorded_on` datetime(6) DEFAULT NULL,
  `value` int(11) DEFAULT NULL,
  `unit` varchar(2) DEFAULT NULL,
  `result_type` varchar(10) DEFAULT NULL,
  `is_deleted` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_odometer_reading_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `organisation`
--

DROP TABLE IF EXISTS `organisation`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(60) NOT NULL COMMENT '60 in MOT1',
  `registered_company_number` varchar(20) DEFAULT NULL,
  `vat_registration_number` varchar(20) DEFAULT NULL,
  `trading_name` varchar(60) DEFAULT NULL COMMENT '60 in MOT1',
  `company_type_id` smallint(5) unsigned DEFAULT NULL,
  `organisation_type_id` smallint(5) unsigned DEFAULT NULL,
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `transition_scheduled_on` date DEFAULT NULL,
  `sites_confirmed_ready_on` datetime(6) DEFAULT NULL,
  `transition_processed_on` datetime(6) DEFAULT NULL,
  `first_payment_setup_on` datetime(6) DEFAULT NULL,
  `first_slots_purchased_on` datetime(6) DEFAULT NULL,
  `mot1_total_running_balance` decimal(12,2) DEFAULT NULL COMMENT 'Total of all account balances in MOT1 before convertion to slots',
  `mot1_total_slots_converted` int(11) DEFAULT NULL COMMENT 'Total of slots converted from balance cash leaving remainder cash in mot1_remainder_migrated',
  `mot1_total_remainder_balance` decimal(12,2) DEFAULT NULL COMMENT 'Remainder of all account balances after convertion to slots',
  `mot1_total_vts_slots_merged` int(11) DEFAULT NULL COMMENT 'Total slots currently available accross all VTS devices in the AE',
  `mot1_total_slots_merged` int(11) DEFAULT NULL COMMENT 'Total of merged and converted MOT1 slots',
  `mot1_slots_migrated_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL,
  `slots_balance` int(10) NOT NULL DEFAULT '0',
  `slots_warning` int(10) unsigned NOT NULL DEFAULT '15',
  `slots_purchased` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Negative slot balance in overdraft field may be migrated from MOT1 and occur if a cheque is bounced.This field is always positive.',
  `slots_overdraft` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Negative slot balance in overdraft field may be migrated from MOT1 and occur if a cheque is bounced.',
  `data_may_be_disclosed` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `organisation_name_idx` (`name`),
  KEY `organisation_registered_company_number_idx` (`registered_company_number`),
  KEY `organisation_vat_registration_number_idx` (`vat_registration_number`),
  KEY `fk_organisation_company_type_id` (`company_type_id`),
  KEY `fk_organisation_organisation_type_id` (`organisation_type_id`),
  KEY `fk_organisation_transition_status_id` (`transition_status_id`),
  CONSTRAINT `fk_organisation_company_type_id` FOREIGN KEY (`company_type_id`) REFERENCES `company_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_organisation_type_id` FOREIGN KEY (`organisation_type_id`) REFERENCES `organisation_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_transition_status_id` FOREIGN KEY (`transition_status_id`) REFERENCES `transition_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of an organisation in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_bi`
BEFORE INSERT ON `mot2`.`organisation`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_bu`
BEFORE UPDATE ON `mot2`.`organisation`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_au`
AFTER UPDATE ON `mot2`.`organisation`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`registered_company_number`
        ,`vat_registration_number`
        ,`trading_name`
        ,`company_type_id`
        ,`organisation_type_id`
        ,`transition_status_id`
        ,`transition_scheduled_on`
        ,`sites_confirmed_ready_on`
        ,`transition_processed_on`
        ,`first_payment_setup_on`
        ,`first_slots_purchased_on`
        ,`mot1_total_running_balance`
        ,`mot1_total_slots_converted`
        ,`mot1_total_remainder_balance`
        ,`mot1_total_vts_slots_merged`
        ,`mot1_total_slots_merged`
        ,`mot1_slots_migrated_on`
        ,`mot1_details_updated_on`
        ,`slots_balance`
        ,`slots_warning`
        ,`slots_purchased`
        ,`slots_overdraft`
        ,`data_may_be_disclosed`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`registered_company_number`
        ,OLD.`vat_registration_number`
        ,OLD.`trading_name`
        ,OLD.`company_type_id`
        ,OLD.`organisation_type_id`
        ,OLD.`transition_status_id`
        ,OLD.`transition_scheduled_on`
        ,OLD.`sites_confirmed_ready_on`
        ,OLD.`transition_processed_on`
        ,OLD.`first_payment_setup_on`
        ,OLD.`first_slots_purchased_on`
        ,OLD.`mot1_total_running_balance`
        ,OLD.`mot1_total_slots_converted`
        ,OLD.`mot1_total_remainder_balance`
        ,OLD.`mot1_total_vts_slots_merged`
        ,OLD.`mot1_total_slots_merged`
        ,OLD.`mot1_slots_migrated_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`slots_balance`
        ,OLD.`slots_warning`
        ,OLD.`slots_purchased`
        ,OLD.`slots_overdraft`
        ,OLD.`data_may_be_disclosed`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_bd`
BEFORE DELETE ON `mot2`.`organisation`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`registered_company_number`
        ,`vat_registration_number`
        ,`trading_name`
        ,`company_type_id`
        ,`organisation_type_id`
        ,`transition_status_id`
        ,`transition_scheduled_on`
        ,`sites_confirmed_ready_on`
        ,`transition_processed_on`
        ,`first_payment_setup_on`
        ,`first_slots_purchased_on`
        ,`mot1_total_running_balance`
        ,`mot1_total_slots_converted`
        ,`mot1_total_remainder_balance`
        ,`mot1_total_vts_slots_merged`
        ,`mot1_total_slots_merged`
        ,`mot1_slots_migrated_on`
        ,`mot1_details_updated_on`
        ,`slots_balance`
        ,`slots_warning`
        ,`slots_purchased`
        ,`slots_overdraft`
        ,`data_may_be_disclosed`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`registered_company_number`
        ,OLD.`vat_registration_number`
        ,OLD.`trading_name`
        ,OLD.`company_type_id`
        ,OLD.`organisation_type_id`
        ,OLD.`transition_status_id`
        ,OLD.`transition_scheduled_on`
        ,OLD.`sites_confirmed_ready_on`
        ,OLD.`transition_processed_on`
        ,OLD.`first_payment_setup_on`
        ,OLD.`first_slots_purchased_on`
        ,OLD.`mot1_total_running_balance`
        ,OLD.`mot1_total_slots_converted`
        ,OLD.`mot1_total_remainder_balance`
        ,OLD.`mot1_total_vts_slots_merged`
        ,OLD.`mot1_total_slots_merged`
        ,OLD.`mot1_slots_migrated_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`slots_balance`
        ,OLD.`slots_warning`
        ,OLD.`slots_purchased`
        ,OLD.`slots_overdraft`
        ,OLD.`data_may_be_disclosed`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_assembly_role_map`
--

DROP TABLE IF EXISTS `organisation_assembly_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_assembly_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `assembly_id` int(10) unsigned NOT NULL,
  `assembly_role_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_organisation_assembly_role_map_org_assembly_assembly_role` (`organisation_id`,`assembly_id`,`assembly_role_id`),
  KEY `fk_organisation_assembly_role_map_assembly_id` (`assembly_id`),
  KEY `fk_organisation_assembly_role_map_assembly_role_id` (`assembly_role_id`),
  CONSTRAINT `fk_organisation_assembly_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_assembly_role_map_assembly_id` FOREIGN KEY (`assembly_id`) REFERENCES `assembly` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_assembly_role_map_assembly_role_id` FOREIGN KEY (`assembly_role_id`) REFERENCES `assembly_role_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_assembly_role_map_bi`
BEFORE INSERT ON `mot2`.`organisation_assembly_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_assembly_role_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_business_role`
--

DROP TABLE IF EXISTS `organisation_business_role`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_business_role` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `description` varchar(250) NOT NULL,
  `code` varchar(5) NOT NULL,
  `organisation_type_id` smallint(5) unsigned DEFAULT NULL,
  `role_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_organisation_business_role_code` (`code`),
  KEY `fk_organisation_business_role_role` (`role_id`),
  CONSTRAINT `fk_organisation_business_role_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_business_role_bi`
BEFORE INSERT ON `mot2`.`organisation_business_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_business_role_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_business_role_map`
--

DROP TABLE IF EXISTS `organisation_business_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_business_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `business_role_id` smallint(5) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_organisation_business_role_map` (`business_role_id`),
  KEY `fk_organisation_business_role_map_status` (`status_id`),
  KEY `fk_organisation_role_map_organisation` (`organisation_id`),
  KEY `fk_organisation_role_map_person` (`person_id`),
  CONSTRAINT `fk_organisation_business_role_map` FOREIGN KEY (`business_role_id`) REFERENCES `organisation_business_role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_business_role_map_status` FOREIGN KEY (`status_id`) REFERENCES `business_role_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_role_map_organisation` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_role_map_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='A persons business role within an Organisation i.e. AEDM';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_business_role_map_bi`
BEFORE INSERT ON `mot2`.`organisation_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_business_role_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_business_role_map_bu`
BEFORE UPDATE ON `mot2`.`organisation_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_business_role_map_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_business_role_map_au`
AFTER UPDATE ON `mot2`.`organisation_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_business_role_map_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_business_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`business_role_id`
        ,`person_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`business_role_id`
        ,OLD.`person_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_business_role_map_bd`
BEFORE DELETE ON `mot2`.`organisation_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_business_role_map_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_business_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`business_role_id`
        ,`person_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`business_role_id`
        ,OLD.`person_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_business_role_map_hist`
--

DROP TABLE IF EXISTS `organisation_business_role_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_business_role_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `business_role_id` smallint(5) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  KEY `uq_organisation_business_role_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `organisation_contact_detail_map`
--

DROP TABLE IF EXISTS `organisation_contact_detail_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_contact_detail_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `contact_detail_id` int(10) unsigned NOT NULL,
  `organisation_contact_type_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_organisation_contact_detail_map_contact_detail_id` (`contact_detail_id`),
  KEY `fk_organisation_contact_detail_map_contact_type_id` (`organisation_contact_type_id`),
  KEY `fk_organisation_contact_detail_map_organisation_id` (`organisation_id`),
  CONSTRAINT `fk_organisation_contact_detail_map_contact_detail_id` FOREIGN KEY (`contact_detail_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_contact_detail_map_contact_type_id` FOREIGN KEY (`organisation_contact_type_id`) REFERENCES `organisation_contact_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_contact_detail_map_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Link table between an organisation and a set of contact details';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_contact_detail_map_bi`
BEFORE INSERT ON `mot2`.`organisation_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_contact_detail_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_contact_detail_map_bu`
BEFORE UPDATE ON `mot2`.`organisation_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_contact_detail_map_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_contact_detail_map_au`
AFTER UPDATE ON `mot2`.`organisation_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_contact_detail_map_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`contact_detail_id`
        ,`organisation_contact_type_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`contact_detail_id`
        ,OLD.`organisation_contact_type_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_contact_detail_map_bd`
BEFORE DELETE ON `mot2`.`organisation_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_contact_detail_map_bd Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`contact_detail_id`
        ,`organisation_contact_type_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`contact_detail_id`
        ,OLD.`organisation_contact_type_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_contact_detail_map_hist`
--

DROP TABLE IF EXISTS `organisation_contact_detail_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_contact_detail_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `contact_detail_id` int(10) unsigned DEFAULT NULL,
  `organisation_contact_type_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_organisation_contact_detail_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `organisation_contact_type`
--

DROP TABLE IF EXISTS `organisation_contact_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_contact_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_organisation_contact_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of contact detail of an organisation';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_contact_type_bi`
BEFORE INSERT ON `mot2`.`organisation_contact_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_contact_type_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_hist`
--

DROP TABLE IF EXISTS `organisation_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `name` varchar(60) DEFAULT NULL,
  `registered_company_number` varchar(20) DEFAULT NULL,
  `vat_registration_number` varchar(20) DEFAULT NULL,
  `trading_name` varchar(60) DEFAULT NULL,
  `company_type_id` smallint(5) unsigned DEFAULT NULL,
  `organisation_type_id` smallint(5) unsigned DEFAULT NULL,
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `transition_scheduled_on` date DEFAULT NULL,
  `sites_confirmed_ready_on` datetime(6) DEFAULT NULL,
  `transition_processed_on` datetime(6) DEFAULT NULL,
  `first_payment_setup_on` datetime(6) DEFAULT NULL,
  `first_slots_purchased_on` datetime(6) DEFAULT NULL,
  `mot1_total_running_balance` decimal(12,2) DEFAULT NULL,
  `mot1_total_slots_converted` int(11) DEFAULT NULL,
  `mot1_total_remainder_balance` decimal(12,2) DEFAULT NULL,
  `mot1_total_vts_slots_merged` int(11) DEFAULT NULL,
  `mot1_total_slots_merged` int(11) DEFAULT NULL,
  `mot1_slots_migrated_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL,
  `slots_balance` int(10) DEFAULT NULL,
  `slots_warning` int(10) unsigned DEFAULT NULL,
  `slots_purchased` int(10) unsigned DEFAULT NULL,
  `slots_overdraft` int(10) unsigned DEFAULT NULL,
  `data_may_be_disclosed` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  KEY `uq_organisation_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `organisation_site_map`
--

DROP TABLE IF EXISTS `organisation_site_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_site_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `site_id` int(10) unsigned NOT NULL,
  `trading_name` varchar(60) DEFAULT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) NOT NULL,
  `start_date` datetime(6) DEFAULT NULL,
  `end_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_organisation_site_map_organisation_id` (`organisation_id`),
  KEY `fk_organisation_site_map_organisation_site_status` (`status_id`),
  KEY `fk_organisation_site_map_site_id` (`site_id`),
  CONSTRAINT `fk_organisation_site_map_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_site_map_organisation_site_status` FOREIGN KEY (`status_id`) REFERENCES `organisation_site_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_organisation_site_map_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_site_map_bi`
BEFORE INSERT ON `mot2`.`organisation_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_site_map_bi Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_site_map_bu`
BEFORE UPDATE ON `mot2`.`organisation_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_site_map_bu Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_site_map_au`
AFTER UPDATE ON `mot2`.`organisation_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_site_map_au Generated on 2016-12-12 11:29:01. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_site_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`site_id`
        ,`trading_name`
        ,`status_id`
        ,`status_changed_on`
        ,`start_date`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`trading_name`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`start_date`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_site_map_bd`
BEFORE DELETE ON `mot2`.`organisation_site_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_site_map_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`organisation_site_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`site_id`
        ,`trading_name`
        ,`status_id`
        ,`status_changed_on`
        ,`start_date`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`site_id`
        ,OLD.`trading_name`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`start_date`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_site_map_hist`
--

DROP TABLE IF EXISTS `organisation_site_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_site_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `trading_name` varchar(60) DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `start_date` datetime(6) DEFAULT NULL,
  `end_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_organisation_site_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `organisation_site_status`
--

DROP TABLE IF EXISTS `organisation_site_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_site_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_organisation_site_status_code` (`code`),
  UNIQUE KEY `uk_organisation_site_status_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the status of a site. ';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_site_status_bi`
BEFORE INSERT ON `mot2`.`organisation_site_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_site_status_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `organisation_type`
--

DROP TABLE IF EXISTS `organisation_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `organisation_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_organisation_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the type of an organisation i.e. DVSA, DVLA, Examining Body, Authorised Examiner, Other';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_organisation_type_bi`
BEFORE INSERT ON `mot2`.`organisation_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_organisation_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `password_detail`
--

DROP TABLE IF EXISTS `password_detail`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `password_detail` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `password_expiry_notification_sent_date` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_password_detail_person_id_person_id` (`person_id`),
  CONSTRAINT `fk_password_detail_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Password details';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_password_detail_bi`
BEFORE INSERT ON `mot2`.`password_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_password_detail_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_password_detail_bu`
BEFORE UPDATE ON `mot2`.`password_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_password_detail_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_password_detail_au`
AFTER UPDATE ON `mot2`.`password_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_password_detail_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`password_detail_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`password_expiry_notification_sent_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`password_expiry_notification_sent_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_password_detail_bd`
BEFORE DELETE ON `mot2`.`password_detail`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_password_detail_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`password_detail_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`password_expiry_notification_sent_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`password_expiry_notification_sent_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `password_detail_hist`
--

DROP TABLE IF EXISTS `password_detail_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `password_detail_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `password_expiry_notification_sent_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_password_detail_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `payment`
--

DROP TABLE IF EXISTS `payment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payment` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `amount` decimal(10,2) NOT NULL,
  `receipt_reference` varchar(55) DEFAULT NULL COMMENT 'Unique reference received from CPMS to identify the payment',
  `unique_identifier` varchar(8) DEFAULT NULL COMMENT 'Last 8 char of receipt reference searched on',
  `payment_details` text,
  `status_id` smallint(5) unsigned NOT NULL,
  `type` smallint(5) unsigned NOT NULL,
  `created` datetime(6) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `payment_receipt_reference_id_idx` (`receipt_reference`,`id`),
  KEY `payment_unique_identifier_created_idx` (`unique_identifier`,`created`),
  KEY `fk_payment_payment_type` (`type`),
  KEY `fk_payment_status_id_payment_status_id` (`status_id`),
  CONSTRAINT `fk_payment_payment_type` FOREIGN KEY (`type`) REFERENCES `payment_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_payment_status_id_payment_status_id` FOREIGN KEY (`status_id`) REFERENCES `payment_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records payments made for slots. Potentially more than one payment could be made per slot transaction.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_bi`
BEFORE INSERT ON `mot2`.`payment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_bu`
BEFORE UPDATE ON `mot2`.`payment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_au`
AFTER UPDATE ON `mot2`.`payment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`payment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`amount`
        ,`receipt_reference`
        ,`unique_identifier`
        ,`payment_details`
        ,`status_id`
        ,`type`
        ,`created`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`amount`
        ,OLD.`receipt_reference`
        ,OLD.`unique_identifier`
        ,OLD.`payment_details`
        ,OLD.`status_id`
        ,OLD.`type`
        ,OLD.`created`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_bd`
BEFORE DELETE ON `mot2`.`payment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`payment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`amount`
        ,`receipt_reference`
        ,`unique_identifier`
        ,`payment_details`
        ,`status_id`
        ,`type`
        ,`created`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`amount`
        ,OLD.`receipt_reference`
        ,OLD.`unique_identifier`
        ,OLD.`payment_details`
        ,OLD.`status_id`
        ,OLD.`type`
        ,OLD.`created`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `payment_hist`
--

DROP TABLE IF EXISTS `payment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `amount` decimal(10,2) DEFAULT NULL,
  `receipt_reference` varchar(55) DEFAULT NULL,
  `unique_identifier` varchar(8) DEFAULT NULL,
  `payment_details` text,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `type` smallint(5) unsigned DEFAULT NULL,
  `created` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_payment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `payment_status`
--

DROP TABLE IF EXISTS `payment_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payment_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `cpms_code` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='CPMS code for given status type';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_status_bi`
BEFORE INSERT ON `mot2`.`payment_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_status_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `payment_type`
--

DROP TABLE IF EXISTS `payment_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `payment_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `type_name` varchar(75) NOT NULL DEFAULT '' COMMENT 'Name of the payment type',
  `code` varchar(40) DEFAULT NULL,
  `active` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'Whether the payment type is active',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Order the payment type appears in a list',
  `is_adjustable` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT 'Determines if this payment type can be adjusted',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of payment. Not all payment types are currently implemented';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_payment_type_bi`
BEFORE INSERT ON `mot2`.`payment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_payment_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permission`
--

DROP TABLE IF EXISTS `permission`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `permission` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(50) CHARACTER SET latin1 DEFAULT NULL,
  `is_restricted` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_permission_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_permission_bi`
BEFORE INSERT ON `mot2`.`permission`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_permission_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_permission_bu`
BEFORE UPDATE ON `mot2`.`permission`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_permission_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_permission_au`
AFTER UPDATE ON `mot2`.`permission`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_permission_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`permission_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`is_restricted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`is_restricted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_permission_bd`
BEFORE DELETE ON `mot2`.`permission`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_permission_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`permission_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`is_restricted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`is_restricted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `permission_hist`
--

DROP TABLE IF EXISTS `permission_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `permission_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(50) CHARACTER SET latin1 DEFAULT NULL,
  `is_restricted` tinyint(4) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_permission_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `permission_to_assign_role_map`
--

DROP TABLE IF EXISTS `permission_to_assign_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `permission_to_assign_role_map` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `permission_id` int(10) unsigned NOT NULL,
  `role_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_permission_to_assign_role_map` (`role_id`,`permission_id`),
  KEY `fk_permission_to_assign_role_map_permission_id` (`permission_id`),
  CONSTRAINT `fk_permission_to_assign_role_map_permission_id` FOREIGN KEY (`permission_id`) REFERENCES `permission` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_permission_to_assign_role_map_role_id` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='A One To One relationship to explain which permission is needed to manage the given role, the user should have this permission granted to them by RBAC';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_permission_to_assign_role_map_bi`
BEFORE INSERT ON `mot2`.`permission_to_assign_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_permission_to_assign_role_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person`
--

DROP TABLE IF EXISTS `person`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(50) DEFAULT NULL,
  `pin` varchar(60) DEFAULT NULL,
  `person_auth_type_lookup_id` bigint(20) unsigned NOT NULL,
  `user_reference` varchar(100) DEFAULT NULL,
  `mot_one_user_id` varchar(100) DEFAULT NULL,
  `title_id` smallint(5) unsigned DEFAULT NULL,
  `first_name` varchar(45) DEFAULT NULL,
  `middle_name` varchar(45) DEFAULT NULL,
  `family_name` varchar(45) NOT NULL,
  `driving_licence_id` int(10) unsigned DEFAULT NULL,
  `gender_id` smallint(5) unsigned DEFAULT NULL,
  `date_of_birth` date DEFAULT NULL,
  `disability` text,
  `demo_test_tester_status_id` smallint(5) unsigned DEFAULT NULL,
  `otp_failed_attempts` smallint(5) unsigned DEFAULT NULL,
  `is_account_claim_required` tinyint(3) unsigned DEFAULT '1',
  `is_password_change_required` tinyint(3) unsigned DEFAULT '0',
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `mot1_userid` varchar(8) DEFAULT NULL,
  `mot1_current_smartcard_id` varchar(100) DEFAULT NULL,
  `2fa_token_id` varchar(100) DEFAULT NULL COMMENT 'current 2FA token identifier',
  `2fa_token_sent_on` datetime(6) DEFAULT NULL COMMENT 'date current 2fa token was sent',
  `details_confirmed_on` datetime(6) DEFAULT NULL,
  `first_training_test_done_on` datetime(6) DEFAULT NULL COMMENT 'Date first MOT2 training test was done',
  `first_live_test_done_on` datetime(6) DEFAULT NULL COMMENT 'Date first live MOT2 test was done by user',
  `is_deceased` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `deceased_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL COMMENT 'Date of last MOT1 sync update for this record',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  KEY `fk_person_1` (`driving_licence_id`),
  KEY `fk_person_auth_type_lookup_id` (`person_auth_type_lookup_id`),
  KEY `fk_person_gender` (`gender_id`),
  KEY `fk_person_title` (`title_id`),
  KEY `fk_person_transition_status` (`transition_status_id`),
  CONSTRAINT `fk_person_1` FOREIGN KEY (`driving_licence_id`) REFERENCES `licence` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_auth_type_lookup_id` FOREIGN KEY (`person_auth_type_lookup_id`) REFERENCES `person_auth_type_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_gender` FOREIGN KEY (`gender_id`) REFERENCES `gender` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_title` FOREIGN KEY (`title_id`) REFERENCES `title` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_transition_status` FOREIGN KEY (`transition_status_id`) REFERENCES `transition_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_bi`
BEFORE INSERT ON `mot2`.`person`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_bu`
BEFORE UPDATE ON `mot2`.`person`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_au`
AFTER UPDATE ON `mot2`.`person`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`username`
        ,`pin`
        ,`person_auth_type_lookup_id`
        ,`user_reference`
        ,`mot_one_user_id`
        ,`title_id`
        ,`first_name`
        ,`middle_name`
        ,`family_name`
        ,`driving_licence_id`
        ,`gender_id`
        ,`date_of_birth`
        ,`disability`
        ,`demo_test_tester_status_id`
        ,`otp_failed_attempts`
        ,`is_account_claim_required`
        ,`is_password_change_required`
        ,`transition_status_id`
        ,`mot1_userid`
        ,`mot1_current_smartcard_id`
        ,`2fa_token_id`
        ,`2fa_token_sent_on`
        ,`details_confirmed_on`
        ,`first_training_test_done_on`
        ,`first_live_test_done_on`
        ,`is_deceased`
        ,`deceased_on`
        ,`mot1_details_updated_on`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`username`
        ,OLD.`pin`
        ,OLD.`person_auth_type_lookup_id`
        ,OLD.`user_reference`
        ,OLD.`mot_one_user_id`
        ,OLD.`title_id`
        ,OLD.`first_name`
        ,OLD.`middle_name`
        ,OLD.`family_name`
        ,OLD.`driving_licence_id`
        ,OLD.`gender_id`
        ,OLD.`date_of_birth`
        ,OLD.`disability`
        ,OLD.`demo_test_tester_status_id`
        ,OLD.`otp_failed_attempts`
        ,OLD.`is_account_claim_required`
        ,OLD.`is_password_change_required`
        ,OLD.`transition_status_id`
        ,OLD.`mot1_userid`
        ,OLD.`mot1_current_smartcard_id`
        ,OLD.`2fa_token_id`
        ,OLD.`2fa_token_sent_on`
        ,OLD.`details_confirmed_on`
        ,OLD.`first_training_test_done_on`
        ,OLD.`first_live_test_done_on`
        ,OLD.`is_deceased`
        ,OLD.`deceased_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_bd`
BEFORE DELETE ON `mot2`.`person`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`username`
        ,`pin`
        ,`person_auth_type_lookup_id`
        ,`user_reference`
        ,`mot_one_user_id`
        ,`title_id`
        ,`first_name`
        ,`middle_name`
        ,`family_name`
        ,`driving_licence_id`
        ,`gender_id`
        ,`date_of_birth`
        ,`disability`
        ,`demo_test_tester_status_id`
        ,`otp_failed_attempts`
        ,`is_account_claim_required`
        ,`is_password_change_required`
        ,`transition_status_id`
        ,`mot1_userid`
        ,`mot1_current_smartcard_id`
        ,`2fa_token_id`
        ,`2fa_token_sent_on`
        ,`details_confirmed_on`
        ,`first_training_test_done_on`
        ,`first_live_test_done_on`
        ,`is_deceased`
        ,`deceased_on`
        ,`mot1_details_updated_on`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`username`
        ,OLD.`pin`
        ,OLD.`person_auth_type_lookup_id`
        ,OLD.`user_reference`
        ,OLD.`mot_one_user_id`
        ,OLD.`title_id`
        ,OLD.`first_name`
        ,OLD.`middle_name`
        ,OLD.`family_name`
        ,OLD.`driving_licence_id`
        ,OLD.`gender_id`
        ,OLD.`date_of_birth`
        ,OLD.`disability`
        ,OLD.`demo_test_tester_status_id`
        ,OLD.`otp_failed_attempts`
        ,OLD.`is_account_claim_required`
        ,OLD.`is_password_change_required`
        ,OLD.`transition_status_id`
        ,OLD.`mot1_userid`
        ,OLD.`mot1_current_smartcard_id`
        ,OLD.`2fa_token_id`
        ,OLD.`2fa_token_sent_on`
        ,OLD.`details_confirmed_on`
        ,OLD.`first_training_test_done_on`
        ,OLD.`first_live_test_done_on`
        ,OLD.`is_deceased`
        ,OLD.`deceased_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_accesslog`
--

DROP TABLE IF EXISTS `person_accesslog`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_accesslog` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `is_successful` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_person_accesslog_person1` (`person_id`),
  CONSTRAINT `fk_person_accesslog_person1` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_accesslog_bi`
BEFORE INSERT ON `mot2`.`person_accesslog`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_accesslog_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_auth_type_lookup`
--

DROP TABLE IF EXISTS `person_auth_type_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_auth_type_lookup` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_person_auth_type_lookup_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Lookup table for the 2FA method for a person';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_auth_type_lookup_bi`
BEFORE INSERT ON `mot2`.`person_auth_type_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_auth_type_lookup_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_contact_detail_map`
--

DROP TABLE IF EXISTS `person_contact_detail_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_contact_detail_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `contact_type_id` smallint(5) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `contact_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_person_contact_detail_map_contact_details` (`contact_id`),
  KEY `fk_person_contact_detail_map_person` (`person_id`),
  KEY `fk_person_contact_detail_map_person_contact_type` (`contact_type_id`),
  CONSTRAINT `fk_person_contact_detail_map_contact_details` FOREIGN KEY (`contact_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_contact_detail_map_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_contact_detail_map_person_contact_type` FOREIGN KEY (`contact_type_id`) REFERENCES `person_contact_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Used to link a person to their contact details';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_contact_detail_map_bi`
BEFORE INSERT ON `mot2`.`person_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_contact_detail_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_contact_detail_map_bu`
BEFORE UPDATE ON `mot2`.`person_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_contact_detail_map_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_contact_detail_map_au`
AFTER UPDATE ON `mot2`.`person_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_contact_detail_map_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_type_id`
        ,`person_id`
        ,`contact_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`contact_type_id`
        ,OLD.`person_id`
        ,OLD.`contact_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_contact_detail_map_bd`
BEFORE DELETE ON `mot2`.`person_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_contact_detail_map_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_type_id`
        ,`person_id`
        ,`contact_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`contact_type_id`
        ,OLD.`person_id`
        ,OLD.`contact_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_contact_detail_map_hist`
--

DROP TABLE IF EXISTS `person_contact_detail_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_contact_detail_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `contact_type_id` smallint(5) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `contact_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_contact_detail_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `person_contact_type`
--

DROP TABLE IF EXISTS `person_contact_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_contact_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_person_contact_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='The contact type for a contact record held against a person';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_contact_type_bi`
BEFORE INSERT ON `mot2`.`person_contact_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_contact_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_hist`
--

DROP TABLE IF EXISTS `person_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `username` varchar(50) DEFAULT NULL,
  `pin` varchar(60) DEFAULT NULL,
  `person_auth_type_lookup_id` bigint(20) unsigned DEFAULT NULL,
  `user_reference` varchar(100) DEFAULT NULL,
  `mot_one_user_id` varchar(100) DEFAULT NULL,
  `title_id` smallint(5) unsigned DEFAULT NULL,
  `first_name` varchar(45) DEFAULT NULL,
  `middle_name` varchar(45) DEFAULT NULL,
  `family_name` varchar(45) DEFAULT NULL,
  `driving_licence_id` int(10) unsigned DEFAULT NULL,
  `gender_id` smallint(5) unsigned DEFAULT NULL,
  `date_of_birth` date DEFAULT NULL,
  `disability` text,
  `demo_test_tester_status_id` smallint(5) unsigned DEFAULT NULL,
  `otp_failed_attempts` smallint(5) unsigned DEFAULT NULL,
  `is_account_claim_required` tinyint(3) unsigned DEFAULT NULL,
  `is_password_change_required` tinyint(3) unsigned DEFAULT NULL,
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `mot1_userid` varchar(8) DEFAULT NULL,
  `mot1_current_smartcard_id` varchar(100) DEFAULT NULL,
  `2fa_token_id` varchar(100) DEFAULT NULL,
  `2fa_token_sent_on` datetime(6) DEFAULT NULL,
  `details_confirmed_on` datetime(6) DEFAULT NULL,
  `first_training_test_done_on` datetime(6) DEFAULT NULL,
  `first_live_test_done_on` datetime(6) DEFAULT NULL,
  `is_deceased` tinyint(1) unsigned DEFAULT NULL,
  `deceased_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `person_identifying_token_map`
--

DROP TABLE IF EXISTS `person_identifying_token_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_identifying_token_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `identifying_token_id` int(10) unsigned NOT NULL,
  `start_date` datetime(6) DEFAULT NULL,
  `end_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_generic table_identifying_token1` (`identifying_token_id`),
  KEY `fk_generic table_person1` (`person_id`),
  CONSTRAINT `fk_generic table_identifying_token1` FOREIGN KEY (`identifying_token_id`) REFERENCES `identifying_token` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_generic table_person1` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_identifying_token_map_bi`
BEFORE INSERT ON `mot2`.`person_identifying_token_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_identifying_token_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_security_card_map`
--

DROP TABLE IF EXISTS `person_security_card_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_security_card_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `security_card_id` int(10) unsigned NOT NULL,
  `valid_from` datetime DEFAULT NULL,
  `valid_to` datetime DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_pscm_person_id_valid_from` (`person_id`,`valid_from`),
  KEY `ix_pscm_security_card_id` (`security_card_id`),
  KEY `ix_pscm_person_created_by` (`created_by`),
  KEY `ix_pscm_person_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_pscm_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_pscm_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_pscm_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_pscm_security_card_id_security_card_id` FOREIGN KEY (`security_card_id`) REFERENCES `security_card` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_card_map_bi`
BEFORE INSERT ON `mot2`.`person_security_card_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_card_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_card_map_bu`
BEFORE UPDATE ON `mot2`.`person_security_card_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_card_map_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_card_map_au`
AFTER UPDATE ON `mot2`.`person_security_card_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_card_map_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_security_card_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`security_card_id`
        ,`valid_from`
        ,`valid_to`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`security_card_id`
        ,OLD.`valid_from`
        ,OLD.`valid_to`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_card_map_bd`
BEFORE DELETE ON `mot2`.`person_security_card_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_card_map_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_security_card_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`security_card_id`
        ,`valid_from`
        ,`valid_to`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`security_card_id`
        ,OLD.`valid_from`
        ,OLD.`valid_to`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_security_card_map_hist`
--

DROP TABLE IF EXISTS `person_security_card_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_security_card_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `security_card_id` int(10) unsigned DEFAULT NULL,
  `valid_from` datetime DEFAULT NULL,
  `valid_to` datetime DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_security_card_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='DDL GENERATED 2016-08-03 14:49:06';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `person_security_question_answer`
--

DROP TABLE IF EXISTS `person_security_question_answer`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_security_question_answer` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_security_question_map_id` int(10) unsigned NOT NULL,
  `is_answered_correctly` tinyint(4) NOT NULL DEFAULT '0',
  `is_service_desk` tinyint(4) NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_answer_person_security_question_map` (`person_security_question_map_id`),
  CONSTRAINT `fk_answer_person_security_question_map` FOREIGN KEY (`person_security_question_map_id`) REFERENCES `person_security_question_map` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_question_answer_bi`
BEFORE INSERT ON `mot2`.`person_security_question_answer`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_question_answer_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_security_question_map`
--

DROP TABLE IF EXISTS `person_security_question_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_security_question_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `security_question_id` int(10) unsigned NOT NULL,
  `answer` varchar(80) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_person_has_security_question_person1` (`person_id`),
  KEY `fk_person_has_security_question_security_question1` (`security_question_id`),
  CONSTRAINT `fk_person_has_security_question_person1` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_has_security_question_security_question1` FOREIGN KEY (`security_question_id`) REFERENCES `security_question` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_question_map_bi`
BEFORE INSERT ON `mot2`.`person_security_question_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_question_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_question_map_bu`
BEFORE UPDATE ON `mot2`.`person_security_question_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_question_map_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_question_map_au`
AFTER UPDATE ON `mot2`.`person_security_question_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_question_map_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_security_question_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`security_question_id`
        ,`answer`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`security_question_id`
        ,OLD.`answer`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_security_question_map_bd`
BEFORE DELETE ON `mot2`.`person_security_question_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_security_question_map_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_security_question_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`security_question_id`
        ,`answer`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`security_question_id`
        ,OLD.`answer`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_security_question_map_hist`
--

DROP TABLE IF EXISTS `person_security_question_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_security_question_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `security_question_id` int(10) unsigned DEFAULT NULL,
  `answer` varchar(80) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_security_question_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `person_system_role`
--

DROP TABLE IF EXISTS `person_system_role`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_system_role` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `full_name` varchar(250) NOT NULL,
  `short_name` varchar(50) NOT NULL,
  `role_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_person_system_role_role` (`role_id`),
  CONSTRAINT `fk_person_system_role_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Roles in the system that are not organisation/site specific. e.g. Root, Admin, Login';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_bi`
BEFORE INSERT ON `mot2`.`person_system_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_bu`
BEFORE UPDATE ON `mot2`.`person_system_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_au`
AFTER UPDATE ON `mot2`.`person_system_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_system_role_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`full_name`
        ,`short_name`
        ,`role_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`full_name`
        ,OLD.`short_name`
        ,OLD.`role_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_bd`
BEFORE DELETE ON `mot2`.`person_system_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_system_role_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`full_name`
        ,`short_name`
        ,`role_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`full_name`
        ,OLD.`short_name`
        ,OLD.`role_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_system_role_hist`
--

DROP TABLE IF EXISTS `person_system_role_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_system_role_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `full_name` varchar(250) DEFAULT NULL,
  `short_name` varchar(50) DEFAULT NULL,
  `role_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_system_role_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `person_system_role_map`
--

DROP TABLE IF EXISTS `person_system_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_system_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `person_system_role_id` smallint(5) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_person_system_role_map` (`person_system_role_id`),
  KEY `fk_person_system_role_map_person` (`person_id`),
  KEY `fk_person_system_role_map_status` (`status_id`),
  CONSTRAINT `fk_person_system_role_map` FOREIGN KEY (`person_system_role_id`) REFERENCES `person_system_role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_system_role_map_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_person_system_role_map_status` FOREIGN KEY (`status_id`) REFERENCES `business_role_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='A persons role within the system  i.e. Admin';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_map_bi`
BEFORE INSERT ON `mot2`.`person_system_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_map_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_map_bu`
BEFORE UPDATE ON `mot2`.`person_system_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_map_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_map_au`
AFTER UPDATE ON `mot2`.`person_system_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_map_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_system_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`person_system_role_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`person_system_role_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_person_system_role_map_bd`
BEFORE DELETE ON `mot2`.`person_system_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_person_system_role_map_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`person_system_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`person_system_role_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`person_system_role_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `person_system_role_map_hist`
--

DROP TABLE IF EXISTS `person_system_role_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `person_system_role_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `person_system_role_id` smallint(5) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_person_system_role_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `phone`
--

DROP TABLE IF EXISTS `phone`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `phone` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `contact_detail_id` int(10) unsigned NOT NULL,
  `number` varchar(24) NOT NULL,
  `phone_contact_type_id` smallint(5) unsigned NOT NULL,
  `is_primary` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_phone_contact_detail_id` (`contact_detail_id`),
  KEY `fk_phone_contact_phone_contact_type_id` (`phone_contact_type_id`),
  CONSTRAINT `fk_phone_contact_detail_id` FOREIGN KEY (`contact_detail_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_phone_contact_phone_contact_type_id` FOREIGN KEY (`phone_contact_type_id`) REFERENCES `phone_contact_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of a phone number.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_phone_bi`
BEFORE INSERT ON `mot2`.`phone`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_phone_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_phone_bu`
BEFORE UPDATE ON `mot2`.`phone`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_phone_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_phone_au`
AFTER UPDATE ON `mot2`.`phone`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_phone_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`phone_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_detail_id`
        ,`number`
        ,`phone_contact_type_id`
        ,`is_primary`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`contact_detail_id`
        ,OLD.`number`
        ,OLD.`phone_contact_type_id`
        ,OLD.`is_primary`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_phone_bd`
BEFORE DELETE ON `mot2`.`phone`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_phone_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`phone_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`contact_detail_id`
        ,`number`
        ,`phone_contact_type_id`
        ,`is_primary`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`contact_detail_id`
        ,OLD.`number`
        ,OLD.`phone_contact_type_id`
        ,OLD.`is_primary`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `phone_contact_type`
--

DROP TABLE IF EXISTS `phone_contact_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `phone_contact_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone_contact_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the type of contact record.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_phone_contact_type_bi`
BEFORE INSERT ON `mot2`.`phone_contact_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_phone_contact_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `phone_hist`
--

DROP TABLE IF EXISTS `phone_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `phone_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `contact_detail_id` int(10) unsigned DEFAULT NULL,
  `number` varchar(24) DEFAULT NULL,
  `phone_contact_type_id` smallint(5) unsigned DEFAULT NULL,
  `is_primary` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_phone_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `qualification`
--

DROP TABLE IF EXISTS `qualification`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualification` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(100) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `qualification_type_id` smallint(5) unsigned NOT NULL,
  `awarded_by_organisation_id` int(10) unsigned NOT NULL,
  `country_lookup_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_qualification_country_lookup_id` (`country_lookup_id`),
  KEY `fk_qualification_qualification_type` (`qualification_type_id`),
  CONSTRAINT `fk_qualification_country_lookup_id` FOREIGN KEY (`country_lookup_id`) REFERENCES `country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_qualification_qualification_type` FOREIGN KEY (`qualification_type_id`) REFERENCES `qualification_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Qualification held by a person';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_bi`
BEFORE INSERT ON `mot2`.`qualification`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `qualification_annual_certificate`
--

DROP TABLE IF EXISTS `qualification_annual_certificate`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualification_annual_certificate` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `vehicle_class_group_id` int(10) unsigned NOT NULL,
  `certificate_number` varchar(50) DEFAULT NULL,
  `date_awarded` date DEFAULT NULL,
  `score` int(11) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_qualification_annual_certificate_person_id` (`person_id`),
  KEY `ix_qualification_annual_certificate_person_created_by` (`created_by`),
  KEY `ix_qualification_annual_certificate_person_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_qualification_annual_certificate_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_qualification_annual_certificate_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_qualification_annual_certificate_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_annual_certificate_bi`
BEFORE INSERT ON `mot2`.`qualification_annual_certificate`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_annual_certificate_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_annual_certificate_bu`
BEFORE UPDATE ON `mot2`.`qualification_annual_certificate`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_annual_certificate_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_annual_certificate_au`
AFTER UPDATE ON `mot2`.`qualification_annual_certificate`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_annual_certificate_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`qualification_annual_certificate_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_class_group_id`
        ,`certificate_number`
        ,`date_awarded`
        ,`score`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_class_group_id`
        ,OLD.`certificate_number`
        ,OLD.`date_awarded`
        ,OLD.`score`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_annual_certificate_bd`
BEFORE DELETE ON `mot2`.`qualification_annual_certificate`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_annual_certificate_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`qualification_annual_certificate_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vehicle_class_group_id`
        ,`certificate_number`
        ,`date_awarded`
        ,`score`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vehicle_class_group_id`
        ,OLD.`certificate_number`
        ,OLD.`date_awarded`
        ,OLD.`score`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `qualification_annual_certificate_hist`
--

DROP TABLE IF EXISTS `qualification_annual_certificate_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualification_annual_certificate_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vehicle_class_group_id` int(10) unsigned DEFAULT NULL,
  `certificate_number` varchar(50) DEFAULT NULL,
  `date_awarded` date DEFAULT NULL,
  `score` int(11) NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_qualification_annual_certificate` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `qualification_award`
--

DROP TABLE IF EXISTS `qualification_award`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualification_award` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `vehicle_class_group_id` int(10) unsigned NOT NULL,
  `certificate_number` varchar(50) DEFAULT NULL,
  `date_of_qualification` date DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_qualification_award_person_id_person_id` (`person_id`),
  KEY `fk_qualification_award_site_id_site_id` (`site_id`),
  CONSTRAINT `fk_qualification_award_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_qualification_award_site_id_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_award_bi`
BEFORE INSERT ON `mot2`.`qualification_award`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_award_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `qualification_type`
--

DROP TABLE IF EXISTS `qualification_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `qualification_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the type of qualification held by a person';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_qualification_type_bi`
BEFORE INSERT ON `mot2`.`qualification_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_qualification_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `reason_for_rejection`
--

DROP TABLE IF EXISTS `reason_for_rejection`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reason_for_rejection` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `test_item_category_id` int(10) unsigned NOT NULL,
  `test_item_selector_name` varchar(100) NOT NULL,
  `test_item_selector_name_cy` varchar(100) NOT NULL,
  `inspection_manual_reference` varchar(10) NOT NULL,
  `minor_item` tinyint(4) NOT NULL,
  `location_marker` tinyint(4) NOT NULL,
  `qt_marker` tinyint(4) NOT NULL,
  `note` tinyint(4) NOT NULL,
  `manual` varchar(1) NOT NULL,
  `spec_proc` tinyint(4) NOT NULL,
  `is_advisory` tinyint(3) unsigned NOT NULL,
  `is_prs_fail` tinyint(3) unsigned NOT NULL,
  `section_test_item_selector_id` int(10) unsigned NOT NULL,
  `can_be_dangerous` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'Flag to show whether to display failure_dangerous checkbox',
  `date_first_used` datetime DEFAULT NULL,
  `audience` varchar(1) NOT NULL DEFAULT 'b' COMMENT 'TODO: This should be replaced by a business rule when rules engine supports permissions',
  `end_date` date DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_test_item_selector_rfr_section_test_item_selector_id` (`section_test_item_selector_id`),
  KEY `fk_test_item_selector_rfr_test_item_selector_id` (`test_item_category_id`),
  FULLTEXT KEY `ft_description` (`test_item_selector_name`),
  CONSTRAINT `fk_test_item_selector_rfr_section_test_item_selector_id` FOREIGN KEY (`section_test_item_selector_id`) REFERENCES `test_item_category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_item_selector_rfr_test_item_selector_id` FOREIGN KEY (`test_item_category_id`) REFERENCES `test_item_category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Reasons For Rejection including advisory only and items not tested';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_reason_for_rejection_bi`
BEFORE INSERT ON `mot2`.`reason_for_rejection`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_reason_for_rejection_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_reason_for_rejection_bu`
BEFORE UPDATE ON `mot2`.`reason_for_rejection`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_reason_for_rejection_bu Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_reason_for_rejection_au`
AFTER UPDATE ON `mot2`.`reason_for_rejection`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_reason_for_rejection_au Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`reason_for_rejection_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`test_item_category_id`
        ,`test_item_selector_name`
        ,`test_item_selector_name_cy`
        ,`inspection_manual_reference`
        ,`minor_item`
        ,`location_marker`
        ,`qt_marker`
        ,`note`
        ,`manual`
        ,`spec_proc`
        ,`is_advisory`
        ,`is_prs_fail`
        ,`section_test_item_selector_id`
        ,`can_be_dangerous`
        ,`date_first_used`
        ,`audience`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`test_item_category_id`
        ,OLD.`test_item_selector_name`
        ,OLD.`test_item_selector_name_cy`
        ,OLD.`inspection_manual_reference`
        ,OLD.`minor_item`
        ,OLD.`location_marker`
        ,OLD.`qt_marker`
        ,OLD.`note`
        ,OLD.`manual`
        ,OLD.`spec_proc`
        ,OLD.`is_advisory`
        ,OLD.`is_prs_fail`
        ,OLD.`section_test_item_selector_id`
        ,OLD.`can_be_dangerous`
        ,OLD.`date_first_used`
        ,OLD.`audience`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_reason_for_rejection_bd`
BEFORE DELETE ON `mot2`.`reason_for_rejection`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_reason_for_rejection_bd Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`reason_for_rejection_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`test_item_category_id`
        ,`test_item_selector_name`
        ,`test_item_selector_name_cy`
        ,`inspection_manual_reference`
        ,`minor_item`
        ,`location_marker`
        ,`qt_marker`
        ,`note`
        ,`manual`
        ,`spec_proc`
        ,`is_advisory`
        ,`is_prs_fail`
        ,`section_test_item_selector_id`
        ,`can_be_dangerous`
        ,`date_first_used`
        ,`audience`
        ,`end_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`test_item_category_id`
        ,OLD.`test_item_selector_name`
        ,OLD.`test_item_selector_name_cy`
        ,OLD.`inspection_manual_reference`
        ,OLD.`minor_item`
        ,OLD.`location_marker`
        ,OLD.`qt_marker`
        ,OLD.`note`
        ,OLD.`manual`
        ,OLD.`spec_proc`
        ,OLD.`is_advisory`
        ,OLD.`is_prs_fail`
        ,OLD.`section_test_item_selector_id`
        ,OLD.`can_be_dangerous`
        ,OLD.`date_first_used`
        ,OLD.`audience`
        ,OLD.`end_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `reason_for_rejection_hist`
--

DROP TABLE IF EXISTS `reason_for_rejection_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reason_for_rejection_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `test_item_category_id` int(10) unsigned DEFAULT NULL,
  `test_item_selector_name` varchar(100) DEFAULT NULL,
  `test_item_selector_name_cy` varchar(100) DEFAULT NULL,
  `inspection_manual_reference` varchar(10) DEFAULT NULL,
  `minor_item` tinyint(4) DEFAULT NULL,
  `location_marker` tinyint(4) DEFAULT NULL,
  `qt_marker` tinyint(4) DEFAULT NULL,
  `note` tinyint(4) DEFAULT NULL,
  `manual` varchar(1) DEFAULT NULL,
  `spec_proc` tinyint(4) DEFAULT NULL,
  `is_advisory` tinyint(3) unsigned DEFAULT NULL,
  `is_prs_fail` tinyint(3) unsigned DEFAULT NULL,
  `section_test_item_selector_id` int(10) unsigned DEFAULT NULL,
  `can_be_dangerous` tinyint(4) DEFAULT NULL,
  `date_first_used` datetime DEFAULT NULL,
  `audience` varchar(1) DEFAULT NULL,
  `end_date` date DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_reason_for_rejection_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `reason_for_rejection_type`
--

DROP TABLE IF EXISTS `reason_for_rejection_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `reason_for_rejection_type` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `description` varchar(250) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_reason_for_rejection_type_name` (`name`),
  UNIQUE KEY `uk_reason_for_rejection_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of type of RFR';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_reason_for_rejection_type_bi`
BEFORE INSERT ON `mot2`.`reason_for_rejection_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_reason_for_rejection_type_bi Generated on 2016-12-12 11:29:02. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `rfr_business_rule_map`
--

DROP TABLE IF EXISTS `rfr_business_rule_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rfr_business_rule_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `rfr_id` int(10) unsigned NOT NULL,
  `business_rule_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_rfr_business_rule_map_business_rule1` (`business_rule_id`),
  KEY `fk_rfr_business_rule_map_reason_for_rejection1` (`rfr_id`),
  CONSTRAINT `fk_rfr_business_rule_map_business_rule1` FOREIGN KEY (`business_rule_id`) REFERENCES `business_rule` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_rfr_business_rule_map_reason_for_rejection1` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Business rule on how to apply this RFR helps to facilitate mutiple rules based on class i.e. rule may apply to older class 4 then class 5 vehicles';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_rfr_business_rule_map_bi`
BEFORE INSERT ON `mot2`.`rfr_business_rule_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_rfr_business_rule_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `rfr_language_content_map`
--

DROP TABLE IF EXISTS `rfr_language_content_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rfr_language_content_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `rfr_id` int(10) unsigned NOT NULL,
  `language_type_id` smallint(5) unsigned NOT NULL,
  `name` varchar(500) NOT NULL,
  `inspection_manual_description` varchar(500) DEFAULT NULL,
  `advisory_text` varchar(250) DEFAULT NULL,
  `test_item_selector_name` varchar(100) DEFAULT NULL COMMENT 'FOR FULLTEXT SEARCH',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_rfr_language_media_map_language_type1` (`language_type_id`),
  KEY `fk_rfr_language_media_map_reason_for_rejection1` (`rfr_id`),
  FULLTEXT KEY `ft_name` (`name`,`test_item_selector_name`),
  CONSTRAINT `fk_rfr_language_media_map_language_type1` FOREIGN KEY (`language_type_id`) REFERENCES `language_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_rfr_language_media_map_reason_for_rejection1` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='How RFRs are displayed in different languages and presented';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_rfr_language_content_map_bi`
BEFORE INSERT ON `mot2`.`rfr_language_content_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_rfr_language_content_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `rfr_vehicle_class_map`
--

DROP TABLE IF EXISTS `rfr_vehicle_class_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `rfr_vehicle_class_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `rfr_id` int(10) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `business_rule_id` int(10) unsigned DEFAULT NULL COMMENT 'Filter for RFRs to handle rules that require more than vehicle class',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_rfr_vehicle_class_mapq` (`vehicle_class_id`),
  KEY `fk_rfr_vehicle_class_map_business_rule1` (`business_rule_id`),
  KEY `fk_rfr_vehicle_class_map_test_item_selector_rfr` (`rfr_id`),
  CONSTRAINT `fk_rfr_vehicle_class_map_business_rule1` FOREIGN KEY (`business_rule_id`) REFERENCES `business_rule` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_rfr_vehicle_class_map_test_item_selector_rfr` FOREIGN KEY (`rfr_id`) REFERENCES `reason_for_rejection` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_rfr_vehicle_class_mapq` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='reasons for rejection for a specific class';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_rfr_vehicle_class_map_bi`
BEFORE INSERT ON `mot2`.`rfr_vehicle_class_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_rfr_vehicle_class_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `role`
--

DROP TABLE IF EXISTS `role`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `role` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(40) CHARACTER SET latin1 NOT NULL,
  `is_internal` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT 'An internal role relates to a government worker, not someone who perfoms MOTs',
  `is_trade` tinyint(3) unsigned NOT NULL DEFAULT '0' COMMENT 'A trade role is associated to an MOT tester or MOT testing management',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_bi`
BEFORE INSERT ON `mot2`.`role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_bu`
BEFORE UPDATE ON `mot2`.`role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_au`
AFTER UPDATE ON `mot2`.`role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`role_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`is_internal`
        ,`is_trade`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`is_internal`
        ,OLD.`is_trade`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_bd`
BEFORE DELETE ON `mot2`.`role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`role_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`name`
        ,`code`
        ,`is_internal`
        ,`is_trade`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`name`
        ,OLD.`code`
        ,OLD.`is_internal`
        ,OLD.`is_trade`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `role_hist`
--

DROP TABLE IF EXISTS `role_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `role_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `code` varchar(40) CHARACTER SET latin1 DEFAULT NULL,
  `is_internal` tinyint(3) unsigned DEFAULT NULL,
  `is_trade` tinyint(3) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_role_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `role_permission_map`
--

DROP TABLE IF EXISTS `role_permission_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `role_permission_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `role_id` int(10) unsigned NOT NULL,
  `permission_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_permission_map_role_id_permission_id` (`role_id`,`permission_id`),
  KEY `fk_role_permission_map_permission` (`permission_id`),
  CONSTRAINT `fk_role_permission_map_permission` FOREIGN KEY (`permission_id`) REFERENCES `permission` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_role_permission_map_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_permission_map_bi`
BEFORE INSERT ON `mot2`.`role_permission_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_permission_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_permission_map_bu`
BEFORE UPDATE ON `mot2`.`role_permission_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_permission_map_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_permission_map_au`
AFTER UPDATE ON `mot2`.`role_permission_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_permission_map_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`role_permission_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`role_id`
        ,`permission_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`role_id`
        ,OLD.`permission_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_role_permission_map_bd`
BEFORE DELETE ON `mot2`.`role_permission_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_role_permission_map_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`role_permission_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`role_id`
        ,`permission_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`role_id`
        ,OLD.`permission_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `role_permission_map_hist`
--

DROP TABLE IF EXISTS `role_permission_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `role_permission_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `role_id` int(10) unsigned DEFAULT NULL,
  `permission_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_role_permission_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `security_card`
--

DROP TABLE IF EXISTS `security_card`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `serial_number` varchar(20) NOT NULL,
  `secret` varchar(250) NOT NULL,
  `security_card_status_lookup_id` tinyint(3) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_security_card_serial_number` (`serial_number`),
  KEY `ix_security_card_security_card_status_lookup_id` (`security_card_status_lookup_id`),
  KEY `ix_security_card_person_created_by` (`created_by`),
  KEY `ix_security_card_person_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_security_card_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_status_id_security_card_status_lookup_id` FOREIGN KEY (`security_card_status_lookup_id`) REFERENCES `security_card_status_lookup` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_bi`
BEFORE INSERT ON `mot2`.`security_card`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_bu`
BEFORE UPDATE ON `mot2`.`security_card`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_au`
AFTER UPDATE ON `mot2`.`security_card`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`serial_number`
        ,`secret`
        ,`security_card_status_lookup_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`serial_number`
        ,OLD.`secret`
        ,OLD.`security_card_status_lookup_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_bd`
BEFORE DELETE ON `mot2`.`security_card`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`serial_number`
        ,`secret`
        ,`security_card_status_lookup_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`serial_number`
        ,OLD.`secret`
        ,OLD.`security_card_status_lookup_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `security_card_drift`
--

DROP TABLE IF EXISTS `security_card_drift`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_drift` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `security_card_id` int(10) unsigned NOT NULL,
  `last_observed_drift` int(11) NOT NULL COMMENT 'in seconds, negative - past current time, positive - ahead of current time',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_security_card_drift_security_card_id` (`security_card_id`),
  KEY `ix_security_card_drift_person_created_by` (`created_by`),
  KEY `ix_security_card_drift_person_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_security_card_drift_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_drift_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_drift_security_card_id_security_card_id` FOREIGN KEY (`security_card_id`) REFERENCES `security_card` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_drift_bi`
BEFORE INSERT ON `mot2`.`security_card_drift`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_drift_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_drift_bu`
BEFORE UPDATE ON `mot2`.`security_card_drift`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_drift_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_drift_au`
AFTER UPDATE ON `mot2`.`security_card_drift`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_drift_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_drift_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`security_card_id`
        ,`last_observed_drift`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`security_card_id`
        ,OLD.`last_observed_drift`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_drift_bd`
BEFORE DELETE ON `mot2`.`security_card_drift`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_drift_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_drift_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`security_card_id`
        ,`last_observed_drift`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`security_card_id`
        ,OLD.`last_observed_drift`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `security_card_drift_hist`
--

DROP TABLE IF EXISTS `security_card_drift_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_drift_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `security_card_id` int(10) unsigned DEFAULT NULL,
  `last_observed_drift` int(11) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_security_card_drift_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='DDL GENERATED 2016-10-20 11:48:55';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `security_card_hist`
--

DROP TABLE IF EXISTS `security_card_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `serial_number` varchar(20) DEFAULT NULL,
  `secret` varchar(250) DEFAULT NULL,
  `security_card_status_lookup_id` tinyint(3) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_security_card_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='DDL GENERATED 2016-08-03 14:48:55';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `security_card_order`
--

DROP TABLE IF EXISTS `security_card_order`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_order` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `person_id` int(10) unsigned NOT NULL,
  `vts_name` varchar(100) DEFAULT NULL,
  `address_line_1` varchar(50) NOT NULL,
  `address_line_2` varchar(50) DEFAULT NULL,
  `address_line_3` varchar(50) DEFAULT NULL,
  `postcode` varchar(10) NOT NULL,
  `town` varchar(50) NOT NULL,
  `submitted_on` datetime(6) NOT NULL,
  `submitted_by` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_security_card_order_person_id` (`person_id`),
  KEY `ix_security_card_order_created_by` (`created_by`),
  KEY `ix_security_card_order_last_updated_by` (`last_updated_by`),
  KEY `ix_security_card_order_submitted_on` (`submitted_on`),
  KEY `ix_security_card_order_submitted_by` (`submitted_by`),
  CONSTRAINT `fk_security_card_order_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_order_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_order_person_id_person_id` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_order_submitted_by_person_id` FOREIGN KEY (`submitted_by`) REFERENCES `person` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_order_bi`
BEFORE INSERT ON `mot2`.`security_card_order`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_order_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_order_bu`
BEFORE UPDATE ON `mot2`.`security_card_order`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_order_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_order_au`
AFTER UPDATE ON `mot2`.`security_card_order`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_order_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_order_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vts_name`
        ,`address_line_1`
        ,`address_line_2`
        ,`address_line_3`
        ,`postcode`
        ,`town`
        ,`submitted_on`
        ,`submitted_by`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vts_name`
        ,OLD.`address_line_1`
        ,OLD.`address_line_2`
        ,OLD.`address_line_3`
        ,OLD.`postcode`
        ,OLD.`town`
        ,OLD.`submitted_on`
        ,OLD.`submitted_by`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_order_bd`
BEFORE DELETE ON `mot2`.`security_card_order`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_order_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_order_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`person_id`
        ,`vts_name`
        ,`address_line_1`
        ,`address_line_2`
        ,`address_line_3`
        ,`postcode`
        ,`town`
        ,`submitted_on`
        ,`submitted_by`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`person_id`
        ,OLD.`vts_name`
        ,OLD.`address_line_1`
        ,OLD.`address_line_2`
        ,OLD.`address_line_3`
        ,OLD.`postcode`
        ,OLD.`town`
        ,OLD.`submitted_on`
        ,OLD.`submitted_by`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `security_card_order_hist`
--

DROP TABLE IF EXISTS `security_card_order_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_order_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `vts_name` varchar(100) DEFAULT NULL,
  `address_line_1` varchar(50) DEFAULT NULL,
  `address_line_2` varchar(50) DEFAULT NULL,
  `address_line_3` varchar(50) DEFAULT NULL,
  `postcode` varchar(10) DEFAULT NULL,
  `town` varchar(50) DEFAULT NULL,
  `submitted_on` datetime(6) DEFAULT NULL,
  `submitted_by` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_security_card_order_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='DDL GENERATED 2016-08-03 14:55:00';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `security_card_status_lookup`
--

DROP TABLE IF EXISTS `security_card_status_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_status_lookup` (
  `id` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(30) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uq_security_card_status_lookup_code` (`code`),
  KEY `ix_security_card_status_lookup_created_by` (`created_by`),
  KEY `ix_security_card_status_lookup_last_updated_by` (`last_updated_by`),
  CONSTRAINT `fk_security_card_status_lookup_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_security_card_status_lookup_last_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_status_lookup_bi`
BEFORE INSERT ON `mot2`.`security_card_status_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_status_lookup_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_status_lookup_bu`
BEFORE UPDATE ON `mot2`.`security_card_status_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_status_lookup_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_status_lookup_au`
AFTER UPDATE ON `mot2`.`security_card_status_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_status_lookup_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_status_lookup_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_card_status_lookup_bd`
BEFORE DELETE ON `mot2`.`security_card_status_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_card_status_lookup_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`security_card_status_lookup_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `security_card_status_lookup_hist`
--

DROP TABLE IF EXISTS `security_card_status_lookup_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_card_status_lookup_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` tinyint(3) unsigned DEFAULT NULL,
  `code` varchar(5) DEFAULT NULL,
  `name` varchar(30) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_security_card_status_lookup_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='DDL GENERATED 2016-08-03 14:45:54';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `security_question`
--

DROP TABLE IF EXISTS `security_question`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `security_question` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `question_text` varchar(80) NOT NULL,
  `question_group` tinyint(4) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_security_question_bi`
BEFORE INSERT ON `mot2`.`security_question`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_security_question_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site`
--

DROP TABLE IF EXISTS `site`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `name` varchar(100) NOT NULL,
  `site_number` varchar(45) NOT NULL,
  `site_status_id` bigint(20) unsigned NOT NULL COMMENT 'Vehicle Testing Station Status',
  `status_changed_on` datetime(6) DEFAULT NULL COMMENT 'Vehicle Testing Station Status Effective Date',
  `default_brake_test_class_1_and_2_id` smallint(5) unsigned DEFAULT NULL,
  `default_service_brake_test_class_3_and_above_id` smallint(5) unsigned DEFAULT NULL,
  `default_parking_brake_test_class_3_and_above_id` smallint(5) unsigned DEFAULT NULL,
  `last_site_assessment_id` int(10) unsigned DEFAULT NULL,
  `dual_language` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `scottish_bank_holiday` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `latitude` decimal(8,5) DEFAULT NULL,
  `longitude` decimal(8,5) DEFAULT NULL,
  `type_id` smallint(5) unsigned NOT NULL,
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `non_working_day_country_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `first_login_by` int(10) unsigned DEFAULT NULL,
  `first_login_on` datetime(6) DEFAULT NULL,
  `first_test_carried_out_by` int(10) unsigned DEFAULT NULL,
  `first_test_carried_out_number` int(10) unsigned DEFAULT NULL,
  `first_test_carried_out_on` datetime(6) DEFAULT NULL,
  `first_live_test_carried_out_by` int(10) unsigned DEFAULT NULL,
  `first_live_test_carried_out_number` int(10) unsigned DEFAULT NULL,
  `first_live_test_carried_out_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL,
  `mot1_vts_device_status_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_site_site_number` (`site_number`),
  KEY `fk_site_assessment_id` (`last_site_assessment_id`),
  KEY `fk_site_default_brake_test_class_1_and_2_id` (`default_brake_test_class_1_and_2_id`),
  KEY `fk_site_default_parking_brake_test_class_3_and_above_id` (`default_parking_brake_test_class_3_and_above_id`),
  KEY `fk_site_default_service_brake_test_class_3_and_above_id` (`default_service_brake_test_class_3_and_above_id`),
  KEY `fk_site_first_live_test_person` (`first_live_test_carried_out_by`),
  KEY `fk_site_first_login_person` (`first_login_by`),
  KEY `fk_site_first_test_person` (`first_test_carried_out_by`),
  KEY `fk_site_mot1_vts_device_status_id` (`mot1_vts_device_status_id`),
  KEY `fk_site_non_working_day_country_lookup_id` (`non_working_day_country_lookup_id`),
  KEY `fk_site_organisation` (`organisation_id`),
  KEY `fk_site_site_status_id_site_status_lookup_id` (`site_status_id`),
  KEY `fk_site_transition_status_id` (`transition_status_id`),
  KEY `fk_site_type_id` (`type_id`),
  FULLTEXT KEY `ft_site_number_name` (`site_number`,`name`),
  CONSTRAINT `fk_site_assessment_id` FOREIGN KEY (`last_site_assessment_id`) REFERENCES `enforcement_site_assessment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_default_brake_test_class_1_and_2_id` FOREIGN KEY (`default_brake_test_class_1_and_2_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_default_parking_brake_test_class_3_and_above_id` FOREIGN KEY (`default_parking_brake_test_class_3_and_above_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_default_service_brake_test_class_3_and_above_id` FOREIGN KEY (`default_service_brake_test_class_3_and_above_id`) REFERENCES `brake_test_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_first_live_test_person` FOREIGN KEY (`first_live_test_carried_out_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_first_login_person` FOREIGN KEY (`first_login_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_first_test_person` FOREIGN KEY (`first_test_carried_out_by`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_mot1_vts_device_status_id` FOREIGN KEY (`mot1_vts_device_status_id`) REFERENCES `mot1_vts_device_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_non_working_day_country_lookup_id` FOREIGN KEY (`non_working_day_country_lookup_id`) REFERENCES `non_working_day_country_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_organisation` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_site_status_id_site_status_lookup_id` FOREIGN KEY (`site_status_id`) REFERENCES `site_status_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_transition_status_id` FOREIGN KEY (`transition_status_id`) REFERENCES `transition_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_type_id` FOREIGN KEY (`type_id`) REFERENCES `site_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of a site in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_bi`
BEFORE INSERT ON `mot2`.`site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_bu`
BEFORE UPDATE ON `mot2`.`site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_au`
AFTER UPDATE ON `mot2`.`site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`name`
        ,`site_number`
        ,`site_status_id`
        ,`status_changed_on`
        ,`default_brake_test_class_1_and_2_id`
        ,`default_service_brake_test_class_3_and_above_id`
        ,`default_parking_brake_test_class_3_and_above_id`
        ,`last_site_assessment_id`
        ,`dual_language`
        ,`scottish_bank_holiday`
        ,`latitude`
        ,`longitude`
        ,`type_id`
        ,`transition_status_id`
        ,`non_working_day_country_lookup_id`
        ,`first_login_by`
        ,`first_login_on`
        ,`first_test_carried_out_by`
        ,`first_test_carried_out_number`
        ,`first_test_carried_out_on`
        ,`first_live_test_carried_out_by`
        ,`first_live_test_carried_out_number`
        ,`first_live_test_carried_out_on`
        ,`mot1_details_updated_on`
        ,`mot1_vts_device_status_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`name`
        ,OLD.`site_number`
        ,OLD.`site_status_id`
        ,OLD.`status_changed_on`
        ,OLD.`default_brake_test_class_1_and_2_id`
        ,OLD.`default_service_brake_test_class_3_and_above_id`
        ,OLD.`default_parking_brake_test_class_3_and_above_id`
        ,OLD.`last_site_assessment_id`
        ,OLD.`dual_language`
        ,OLD.`scottish_bank_holiday`
        ,OLD.`latitude`
        ,OLD.`longitude`
        ,OLD.`type_id`
        ,OLD.`transition_status_id`
        ,OLD.`non_working_day_country_lookup_id`
        ,OLD.`first_login_by`
        ,OLD.`first_login_on`
        ,OLD.`first_test_carried_out_by`
        ,OLD.`first_test_carried_out_number`
        ,OLD.`first_test_carried_out_on`
        ,OLD.`first_live_test_carried_out_by`
        ,OLD.`first_live_test_carried_out_number`
        ,OLD.`first_live_test_carried_out_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`mot1_vts_device_status_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_bd`
BEFORE DELETE ON `mot2`.`site`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`name`
        ,`site_number`
        ,`site_status_id`
        ,`status_changed_on`
        ,`default_brake_test_class_1_and_2_id`
        ,`default_service_brake_test_class_3_and_above_id`
        ,`default_parking_brake_test_class_3_and_above_id`
        ,`last_site_assessment_id`
        ,`dual_language`
        ,`scottish_bank_holiday`
        ,`latitude`
        ,`longitude`
        ,`type_id`
        ,`transition_status_id`
        ,`non_working_day_country_lookup_id`
        ,`first_login_by`
        ,`first_login_on`
        ,`first_test_carried_out_by`
        ,`first_test_carried_out_number`
        ,`first_test_carried_out_on`
        ,`first_live_test_carried_out_by`
        ,`first_live_test_carried_out_number`
        ,`first_live_test_carried_out_on`
        ,`mot1_details_updated_on`
        ,`mot1_vts_device_status_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`name`
        ,OLD.`site_number`
        ,OLD.`site_status_id`
        ,OLD.`status_changed_on`
        ,OLD.`default_brake_test_class_1_and_2_id`
        ,OLD.`default_service_brake_test_class_3_and_above_id`
        ,OLD.`default_parking_brake_test_class_3_and_above_id`
        ,OLD.`last_site_assessment_id`
        ,OLD.`dual_language`
        ,OLD.`scottish_bank_holiday`
        ,OLD.`latitude`
        ,OLD.`longitude`
        ,OLD.`type_id`
        ,OLD.`transition_status_id`
        ,OLD.`non_working_day_country_lookup_id`
        ,OLD.`first_login_by`
        ,OLD.`first_login_on`
        ,OLD.`first_test_carried_out_by`
        ,OLD.`first_test_carried_out_number`
        ,OLD.`first_test_carried_out_on`
        ,OLD.`first_live_test_carried_out_by`
        ,OLD.`first_live_test_carried_out_number`
        ,OLD.`first_live_test_carried_out_on`
        ,OLD.`mot1_details_updated_on`
        ,OLD.`mot1_vts_device_status_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_assembly_role_map`
--

DROP TABLE IF EXISTS `site_assembly_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_assembly_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `assembly_id` int(10) unsigned NOT NULL,
  `assembly_role_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_site_assembly_role_map_site_id_assembly_id_assembly_role_id` (`site_id`,`assembly_id`,`assembly_role_id`),
  KEY `fk_site_assembly_role_map_assembly_id` (`assembly_id`),
  KEY `fk_site_assembly_role_map_assembly_role_id` (`assembly_role_id`),
  CONSTRAINT `fk_site_assembly_role_map_assembly_id` FOREIGN KEY (`assembly_id`) REFERENCES `assembly` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_assembly_role_map_assembly_role_id` FOREIGN KEY (`assembly_role_id`) REFERENCES `assembly_role_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_assembly_role_map_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_assembly_role_map_bi`
BEFORE INSERT ON `mot2`.`site_assembly_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_assembly_role_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_business_role`
--

DROP TABLE IF EXISTS `site_business_role`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_business_role` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `role_id` int(10) unsigned DEFAULT NULL,
  `code` varchar(40) CHARACTER SET latin1 NOT NULL,
  `name` varchar(50) NOT NULL,
  `description` varchar(250) NOT NULL,
  `organisation_type_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_business_role_organisation_type_id` (`organisation_type_id`),
  KEY `fk_site_business_role_role` (`role_id`),
  CONSTRAINT `fk_site_business_role_organisation_type_id` FOREIGN KEY (`organisation_type_id`) REFERENCES `organisation_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_business_role_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_business_role_bi`
BEFORE INSERT ON `mot2`.`site_business_role`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_business_role_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_business_role_map`
--

DROP TABLE IF EXISTS `site_business_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_business_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `person_id` int(10) unsigned NOT NULL,
  `site_business_role_id` smallint(5) unsigned NOT NULL,
  `status_id` smallint(5) unsigned NOT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_business_role_map` (`site_business_role_id`),
  KEY `fk_site_role_map_person` (`person_id`),
  KEY `fk_site_role_map_site` (`site_id`),
  KEY `fk_site_role_map_status` (`status_id`),
  CONSTRAINT `fk_site_business_role_map` FOREIGN KEY (`site_business_role_id`) REFERENCES `site_business_role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_role_map_person` FOREIGN KEY (`person_id`) REFERENCES `person` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_role_map_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_role_map_status` FOREIGN KEY (`status_id`) REFERENCES `business_role_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_business_role_map_bi`
BEFORE INSERT ON `mot2`.`site_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_business_role_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_business_role_map_bu`
BEFORE UPDATE ON `mot2`.`site_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_business_role_map_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_business_role_map_au`
AFTER UPDATE ON `mot2`.`site_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_business_role_map_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_business_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`person_id`
        ,`site_business_role_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`person_id`
        ,OLD.`site_business_role_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_business_role_map_bd`
BEFORE DELETE ON `mot2`.`site_business_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_business_role_map_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_business_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`person_id`
        ,`site_business_role_id`
        ,`status_id`
        ,`status_changed_on`
        ,`valid_from`
        ,`expiry_date`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`person_id`
        ,OLD.`site_business_role_id`
        ,OLD.`status_id`
        ,OLD.`status_changed_on`
        ,OLD.`valid_from`
        ,OLD.`expiry_date`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_business_role_map_hist`
--

DROP TABLE IF EXISTS `site_business_role_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_business_role_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `site_business_role_id` smallint(5) unsigned DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `valid_from` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_business_role_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_comment_map`
--

DROP TABLE IF EXISTS `site_comment_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_comment_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `comment_id` bigint(20) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_comment_map_comment` (`comment_id`),
  KEY `fk_site_comment_map_site` (`site_id`),
  CONSTRAINT `fk_site_comment_map_comment` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_comment_map_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Used to link a comment made against a site.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_comment_map_bi`
BEFORE INSERT ON `mot2`.`site_comment_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_comment_map_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_comment_map_bu`
BEFORE UPDATE ON `mot2`.`site_comment_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_comment_map_bu Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_comment_map_au`
AFTER UPDATE ON `mot2`.`site_comment_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_comment_map_au Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_comment_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_comment_map_bd`
BEFORE DELETE ON `mot2`.`site_comment_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_comment_map_bd Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_comment_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`comment_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`comment_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_comment_map_hist`
--

DROP TABLE IF EXISTS `site_comment_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_comment_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_comment_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_condition_approval`
--

DROP TABLE IF EXISTS `site_condition_approval`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_condition_approval` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `interviewed_name` varchar(100) NOT NULL,
  `interviewed_grade` varchar(100) NOT NULL,
  `visit_date` date NOT NULL,
  `fuel_id` smallint(5) unsigned NOT NULL,
  `atl_mode` tinyint(4) NOT NULL DEFAULT '0',
  `optl_mode` tinyint(4) NOT NULL DEFAULT '0',
  `comment_id` bigint(20) unsigned DEFAULT NULL,
  `ve_name` varchar(100) NOT NULL,
  `ve_grade` varchar(100) NOT NULL,
  `approval_date` date NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `sca_comment` (`comment_id`),
  KEY `sca_enforcement_fuel_type_lookup` (`fuel_id`),
  KEY `sca_site` (`site_id`),
  CONSTRAINT `sca_comment` FOREIGN KEY (`comment_id`) REFERENCES `comment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `sca_enforcement_fuel_type_lookup` FOREIGN KEY (`fuel_id`) REFERENCES `enforcement_fuel_type_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `sca_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records results of a condition approval visit by a VE to a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_condition_approval_bi`
BEFORE INSERT ON `mot2`.`site_condition_approval`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_condition_approval_bi Generated on 2016-12-12 11:29:03. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_contact_detail_map`
--

DROP TABLE IF EXISTS `site_contact_detail_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_contact_detail_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_contact_type_id` smallint(5) unsigned NOT NULL,
  `site_id` int(10) unsigned NOT NULL,
  `contact_detail_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_contact_detail_map_contact_detail` (`contact_detail_id`),
  KEY `fk_site_contact_detail_map_site` (`site_id`),
  KEY `fk_site_contact_detail_map_site_contact_type` (`site_contact_type_id`),
  CONSTRAINT `fk_site_contact_detail_map_contact_detail` FOREIGN KEY (`contact_detail_id`) REFERENCES `contact_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_contact_detail_map_site` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_contact_detail_map_site_contact_type` FOREIGN KEY (`site_contact_type_id`) REFERENCES `site_contact_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Link table between a site and a set of contact details';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_contact_detail_map_bi`
BEFORE INSERT ON `mot2`.`site_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_contact_detail_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_contact_detail_map_bu`
BEFORE UPDATE ON `mot2`.`site_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_contact_detail_map_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_contact_detail_map_au`
AFTER UPDATE ON `mot2`.`site_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_contact_detail_map_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_contact_type_id`
        ,`site_id`
        ,`contact_detail_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_contact_type_id`
        ,OLD.`site_id`
        ,OLD.`contact_detail_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_contact_detail_map_bd`
BEFORE DELETE ON `mot2`.`site_contact_detail_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_contact_detail_map_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_contact_detail_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_contact_type_id`
        ,`site_id`
        ,`contact_detail_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_contact_type_id`
        ,OLD.`site_id`
        ,OLD.`contact_detail_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_contact_detail_map_hist`
--

DROP TABLE IF EXISTS `site_contact_detail_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_contact_detail_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_contact_type_id` smallint(5) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `contact_detail_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_contact_detail_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_contact_type`
--

DROP TABLE IF EXISTS `site_contact_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_contact_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_site_contact_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of contact detail at a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_contact_type_bi`
BEFORE INSERT ON `mot2`.`site_contact_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_contact_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_emergency_log_map`
--

DROP TABLE IF EXISTS `site_emergency_log_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_emergency_log_map` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `emergency_log_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_emergency_log_map_emergency_log1` (`emergency_log_id`),
  KEY `fk_site_emergency_log_map_site1` (`site_id`),
  CONSTRAINT `fk_site_emergency_log_map_emergency_log1` FOREIGN KEY (`emergency_log_id`) REFERENCES `emergency_log` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_emergency_log_map_site1` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='sites confirm that they have completed catchup';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_emergency_log_map_bi`
BEFORE INSERT ON `mot2`.`site_emergency_log_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_emergency_log_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_emergency_log_map_bu`
BEFORE UPDATE ON `mot2`.`site_emergency_log_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_emergency_log_map_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_emergency_log_map_au`
AFTER UPDATE ON `mot2`.`site_emergency_log_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_emergency_log_map_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_emergency_log_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`emergency_log_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`emergency_log_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_emergency_log_map_bd`
BEFORE DELETE ON `mot2`.`site_emergency_log_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_emergency_log_map_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_emergency_log_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`emergency_log_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`emergency_log_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_emergency_log_map_hist`
--

DROP TABLE IF EXISTS `site_emergency_log_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_emergency_log_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(11) DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `emergency_log_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_emergency_log_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_facility`
--

DROP TABLE IF EXISTS `site_facility`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_facility` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `facility_type_id` int(10) unsigned NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_site_fac_facility_type` (`facility_type_id`),
  KEY `fk_site_id` (`site_id`),
  CONSTRAINT `fk_site_fac_facility_type` FOREIGN KEY (`facility_type_id`) REFERENCES `facility_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Facilities available at sites';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_facility_bi`
BEFORE INSERT ON `mot2`.`site_facility`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_facility_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_facility_bu`
BEFORE UPDATE ON `mot2`.`site_facility`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_facility_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_facility_au`
AFTER UPDATE ON `mot2`.`site_facility`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_facility_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_facility_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`facility_type_id`
        ,`name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`facility_type_id`
        ,OLD.`name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_facility_bd`
BEFORE DELETE ON `mot2`.`site_facility`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_facility_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_facility_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`facility_type_id`
        ,`name`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`facility_type_id`
        ,OLD.`name`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_facility_hist`
--

DROP TABLE IF EXISTS `site_facility_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_facility_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `facility_type_id` int(10) unsigned DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_facility_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_hist`
--

DROP TABLE IF EXISTS `site_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `site_number` varchar(45) DEFAULT NULL,
  `site_status_id` bigint(20) unsigned DEFAULT NULL,
  `status_changed_on` datetime(6) DEFAULT NULL,
  `default_brake_test_class_1_and_2_id` smallint(5) unsigned DEFAULT NULL,
  `default_service_brake_test_class_3_and_above_id` smallint(5) unsigned DEFAULT NULL,
  `default_parking_brake_test_class_3_and_above_id` smallint(5) unsigned DEFAULT NULL,
  `last_site_assessment_id` int(10) unsigned DEFAULT NULL,
  `dual_language` tinyint(3) unsigned DEFAULT NULL,
  `scottish_bank_holiday` tinyint(3) unsigned DEFAULT NULL,
  `latitude` decimal(8,5) DEFAULT NULL,
  `longitude` decimal(8,5) DEFAULT NULL,
  `type_id` smallint(5) unsigned DEFAULT NULL,
  `transition_status_id` smallint(5) unsigned DEFAULT NULL,
  `non_working_day_country_lookup_id` smallint(5) unsigned DEFAULT NULL,
  `first_login_by` int(10) unsigned DEFAULT NULL,
  `first_login_on` datetime(6) DEFAULT NULL,
  `first_test_carried_out_by` int(10) unsigned DEFAULT NULL,
  `first_test_carried_out_number` int(10) unsigned DEFAULT NULL,
  `first_test_carried_out_on` datetime(6) DEFAULT NULL,
  `first_live_test_carried_out_by` int(10) unsigned DEFAULT NULL,
  `first_live_test_carried_out_number` int(10) unsigned DEFAULT NULL,
  `first_live_test_carried_out_on` datetime(6) DEFAULT NULL,
  `mot1_details_updated_on` datetime(6) DEFAULT NULL,
  `mot1_vts_device_status_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  KEY `uq_site_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_identifying_token_map`
--

DROP TABLE IF EXISTS `site_identifying_token_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_identifying_token_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `identifying_token_id` int(10) unsigned NOT NULL,
  `is_assigned_to_person` tinyint(4) NOT NULL DEFAULT '0',
  `start_date` datetime(6) DEFAULT NULL,
  `end_date` datetime(6) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_generic table_site1` (`site_id`),
  KEY `fk_site_identifying_token_map_identifying_token1` (`identifying_token_id`),
  CONSTRAINT `fk_generic table_site1` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_site_identifying_token_map_identifying_token1` FOREIGN KEY (`identifying_token_id`) REFERENCES `identifying_token` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_identifying_token_map_bi`
BEFORE INSERT ON `mot2`.`site_identifying_token_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_identifying_token_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_status_lookup`
--

DROP TABLE IF EXISTS `site_status_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_status_lookup` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `code` varchar(5) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_site_status_lookup_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='A business approved list of statuses for a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_status_lookup_bi`
BEFORE INSERT ON `mot2`.`site_status_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_status_lookup_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_testing_daily_schedule`
--

DROP TABLE IF EXISTS `site_testing_daily_schedule`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_testing_daily_schedule` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `open_time` time DEFAULT NULL,
  `close_time` time DEFAULT NULL,
  `weekday` tinyint(3) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_UNIQUE` (`site_id`,`weekday`),
  CONSTRAINT `site_testing_daily_schedule_ibfk_1` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records the normal operating hours of a site. -- Feature depricated';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_testing_daily_schedule_bi`
BEFORE INSERT ON `mot2`.`site_testing_daily_schedule`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_testing_daily_schedule_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_testing_daily_schedule_bu`
BEFORE UPDATE ON `mot2`.`site_testing_daily_schedule`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_testing_daily_schedule_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_testing_daily_schedule_au`
AFTER UPDATE ON `mot2`.`site_testing_daily_schedule`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_testing_daily_schedule_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_testing_daily_schedule_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`open_time`
        ,`close_time`
        ,`weekday`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`open_time`
        ,OLD.`close_time`
        ,OLD.`weekday`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_testing_daily_schedule_bd`
BEFORE DELETE ON `mot2`.`site_testing_daily_schedule`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_testing_daily_schedule_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`site_testing_daily_schedule_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`site_id`
        ,`open_time`
        ,`close_time`
        ,`weekday`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`site_id`
        ,OLD.`open_time`
        ,OLD.`close_time`
        ,OLD.`weekday`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `site_testing_daily_schedule_hist`
--

DROP TABLE IF EXISTS `site_testing_daily_schedule_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_testing_daily_schedule_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `site_id` int(10) unsigned DEFAULT NULL,
  `open_time` time DEFAULT NULL,
  `close_time` time DEFAULT NULL,
  `weekday` tinyint(3) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_site_testing_daily_schedule_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `site_type`
--

DROP TABLE IF EXISTS `site_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `site_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of a type of site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_site_type_bi`
BEFORE INSERT ON `mot2`.`site_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_site_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice`
--

DROP TABLE IF EXISTS `special_notice`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `username` varchar(100) NOT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `special_notice_content_id` int(10) unsigned NOT NULL,
  `is_acknowledged` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `is_deleted` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`,`special_notice_content_id`),
  KEY `fk_map_person_special_notice_special_notice` (`special_notice_content_id`),
  CONSTRAINT `fk_map_person_special_notice_special_notice` FOREIGN KEY (`special_notice_content_id`) REFERENCES `special_notice_content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_map_person_special_notice_user` FOREIGN KEY (`username`) REFERENCES `person` (`username`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Acknowledgement status of each special notice for each person in the system';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_bi`
BEFORE INSERT ON `mot2`.`special_notice`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_bu`
BEFORE UPDATE ON `mot2`.`special_notice`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_au`
AFTER UPDATE ON `mot2`.`special_notice`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`username`
        ,`person_id`
        ,`special_notice_content_id`
        ,`is_acknowledged`
        ,`is_deleted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`username`
        ,OLD.`person_id`
        ,OLD.`special_notice_content_id`
        ,OLD.`is_acknowledged`
        ,OLD.`is_deleted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_bd`
BEFORE DELETE ON `mot2`.`special_notice`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`username`
        ,`person_id`
        ,`special_notice_content_id`
        ,`is_acknowledged`
        ,`is_deleted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`username`
        ,OLD.`person_id`
        ,OLD.`special_notice_content_id`
        ,OLD.`is_acknowledged`
        ,OLD.`is_deleted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice_audience`
--

DROP TABLE IF EXISTS `special_notice_audience`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_audience` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `special_notice_content_id` int(10) unsigned NOT NULL,
  `special_notice_audience_type_id` smallint(5) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `special_notice_content_id` (`special_notice_content_id`,`special_notice_audience_type_id`,`vehicle_class_id`),
  KEY `special_notice_audience_ibfk_2` (`special_notice_audience_type_id`),
  KEY `special_notice_audience_ibfk_3` (`vehicle_class_id`),
  CONSTRAINT `special_notice_audience_ibfk_1` FOREIGN KEY (`special_notice_content_id`) REFERENCES `special_notice_content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `special_notice_audience_ibfk_2` FOREIGN KEY (`special_notice_audience_type_id`) REFERENCES `special_notice_audience_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `special_notice_audience_ibfk_3` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_audience_bi`
BEFORE INSERT ON `mot2`.`special_notice_audience`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_audience_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice_audience_type`
--

DROP TABLE IF EXISTS `special_notice_audience_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_audience_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_audience_type_bi`
BEFORE INSERT ON `mot2`.`special_notice_audience_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_audience_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice_content`
--

DROP TABLE IF EXISTS `special_notice_content`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_content` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `title` varchar(100) NOT NULL,
  `issue_number` int(10) unsigned DEFAULT NULL,
  `issue_year` int(10) unsigned DEFAULT NULL,
  `issue_date` datetime(6) NOT NULL,
  `expiry_date` datetime(6) NOT NULL,
  `internal_publish_date` datetime(6) NOT NULL COMMENT 'DVSA broadcast date',
  `external_publish_date` datetime(6) NOT NULL COMMENT 'VTS broadcast date',
  `notice_text` text NOT NULL,
  `acknowledge_within` smallint(5) unsigned DEFAULT NULL COMMENT 'NULL for messages that dont require acknowledgement',
  `is_published` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `is_deleted` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `issue_number` (`issue_number`,`issue_year`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of special notices';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_bi`
BEFORE INSERT ON `mot2`.`special_notice_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_bu`
BEFORE UPDATE ON `mot2`.`special_notice_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_au`
AFTER UPDATE ON `mot2`.`special_notice_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_content_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`title`
        ,`issue_number`
        ,`issue_year`
        ,`issue_date`
        ,`expiry_date`
        ,`internal_publish_date`
        ,`external_publish_date`
        ,`notice_text`
        ,`acknowledge_within`
        ,`is_published`
        ,`is_deleted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`title`
        ,OLD.`issue_number`
        ,OLD.`issue_year`
        ,OLD.`issue_date`
        ,OLD.`expiry_date`
        ,OLD.`internal_publish_date`
        ,OLD.`external_publish_date`
        ,OLD.`notice_text`
        ,OLD.`acknowledge_within`
        ,OLD.`is_published`
        ,OLD.`is_deleted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_bd`
BEFORE DELETE ON `mot2`.`special_notice_content`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_content_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`title`
        ,`issue_number`
        ,`issue_year`
        ,`issue_date`
        ,`expiry_date`
        ,`internal_publish_date`
        ,`external_publish_date`
        ,`notice_text`
        ,`acknowledge_within`
        ,`is_published`
        ,`is_deleted`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`title`
        ,OLD.`issue_number`
        ,OLD.`issue_year`
        ,OLD.`issue_date`
        ,OLD.`expiry_date`
        ,OLD.`internal_publish_date`
        ,OLD.`external_publish_date`
        ,OLD.`notice_text`
        ,OLD.`acknowledge_within`
        ,OLD.`is_published`
        ,OLD.`is_deleted`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice_content_hist`
--

DROP TABLE IF EXISTS `special_notice_content_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_content_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `title` varchar(100) DEFAULT NULL,
  `issue_number` int(10) unsigned DEFAULT NULL,
  `issue_year` int(10) unsigned DEFAULT NULL,
  `issue_date` datetime(6) DEFAULT NULL,
  `expiry_date` datetime(6) DEFAULT NULL,
  `internal_publish_date` datetime(6) DEFAULT NULL,
  `external_publish_date` datetime(6) DEFAULT NULL,
  `notice_text` text,
  `acknowledge_within` smallint(5) unsigned DEFAULT NULL,
  `is_published` tinyint(4) unsigned DEFAULT NULL,
  `is_deleted` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_special_notice_content_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `special_notice_content_role_map`
--

DROP TABLE IF EXISTS `special_notice_content_role_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_content_role_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `special_notice_content_id` int(10) unsigned NOT NULL,
  `role_id` int(10) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `special_notice_content_id` (`special_notice_content_id`,`role_id`),
  KEY `fk_special_notice_content_role_map_role` (`role_id`),
  CONSTRAINT `fk_special_notice_content_role_map_role` FOREIGN KEY (`role_id`) REFERENCES `role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_special_notice_content_role_map_special_notice` FOREIGN KEY (`special_notice_content_id`) REFERENCES `special_notice_content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Maps special notices to audiences for special notices';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_role_map_bi`
BEFORE INSERT ON `mot2`.`special_notice_content_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_role_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_role_map_bu`
BEFORE UPDATE ON `mot2`.`special_notice_content_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_role_map_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_role_map_au`
AFTER UPDATE ON `mot2`.`special_notice_content_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_role_map_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_content_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`special_notice_content_id`
        ,`role_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`special_notice_content_id`
        ,OLD.`role_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_special_notice_content_role_map_bd`
BEFORE DELETE ON `mot2`.`special_notice_content_role_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_special_notice_content_role_map_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`special_notice_content_role_map_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`special_notice_content_id`
        ,`role_id`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`special_notice_content_id`
        ,OLD.`role_id`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `special_notice_content_role_map_hist`
--

DROP TABLE IF EXISTS `special_notice_content_role_map_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_content_role_map_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `special_notice_content_id` int(10) unsigned DEFAULT NULL,
  `role_id` int(10) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_special_notice_content_role_map_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `special_notice_hist`
--

DROP TABLE IF EXISTS `special_notice_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `special_notice_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `username` varchar(100) DEFAULT NULL,
  `person_id` int(10) unsigned DEFAULT NULL,
  `special_notice_content_id` int(10) unsigned DEFAULT NULL,
  `is_acknowledged` tinyint(4) unsigned DEFAULT NULL,
  `is_deleted` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_special_notice_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:08';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `survey`
--

DROP TABLE IF EXISTS `survey`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `survey` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `satisfaction_rating` tinyint(4) DEFAULT NULL,
  `created_on` date NOT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_survey_bi`
BEFORE INSERT ON `mot2`.`survey`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_survey_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_item_category`
--

DROP TABLE IF EXISTS `test_item_category`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_item_category` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `parent_test_item_category_id` int(10) unsigned NOT NULL,
  `section_test_item_category_id` int(10) unsigned NOT NULL,
  `business_rule_id` int(10) unsigned DEFAULT NULL COMMENT 'Possible business rule for filtering categories',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_test_item_category_business_rule_id_business_rule_id` (`business_rule_id`),
  KEY `fk_test_item_category_parent_test_item_category_id` (`parent_test_item_category_id`),
  CONSTRAINT `fk_test_item_category_business_rule_id_business_rule_id` FOREIGN KEY (`business_rule_id`) REFERENCES `business_rule` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_item_category_parent_test_item_category_id` FOREIGN KEY (`parent_test_item_category_id`) REFERENCES `test_item_category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Groups RFRs hierarchically';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_item_category_bi`
BEFORE INSERT ON `mot2`.`test_item_category`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_item_category_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_item_category_vehicle_class_map`
--

DROP TABLE IF EXISTS `test_item_category_vehicle_class_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_item_category_vehicle_class_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `test_item_category_id` int(10) unsigned NOT NULL,
  `vehicle_class_id` smallint(5) unsigned NOT NULL,
  `business_rule_id` int(10) unsigned DEFAULT NULL COMMENT 'Possible business rule for filtering categories',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_test_item_category_vehicle_class_map_business_rule_id` (`business_rule_id`),
  KEY `fk_test_item_category_vehicle_class_map_test_item_category_id` (`test_item_category_id`),
  KEY `fk_test_item_category_vehicle_class_map_vehicle_class_id` (`vehicle_class_id`),
  CONSTRAINT `fk_test_item_category_vehicle_class_map_business_rule_id` FOREIGN KEY (`business_rule_id`) REFERENCES `business_rule` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_item_category_vehicle_class_map_test_item_category_id` FOREIGN KEY (`test_item_category_id`) REFERENCES `test_item_category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_item_category_vehicle_class_map_vehicle_class_id` FOREIGN KEY (`vehicle_class_id`) REFERENCES `vehicle_class` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Maps the vehicle classes of each test item category';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_item_category_vehicle_class_map_bi`
BEFORE INSERT ON `mot2`.`test_item_category_vehicle_class_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_item_category_vehicle_class_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_slot_transaction`
--

DROP TABLE IF EXISTS `test_slot_transaction`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `slots` int(10) unsigned NOT NULL,
  `real_slots` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Number of slots after the initial value of slots have been adjusted or refunded',
  `slots_after` int(10) NOT NULL DEFAULT '0',
  `status_id` smallint(5) unsigned NOT NULL,
  `payment_id` int(10) unsigned NOT NULL,
  `state` varchar(43) NOT NULL,
  `sales_reference` varchar(55) NOT NULL COMMENT 'Sales invoice number',
  `unique_identifier` varchar(8) DEFAULT NULL COMMENT 'Last 8 char of invoice reference searched on',
  `organisation_id` int(10) unsigned NOT NULL,
  `completed_on` datetime(6) DEFAULT NULL,
  `created` datetime(6) NOT NULL,
  `created_by_username` varchar(100) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `test_slot_transaction_state_idx` (`state`),
  KEY `test_slot_transaction_sales_reference_payment_id_idx` (`sales_reference`,`payment_id`),
  KEY `test_slot_transaction_unique_identifier_payment_id_idx` (`unique_identifier`,`payment_id`),
  KEY `fk_test_slot_transaction_organisation_id` (`organisation_id`),
  KEY `fk_test_slot_transaction_payment` (`payment_id`),
  KEY `fk_test_slot_transaction_status` (`status_id`),
  CONSTRAINT `fk_test_slot_transaction_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_slot_transaction_payment` FOREIGN KEY (`payment_id`) REFERENCES `payment` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_slot_transaction_status` FOREIGN KEY (`status_id`) REFERENCES `test_slot_transaction_status` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records slot purchasing transactions - in progress and complete';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_bi`
BEFORE INSERT ON `mot2`.`test_slot_transaction`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_bu`
BEFORE UPDATE ON `mot2`.`test_slot_transaction`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_au`
AFTER UPDATE ON `mot2`.`test_slot_transaction`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`slots`
        ,`real_slots`
        ,`slots_after`
        ,`status_id`
        ,`payment_id`
        ,`state`
        ,`sales_reference`
        ,`unique_identifier`
        ,`organisation_id`
        ,`completed_on`
        ,`created`
        ,`created_by_username`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`slots`
        ,OLD.`real_slots`
        ,OLD.`slots_after`
        ,OLD.`status_id`
        ,OLD.`payment_id`
        ,OLD.`state`
        ,OLD.`sales_reference`
        ,OLD.`unique_identifier`
        ,OLD.`organisation_id`
        ,OLD.`completed_on`
        ,OLD.`created`
        ,OLD.`created_by_username`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_bd`
BEFORE DELETE ON `mot2`.`test_slot_transaction`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`slots`
        ,`real_slots`
        ,`slots_after`
        ,`status_id`
        ,`payment_id`
        ,`state`
        ,`sales_reference`
        ,`unique_identifier`
        ,`organisation_id`
        ,`completed_on`
        ,`created`
        ,`created_by_username`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`slots`
        ,OLD.`real_slots`
        ,OLD.`slots_after`
        ,OLD.`status_id`
        ,OLD.`payment_id`
        ,OLD.`state`
        ,OLD.`sales_reference`
        ,OLD.`unique_identifier`
        ,OLD.`organisation_id`
        ,OLD.`completed_on`
        ,OLD.`created`
        ,OLD.`created_by_username`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_slot_transaction_amendment`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `organisation_id` int(10) unsigned NOT NULL,
  `test_slot_transaction_id` int(10) unsigned DEFAULT NULL,
  `type_id` smallint(5) unsigned NOT NULL,
  `reason_id` smallint(5) unsigned NOT NULL,
  `slots` int(11) NOT NULL COMMENT 'Adjustment can be either positive or negative',
  `previous_receipt_reference` varchar(55) DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_test_slot_transaction_amendment_organisation_id` (`organisation_id`),
  KEY `fk_test_slot_transaction_amendment_reason_id` (`reason_id`),
  KEY `fk_test_slot_transaction_amendment_test_slot_transaction_id` (`test_slot_transaction_id`),
  KEY `fk_test_slot_transaction_amendment_type_id` (`type_id`),
  CONSTRAINT `fk_test_slot_transaction_amendment_organisation_id` FOREIGN KEY (`organisation_id`) REFERENCES `organisation` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_slot_transaction_amendment_reason_id` FOREIGN KEY (`reason_id`) REFERENCES `test_slot_transaction_amendment_reason` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_slot_transaction_amendment_test_slot_transaction_id` FOREIGN KEY (`test_slot_transaction_id`) REFERENCES `test_slot_transaction` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_test_slot_transaction_amendment_type_id` FOREIGN KEY (`type_id`) REFERENCES `test_slot_transaction_amendment_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Payment receipt reference before adjustment';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_bi`
BEFORE INSERT ON `mot2`.`test_slot_transaction_amendment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_bu`
BEFORE UPDATE ON `mot2`.`test_slot_transaction_amendment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_au`
AFTER UPDATE ON `mot2`.`test_slot_transaction_amendment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`test_slot_transaction_id`
        ,`type_id`
        ,`reason_id`
        ,`slots`
        ,`previous_receipt_reference`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`test_slot_transaction_id`
        ,OLD.`type_id`
        ,OLD.`reason_id`
        ,OLD.`slots`
        ,OLD.`previous_receipt_reference`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_bd`
BEFORE DELETE ON `mot2`.`test_slot_transaction_amendment`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`organisation_id`
        ,`test_slot_transaction_id`
        ,`type_id`
        ,`reason_id`
        ,`slots`
        ,`previous_receipt_reference`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`organisation_id`
        ,OLD.`test_slot_transaction_id`
        ,OLD.`type_id`
        ,OLD.`reason_id`
        ,OLD.`slots`
        ,OLD.`previous_receipt_reference`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_slot_transaction_amendment_hist`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `test_slot_transaction_id` int(10) unsigned DEFAULT NULL,
  `type_id` smallint(5) unsigned DEFAULT NULL,
  `reason_id` smallint(5) unsigned DEFAULT NULL,
  `slots` int(11) DEFAULT NULL,
  `previous_receipt_reference` varchar(55) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_test_slot_transaction_amendment_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `test_slot_transaction_amendment_reason`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment_reason`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment_reason` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `description` varchar(75) NOT NULL DEFAULT '' COMMENT 'text of the amendment reason',
  `amendment_type_id` smallint(5) unsigned NOT NULL DEFAULT '1',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Order the amendment reason appears in a list',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_test_slot_transaction_amendment_reason_code` (`code`),
  KEY `fk_test_slot_transaction_amendment_reason_amendment_type_id` (`amendment_type_id`),
  CONSTRAINT `fk_test_slot_transaction_amendment_reason_amendment_type_id` FOREIGN KEY (`amendment_type_id`) REFERENCES `test_slot_transaction_amendment_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of reasons of amendment.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_reason_bi`
BEFORE INSERT ON `mot2`.`test_slot_transaction_amendment_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_reason_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_reason_bu`
BEFORE UPDATE ON `mot2`.`test_slot_transaction_amendment_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_reason_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_reason_au`
AFTER UPDATE ON `mot2`.`test_slot_transaction_amendment_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_reason_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_reason_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`description`
        ,`amendment_type_id`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`description`
        ,OLD.`amendment_type_id`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_reason_bd`
BEFORE DELETE ON `mot2`.`test_slot_transaction_amendment_reason`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_reason_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_reason_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`description`
        ,`amendment_type_id`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`description`
        ,OLD.`amendment_type_id`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_slot_transaction_amendment_reason_hist`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment_reason_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment_reason_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `description` varchar(75) DEFAULT NULL,
  `amendment_type_id` smallint(5) unsigned DEFAULT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_test_slot_transaction_amendment_reason_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `test_slot_transaction_amendment_type`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `title` varchar(75) NOT NULL DEFAULT '' COMMENT 'Name of the amendment type',
  `is_active` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'Whether the amendment type is active',
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1' COMMENT 'Order the amendment type appears in a list',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_test_slot_transaction_amendment_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of amendment. Not all amendment types are currently implemented';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_type_bi`
BEFORE INSERT ON `mot2`.`test_slot_transaction_amendment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_type_bu`
BEFORE UPDATE ON `mot2`.`test_slot_transaction_amendment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_type_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_type_au`
AFTER UPDATE ON `mot2`.`test_slot_transaction_amendment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_type_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`title`
        ,`is_active`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`title`
        ,OLD.`is_active`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_amendment_type_bd`
BEFORE DELETE ON `mot2`.`test_slot_transaction_amendment_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_amendment_type_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`test_slot_transaction_amendment_type_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`code`
        ,`title`
        ,`is_active`
        ,`display_order`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`code`
        ,OLD.`title`
        ,OLD.`is_active`
        ,OLD.`display_order`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `test_slot_transaction_amendment_type_hist`
--

DROP TABLE IF EXISTS `test_slot_transaction_amendment_type_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_amendment_type_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` smallint(5) unsigned DEFAULT NULL,
  `code` varchar(5) CHARACTER SET latin1 DEFAULT NULL,
  `title` varchar(75) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_test_slot_transaction_amendment_type_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `test_slot_transaction_hist`
--

DROP TABLE IF EXISTS `test_slot_transaction_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `slots` int(10) unsigned DEFAULT NULL,
  `real_slots` int(10) unsigned DEFAULT NULL,
  `slots_after` int(10) DEFAULT NULL,
  `status_id` smallint(5) unsigned DEFAULT NULL,
  `payment_id` int(10) unsigned DEFAULT NULL,
  `state` varchar(43) DEFAULT NULL,
  `sales_reference` varchar(55) DEFAULT NULL,
  `unique_identifier` varchar(8) DEFAULT NULL,
  `organisation_id` int(10) unsigned DEFAULT NULL,
  `completed_on` datetime(6) DEFAULT NULL,
  `created` datetime(6) DEFAULT NULL,
  `created_by_username` varchar(100) DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_test_slot_transaction_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `test_slot_transaction_status`
--

DROP TABLE IF EXISTS `test_slot_transaction_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `test_slot_transaction_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the status of a transaction during the slot purchasing process';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_test_slot_transaction_status_bi`
BEFORE INSERT ON `mot2`.`test_slot_transaction_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_test_slot_transaction_status_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `ti_category_language_content_map`
--

DROP TABLE IF EXISTS `ti_category_language_content_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ti_category_language_content_map` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `test_item_category_id` int(10) unsigned NOT NULL,
  `language_lookup_id` smallint(5) unsigned NOT NULL,
  `name` varchar(100) NOT NULL,
  `description` varchar(100) DEFAULT NULL COMMENT 'Full version of name used in printed documents',
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_ti_category_language_content_map_display_order_language` (`display_order`,`language_lookup_id`),
  KEY `fk_ti_category_language_content_map_language_lookup_id` (`language_lookup_id`),
  KEY `fk_ti_category_language_content_map_test_item_category_id` (`test_item_category_id`),
  CONSTRAINT `fk_ti_category_language_content_map_language_lookup_id` FOREIGN KEY (`language_lookup_id`) REFERENCES `language_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_ti_category_language_content_map_test_item_category_id` FOREIGN KEY (`test_item_category_id`) REFERENCES `test_item_category` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='How test items are displayed in different languages and presented';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_ti_category_language_content_map_bi`
BEFORE INSERT ON `mot2`.`ti_category_language_content_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_ti_category_language_content_map_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `title`
--

DROP TABLE IF EXISTS `title`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `title` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_title_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation for the Person table';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_title_bi`
BEFORE INSERT ON `mot2`.`title`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_title_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `token_lookup`
--

DROP TABLE IF EXISTS `token_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `token_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_token_lookup_bi`
BEFORE INSERT ON `mot2`.`token_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_token_lookup_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `transition_status`
--

DROP TABLE IF EXISTS `transition_status`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `transition_status` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(30) NOT NULL,
  `code` varchar(5) NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_transition_status_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the current transfer status of an organisation from MOT1 to MOT2';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_transition_status_bi`
BEFORE INSERT ON `mot2`.`transition_status`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_transition_status_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `transmission_type`
--

DROP TABLE IF EXISTS `transmission_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `transmission_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_transmission_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of a vehicles transmission';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_transmission_type_bi`
BEFORE INSERT ON `mot2`.`transmission_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_transmission_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `url_type`
--

DROP TABLE IF EXISTS `url_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `url_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) DEFAULT NULL,
  `max_count` smallint(6) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_url_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Types of urls that can be used in messages';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_url_type_bi`
BEFORE INSERT ON `mot2`.`url_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_url_type_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vehicle`
--

DROP TABLE IF EXISTS `vehicle`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `registration` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `registration_collapsed` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `vin` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `vin_collapsed` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `model_detail_id` int(10) unsigned NOT NULL,
  `year` year(4) DEFAULT NULL,
  `manufacture_date` date DEFAULT NULL,
  `first_registration_date` date DEFAULT NULL,
  `first_used_date` date DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned NOT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `weight` int(10) unsigned DEFAULT NULL COMMENT 'in Kg',
  `weight_source_id` smallint(5) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned NOT NULL,
  `engine_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `chassis_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `is_new_at_first_reg` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `dvla_vehicle_id` int(11) DEFAULT NULL COMMENT 'Unique DVLA reference',
  `is_damaged` tinyint(4) NOT NULL DEFAULT '0',
  `is_destroyed` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'Destruction marker',
  `is_incognito` tinyint(4) unsigned NOT NULL DEFAULT '0',
  `created_by` int(10) unsigned NOT NULL DEFAULT '0',
  `created_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned NOT NULL DEFAULT '0',
  `last_updated_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_vehicle_colour_id` (`primary_colour_id`),
  KEY `fk_vehicle_country_of_registration_id` (`country_of_registration_id`),
  KEY `fk_vehicle_model_detail_id` (`model_detail_id`),
  KEY `fk_vehicle_secondary_colour_id` (`secondary_colour_id`),
  KEY `fk_weight_source_id` (`weight_source_id`),
  KEY `vehicle_vin_registration_idx` (`vin`,`registration`),
  KEY `vehicle_registration_idx` (`registration`),
  KEY `vehicle_dvla_vehicle_id_idx` (`dvla_vehicle_id`),
  KEY `vehicle_registration_collapsed_idx` (`registration_collapsed`),
  KEY `vehicle_vin_collapsed_idx` (`vin_collapsed`),
  KEY `vehicle_created_on_dvla_vehicle_id_idx` (`created_on`,`dvla_vehicle_id`),
  CONSTRAINT `fk_vehicle_colour_id` FOREIGN KEY (`primary_colour_id`) REFERENCES `colour_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_vehicle_country_of_registration_id` FOREIGN KEY (`country_of_registration_id`) REFERENCES `country_of_registration_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_vehicle_model_detail_id` FOREIGN KEY (`model_detail_id`) REFERENCES `model_detail` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_vehicle_secondary_colour_id` FOREIGN KEY (`secondary_colour_id`) REFERENCES `colour_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_weight_source_id` FOREIGN KEY (`weight_source_id`) REFERENCES `weight_source_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_bi`
BEFORE INSERT ON `mot2`.`vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 10000;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
    SET NEW.`registration_collapsed` = f_collapse(NEW.`registration`);
    SET NEW.`vin_collapsed` = f_collapse(NEW.`vin`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_bu`
BEFORE UPDATE ON `mot2`.`vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 10000;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
    SET NEW.`registration_collapsed` = f_collapse(NEW.`registration`);
    SET NEW.`vin_collapsed` = f_collapse(NEW.`vin`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_au`
AFTER UPDATE ON `mot2`.`vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`vehicle_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`registration`
        ,`registration_collapsed`
        ,`vin`
        ,`vin_collapsed`
        ,`model_detail_id`
        ,`year`
        ,`manufacture_date`
        ,`first_registration_date`
        ,`first_used_date`
        ,`primary_colour_id`
        ,`secondary_colour_id`
        ,`weight`
        ,`weight_source_id`
        ,`country_of_registration_id`
        ,`engine_number`
        ,`chassis_number`
        ,`is_new_at_first_reg`
        ,`dvla_vehicle_id`
        ,`is_damaged`
        ,`is_destroyed`
        ,`is_incognito`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`registration`
        ,OLD.`registration_collapsed`
        ,OLD.`vin`
        ,OLD.`vin_collapsed`
        ,OLD.`model_detail_id`
        ,OLD.`year`
        ,OLD.`manufacture_date`
        ,OLD.`first_registration_date`
        ,OLD.`first_used_date`
        ,OLD.`primary_colour_id`
        ,OLD.`secondary_colour_id`
        ,OLD.`weight`
        ,OLD.`weight_source_id`
        ,OLD.`country_of_registration_id`
        ,OLD.`engine_number`
        ,OLD.`chassis_number`
        ,OLD.`is_new_at_first_reg`
        ,OLD.`dvla_vehicle_id`
        ,OLD.`is_damaged`
        ,OLD.`is_destroyed`
        ,OLD.`is_incognito`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_bd`
BEFORE DELETE ON `mot2`.`vehicle`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`vehicle_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`registration`
        ,`registration_collapsed`
        ,`vin`
        ,`vin_collapsed`
        ,`model_detail_id`
        ,`year`
        ,`manufacture_date`
        ,`first_registration_date`
        ,`first_used_date`
        ,`primary_colour_id`
        ,`secondary_colour_id`
        ,`weight`
        ,`weight_source_id`
        ,`country_of_registration_id`
        ,`engine_number`
        ,`chassis_number`
        ,`is_new_at_first_reg`
        ,`dvla_vehicle_id`
        ,`is_damaged`
        ,`is_destroyed`
        ,`is_incognito`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`registration`
        ,OLD.`registration_collapsed`
        ,OLD.`vin`
        ,OLD.`vin_collapsed`
        ,OLD.`model_detail_id`
        ,OLD.`year`
        ,OLD.`manufacture_date`
        ,OLD.`first_registration_date`
        ,OLD.`first_used_date`
        ,OLD.`primary_colour_id`
        ,OLD.`secondary_colour_id`
        ,OLD.`weight`
        ,OLD.`weight_source_id`
        ,OLD.`country_of_registration_id`
        ,OLD.`engine_number`
        ,OLD.`chassis_number`
        ,OLD.`is_new_at_first_reg`
        ,OLD.`dvla_vehicle_id`
        ,OLD.`is_damaged`
        ,OLD.`is_destroyed`
        ,OLD.`is_incognito`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vehicle_class`
--

DROP TABLE IF EXISTS `vehicle_class`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_class` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `vehicle_class_group_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_vehicle_class_code` (`code`),
  KEY `fx_vehicle_class_vehicle_class_group_id` (`vehicle_class_group_id`),
  CONSTRAINT `fx_vehicle_class_vehicle_class_group_id` FOREIGN KEY (`vehicle_class_group_id`) REFERENCES `vehicle_class_group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Records of the various vehicle classes';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_class_bi`
BEFORE INSERT ON `mot2`.`vehicle_class`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_class_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vehicle_class_group`
--

DROP TABLE IF EXISTS `vehicle_class_group`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_class_group` (
  `id` smallint(5) unsigned NOT NULL,
  `name` varchar(50) NOT NULL,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_vehicle_class_group_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_class_group_bi`
BEFORE INSERT ON `mot2`.`vehicle_class_group`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_class_group_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vehicle_model_technical_data_map`
--

DROP TABLE IF EXISTS `vehicle_model_technical_data_map`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_model_technical_data_map` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `vehicle_id` int(10) unsigned NOT NULL,
  `model_technical_data_id` bigint(20) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP(6),
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `ix_vehicle_model_technical_data_map_created_by` (`created_by`),
  KEY `ix_vehicle_model_technical_data_map_last_updated_by` (`last_updated_by`),
  KEY `ix_vehicle_model_technical_data_map_vehicle_id` (`vehicle_id`),
  KEY `ix_vehicle_model_technical_data_map_model_technical_data_id` (`model_technical_data_id`),
  CONSTRAINT `fk_vehicle_model_technical_data_map_created_by_person_id` FOREIGN KEY (`created_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_vehicle_model_technical_data_map_model_technical_data_id` FOREIGN KEY (`model_technical_data_id`) REFERENCES `model_technical_data` (`id`),
  CONSTRAINT `fk_vehicle_model_technical_data_map_updated_by_person_id` FOREIGN KEY (`last_updated_by`) REFERENCES `person` (`id`),
  CONSTRAINT `fk_vehicle_model_technical_data_map_vehicle_id_vehicle_id` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_model_technical_data_map_bi`
BEFORE INSERT ON `mot2`.`vehicle_model_technical_data_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_model_technical_data_map_bi Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_model_technical_data_map_bu`
BEFORE UPDATE ON `mot2`.`vehicle_model_technical_data_map`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_model_technical_data_map_bu Generated on 2017-01-27 13:42:33. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Temporary view structure for view `vehicle_detail_vw`
--

DROP TABLE IF EXISTS `vehicle_detail_vw`;
/*!50001 DROP VIEW IF EXISTS `vehicle_detail_vw`*/;
SET @saved_cs_client     = @@character_set_client;
SET character_set_client = utf8;
/*!50001 CREATE VIEW `vehicle_detail_vw` AS SELECT 
 1 AS `vehicle_id_`,
 1 AS `registration`,
 1 AS `vin`,
 1 AS `make_id_`,
 1 AS `make_name_`,
 1 AS `make_code_`,
 1 AS `model_id_`,
 1 AS `model_name_`,
 1 AS `model_code_`,
 1 AS `model_detail_id_`*/;
SET character_set_client = @saved_cs_client;

--
-- Table structure for table `vehicle_hist`
--

DROP TABLE IF EXISTS `vehicle_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `registration` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `registration_collapsed` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `vin` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `vin_collapsed` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `model_detail_id` int(10) unsigned DEFAULT NULL,
  `year` year(4) DEFAULT NULL,
  `manufacture_date` date DEFAULT NULL,
  `first_registration_date` date DEFAULT NULL,
  `first_used_date` date DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `weight` int(10) unsigned DEFAULT NULL,
  `weight_source_id` smallint(5) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned DEFAULT NULL,
  `engine_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `chassis_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `is_new_at_first_reg` tinyint(4) unsigned DEFAULT NULL,
  `dvla_vehicle_id` int(11) DEFAULT NULL,
  `is_damaged` tinyint(4) DEFAULT NULL,
  `is_destroyed` tinyint(4) DEFAULT NULL,
  `is_incognito` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NULL DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_vehicle_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `vehicle_hist_pre_refactor`
--

DROP TABLE IF EXISTS `vehicle_hist_pre_refactor`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_hist_pre_refactor` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(10) unsigned DEFAULT NULL,
  `registration` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `registration_collapsed` varchar(20) CHARACTER SET latin1 DEFAULT NULL,
  `vin` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `vin_collapsed` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `model_detail_id` int(10) unsigned DEFAULT NULL,
  `year` year(4) DEFAULT NULL,
  `manufacture_date` date DEFAULT NULL,
  `first_registration_date` date DEFAULT NULL,
  `first_used_date` date DEFAULT NULL,
  `primary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `secondary_colour_id` smallint(5) unsigned DEFAULT NULL,
  `weight` int(10) unsigned DEFAULT NULL,
  `weight_source_id` smallint(5) unsigned DEFAULT NULL,
  `country_of_registration_id` smallint(5) unsigned DEFAULT NULL,
  `engine_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `chassis_number` varchar(30) CHARACTER SET latin1 DEFAULT NULL,
  `is_new_at_first_reg` tinyint(4) unsigned DEFAULT NULL,
  `dvla_vehicle_id` int(11) DEFAULT NULL,
  `is_damaged` tinyint(4) DEFAULT NULL,
  `is_destroyed` tinyint(4) DEFAULT NULL,
  `is_incognito` tinyint(4) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` timestamp(6) NULL DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` timestamp(6) NULL DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  KEY `uq_vehicle_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `vehicle_v5c`
--

DROP TABLE IF EXISTS `vehicle_v5c`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_v5c` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `vehicle_id` int(10) unsigned NOT NULL,
  `v5c_ref` varchar(11) NOT NULL,
  `first_seen` date NOT NULL,
  `last_seen` date DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_vehicle_v5c_vehicle` (`vehicle_id`),
  CONSTRAINT `fk_vehicle_v5c_vehicle` FOREIGN KEY (`vehicle_id`) REFERENCES `vehicle` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='History of a vehicles V5C data';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_v5c_bi`
BEFORE INSERT ON `mot2`.`vehicle_v5c`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_v5c_bi Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_v5c_bu`
BEFORE UPDATE ON `mot2`.`vehicle_v5c`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_v5c_bu Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = OLD.`version` + 1;
    SET NEW.`last_updated_by` = COALESCE(@app_user_id, NEW.`last_updated_by`);
    SET NEW.`last_updated_on` = CURRENT_TIMESTAMP;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_v5c_au`
AFTER UPDATE ON `mot2`.`vehicle_v5c`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_v5c_au Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`vehicle_v5c_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`vehicle_id`
        ,`v5c_ref`
        ,`first_seen`
        ,`last_seen`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (NEW.`last_updated_on`
        ,NEW.`last_updated_by`
        ,OLD.`id`
        ,OLD.`vehicle_id`
        ,OLD.`v5c_ref`
        ,OLD.`first_seen`
        ,OLD.`last_seen`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_vehicle_v5c_bd`
BEFORE DELETE ON `mot2`.`vehicle_v5c`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_vehicle_v5c_bd Generated on 2016-12-12 11:29:04. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    INSERT INTO `mot2`.`vehicle_v5c_hist`
        (`expired_on`
        ,`expired_by`
        ,`id`
        ,`vehicle_id`
        ,`v5c_ref`
        ,`first_seen`
        ,`last_seen`
        ,`created_by`
        ,`created_on`
        ,`last_updated_by`
        ,`last_updated_on`
        ,`version`)
        VALUES
        (CURRENT_TIMESTAMP(6)
        ,COALESCE(@app_user_id, 0)
        ,OLD.`id`
        ,OLD.`vehicle_id`
        ,OLD.`v5c_ref`
        ,OLD.`first_seen`
        ,OLD.`last_seen`
        ,OLD.`created_by`
        ,OLD.`created_on`
        ,OLD.`last_updated_by`
        ,OLD.`last_updated_on`
        ,OLD.`version`);
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `vehicle_v5c_hist`
--

DROP TABLE IF EXISTS `vehicle_v5c_hist`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `vehicle_v5c_hist` (
  `hist_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `expired_on` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `expired_by` int(10) unsigned DEFAULT NULL,
  `id` int(11) DEFAULT NULL,
  `vehicle_id` int(10) unsigned DEFAULT NULL,
  `v5c_ref` varchar(11) DEFAULT NULL,
  `first_seen` date DEFAULT NULL,
  `last_seen` date DEFAULT NULL,
  `created_by` int(10) unsigned DEFAULT NULL,
  `created_on` datetime(6) DEFAULT NULL,
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`hist_id`),
  UNIQUE KEY `uq_vehicle_v5c_hist` (`id`,`version`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='DDL GENERATED 2016-07-04 12:27:09';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Table structure for table `visit`
--

DROP TABLE IF EXISTS `visit`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `visit` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `site_id` int(10) unsigned NOT NULL,
  `visit_date` date NOT NULL,
  `visit_reason_id` smallint(5) unsigned NOT NULL,
  `visit_outcome_id` smallint(5) unsigned NOT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `fk_esvr_site_id` (`site_id`),
  KEY `fk_esvr_visit_outcome_id` (`visit_outcome_id`),
  KEY `fk_esvr_visit_reason_id` (`visit_reason_id`),
  CONSTRAINT `fk_esvr_site_id` FOREIGN KEY (`site_id`) REFERENCES `site` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_esvr_visit_outcome_id` FOREIGN KEY (`visit_outcome_id`) REFERENCES `enforcement_visit_outcome_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_esvr_visit_reason_id` FOREIGN KEY (`visit_reason_id`) REFERENCES `visit_reason_lookup` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Representation of a visit made by DVSA to a site.';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_visit_bi`
BEFORE INSERT ON `mot2`.`visit`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_visit_bi Generated on 2016-12-12 11:29:05. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `visit_reason_lookup`
--

DROP TABLE IF EXISTS `visit_reason_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `visit_reason_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `reason` varchar(80) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of the reason for a DVSA visit to a site';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_visit_reason_lookup_bi`
BEFORE INSERT ON `mot2`.`visit_reason_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_visit_reason_lookup_bi Generated on 2016-12-12 11:29:05. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `weight_source_lookup`
--

DROP TABLE IF EXISTS `weight_source_lookup`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `weight_source_lookup` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) CHARACTER SET latin1 NOT NULL,
  `name` varchar(50) NOT NULL,
  `description` varchar(250) NOT NULL,
  `display_order` smallint(5) unsigned DEFAULT NULL,
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_weight_source_lookup_name` (`name`),
  UNIQUE KEY `uk_weight_source_lookup_code` (`code`),
  UNIQUE KEY `uk_weight_source_lookup_display_order` (`display_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Normalisation of types of weight used for brake test calculations';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_weight_source_lookup_bi`
BEFORE INSERT ON `mot2`.`weight_source_lookup`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_weight_source_lookup_bi Generated on 2016-12-12 11:29:05. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Table structure for table `wheelplan_type`
--

DROP TABLE IF EXISTS `wheelplan_type`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `wheelplan_type` (
  `id` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `code` varchar(5) NOT NULL,
  `name` varchar(50) NOT NULL,
  `description` varchar(255) NOT NULL,
  `display_order` smallint(5) unsigned NOT NULL DEFAULT '1',
  `created_by` int(10) unsigned NOT NULL,
  `created_on` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
  `last_updated_by` int(10) unsigned DEFAULT NULL,
  `last_updated_on` datetime(6) DEFAULT NULL,
  `version` int(10) unsigned NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_wheelplan_type_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=COMPRESSED COMMENT='Will be removed - normalisation of unused data';
/*!40101 SET character_set_client = @saved_cs_client */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 */ /*!50003 TRIGGER `mot2`.`tr_wheelplan_type_bi`
BEFORE INSERT ON `mot2`.`wheelplan_type`
FOR EACH ROW
MainBlock: BEGIN
    
    DECLARE c_version VARCHAR(256) DEFAULT 'tr_wheelplan_type_bi Generated on 2016-12-12 11:29:05. $Id$';
    
    IF `mot2`.`is_mot_trigger_disabled`()
    THEN
        LEAVE MainBlock;
    END IF;
    
    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL if triggers are enabled.';
    END IF;
    
    SET NEW.`version` = 1;
    SET NEW.`created_by` = COALESCE(@app_user_id, NEW.`last_updated_by`, NEW.`created_by`);
    SET NEW.`last_updated_by` = NEW.`created_by`;
    SET NEW.`created_on` = CURRENT_TIMESTAMP;
    SET NEW.`last_updated_on` = NEW.`created_on`;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Dumping events for database 'mot2'
--

--
-- Dumping routines for database 'mot2'
--
/*!50003 DROP FUNCTION IF EXISTS `f_collapse` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  FUNCTION `f_collapse`( p_str VARCHAR(255)) RETURNS varchar(255) CHARSET latin1
    NO SQL
    DETERMINISTIC
BEGIN
    DECLARE c_version VARCHAR(256) DEFAULT '$Id$';
    
    DECLARE v_str VARCHAR(255) DEFAULT '';
    SET v_str := REPLACE(f_collapse_base(p_str), '*', '');
    RETURN v_str;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `f_collapse_base` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  FUNCTION `f_collapse_base`(p_str VARCHAR(255)) RETURNS varchar(255) CHARSET latin1
    NO SQL
    DETERMINISTIC
BEGIN
    DECLARE c_version VARCHAR(256) DEFAULT '$Id$';
    
    DECLARE v_str VARCHAR(255) DEFAULT '';
    SET v_str :=
        REPLACE(
            REPLACE(
                REPLACE(
                    REPLACE(
                        REPLACE(
                            REPLACE(
                                REPLACE(
                                    REPLACE(
                                        REPLACE(
                                            REPLACE(
                                                REPLACE(
                                                    REPLACE(
                                                        REPLACE(
                                                            REPLACE(UPPER(p_str), 'O','0')
                                                        , 'I','1')
                                                    , 'Z','2')
                                                , 'E','3')
                                            , 'A','4')
                                        , 'S','5')
                                    , 'G','6')
                                , 'T','7')
                            , 'L','7')
                        , 'B','8')
                    , '-','')
                , '/','')
            , '.','')
        , ' ','');
    RETURN v_str;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP FUNCTION IF EXISTS `is_mot_trigger_disabled` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  FUNCTION `is_mot_trigger_disabled`() RETURNS tinyint(1)
    NO SQL
    SQL SECURITY INVOKER
BEGIN
    
    DECLARE c_module VARCHAR(64) DEFAULT 'is_mot_trigger_disabled';
    DECLARE c_version VARCHAR(256) DEFAULT '$Id$';

    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        DECLARE c_null CHAR(4) CHARACTER SET latin1 DEFAULT 'NULL';
        DECLARE v_returned_sqlstate, v_message_text VARCHAR(1024) DEFAULT '';
        GET DIAGNOSTICS CONDITION 1 v_returned_sqlstate = RETURNED_SQLSTATE, v_message_text = MESSAGE_TEXT;
        CALL `ddr_util`.`logger`('error', c_module, CONCAT_WS('|', v_returned_sqlstate, v_message_text,
                                                              IFNULL(@is_mot_trigger_disabled, c_null)));
        RESIGNAL;
    END;

    IF (@is_mot_trigger_disabled IS NULL)
    THEN
        CALL `mot2`.`set_mot_trigger_disabled`(FALSE); 
    END IF;

    RETURN @is_mot_trigger_disabled;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `add_vehicle_hist_entry` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE PROCEDURE `mot2`.`add_vehicle_hist_entry`(INOUT p_version INTEGER UNSIGNED,
                                                 IN p_vehicle_id INTEGER UNSIGNED,
                                                 IN p_registration VARCHAR(20),
                                                 IN p_vin VARCHAR(30),
                                                 IN p_model_detail_id INTEGER UNSIGNED,
                                                 IN p_year YEAR,
                                                 IN p_manufacture_date DATE,
                                                 IN p_first_registration_date DATE,
                                                 IN p_first_used_date DATE,
                                                 IN p_primary_colour_id SMALLINT UNSIGNED,
                                                 IN p_secondary_colour_id SMALLINT UNSIGNED,
                                                 IN p_weight INTEGER UNSIGNED,
                                                 IN p_weight_source_id SMALLINT UNSIGNED,
                                                 IN p_country_of_registration_id SMALLINT UNSIGNED,
                                                 IN p_engine_number VARCHAR(30),
                                                 IN p_chassis_number VARCHAR(30),
                                                 IN p_is_new_at_first_reg TINYINT UNSIGNED,
                                                 IN p_dvla_vehicle_id INTEGER UNSIGNED,
                                                 IN p_is_damaged TINYINT UNSIGNED,
                                                 IN p_is_destroyed TINYINT UNSIGNED,
                                                 IN p_is_incognito TINYINT UNSIGNED)
    MODIFIES SQL DATA
    SQL SECURITY INVOKER
BEGIN
    /**
    * Write a row to `mot2`.`vehicle_hist`. Identifies intermediate vehicle version number for the record, and returns
    * that value as an INOUT parameter to the caller. The _hist tables do not have their own triggers so we do not need
    * to protect against them firing.
    *
    * It is the responsibility of the caller to wrap this call in a transaction to provide it with a consistent view of
    * the vehicle_hist table. Failure to do so could result in returning a version number that is no longer valid at the
    * point of the caller consuming it.
    *
    * Example:
    *   SET @version := 10000; -- this is the 'current' version
    *   CALL `mot2`.`add_vehicle_hist_entry`(@version, 100, 'S130XET', 'WF0BXXWPRBWY29630', 361, 1998, '1998-12-31', '1998-12-31', '1998-12-31', 7, 19,
    *                                                  1010, 1, 1, 'WY29630', NULL, TRUE, 78539677, FALSE, TRUE, FALSE);
    *   SELECT @version `New Version Number`;
    *
    * param     p_version as an INOUT parameter returns the version number of the incoming vehicle record. It must be
    *             set to the value expected to be 'below' the newly written version of the vehicle's history. E.g. pass
    *             as 10000 and expect a return of something along the lines of 15000, 12500, 11250, or 10625, etc.
    *             This cannot be the current vehicle version number. The process does not check to see if this is an
    *             actual version number, as there is no real need to.
    *
    * throws    '45000' if @app_user_id is NULL.
    * throws    '45000' if p_version is NULL, or zero.
    * throws    '45000' if p_is is NULL _or_ both p_registration and p_vin are NULL.
    * throws    '45000' if p_version is higher or equal to the vehicle's current (latest) version number.
    * throws    '45000' if it is unable to establish the version number that appears immediately above the one we're
    *                     altering. E.g. if the current vehicle version is 20000, and we alter 10000 then it should offer
    *                     (say) 15000.
    * throws    '45000' if the calculated new version is the same (though the course of division) as the version number
    *                     passed by the caller.
    */
    DECLARE c_module VARCHAR(64) DEFAULT 'add_vehicle_hist_entry';
    DECLARE c_version VARCHAR(256) DEFAULT '$Id$';

    DECLARE c_incoming_vehicle_version INTEGER UNSIGNED DEFAULT IFNULL(p_version, 0); -- careful around naming here as we already have a 'c_version'
    DECLARE c_version_midpoint INTEGER UNSIGNED DEFAULT 5000;

    DECLARE c_registration_collapsed VARCHAR(20) DEFAULT `mot2`.`f_collapse`(p_registration);
    DECLARE c_vin_collapsed VARCHAR(30) DEFAULT `mot2`.`f_collapse`(p_vin);

    DECLARE c_is_new_at_first_reg TINYINT UNSIGNED DEFAULT IFNULL(p_is_new_at_first_reg, FALSE);
    DECLARE c_is_damaged TINYINT UNSIGNED DEFAULT IFNULL(p_is_damaged, FALSE);
    DECLARE c_is_destroyed TINYINT UNSIGNED DEFAULT IFNULL(p_is_destroyed, FALSE);
    DECLARE c_is_incognito TINYINT UNSIGNED DEFAULT IFNULL(p_is_incognito, FALSE);

    DECLARE c_current_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP;

    DECLARE v_current_vehicle_version INTEGER UNSIGNED DEFAULT 0;
    DECLARE v_lowest_version_above INTEGER UNSIGNED DEFAULT 0;
    DECLARE v_highest_version_below INTEGER UNSIGNED DEFAULT 0;

    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        DECLARE c_null CHAR(4) CHARACTER SET latin1 DEFAULT 'NULL';
        DECLARE v_returned_sqlstate, v_message_text VARCHAR(1024) DEFAULT '';
        GET DIAGNOSTICS CONDITION 1 v_returned_sqlstate = RETURNED_SQLSTATE, v_message_text = MESSAGE_TEXT;
        CALL `ddr_util`.`logger`('error', c_module, CONCAT_WS('|', v_returned_sqlstate, v_message_text,
                                                              IFNULL(p_version, c_null),
                                                              IFNULL(p_vehicle_id, c_null),
                                                              IFNULL(p_registration, c_null),
                                                              IFNULL(p_vin, c_null),
                                                              IFNULL(p_model_detail_id, c_null),
                                                              IFNULL(p_year, c_null),
                                                              IFNULL(p_manufacture_date, c_null),
                                                              IFNULL(p_first_registration_date, c_null),
                                                              IFNULL(p_first_used_date, c_null),
                                                              IFNULL(p_primary_colour_id, c_null),
                                                              IFNULL(p_secondary_colour_id, c_null),
                                                              IFNULL(p_weight, c_null),
                                                              IFNULL(p_weight_source_id, c_null),
                                                              IFNULL(p_country_of_registration_id, c_null),
                                                              IFNULL(p_engine_number, c_null),
                                                              IFNULL(p_chassis_number, c_null),
                                                              IFNULL(p_is_new_at_first_reg, c_null),
                                                              IFNULL(p_dvla_vehicle_id, c_null),
                                                              IFNULL(p_is_damaged, c_null),
                                                              IFNULL(p_is_destroyed, c_null),
                                                              IFNULL(p_is_incognito, c_null)));
        RESIGNAL;
    END;

    IF (@app_user_id IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Session variable @app_user_id cannot be NULL.';
    END IF;

    IF (c_incoming_vehicle_version = 0)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Incoming Vehicle Version cannot be passed as NULL or 0 (zero)';
    END IF;

    IF (p_vehicle_id IS NULL OR (p_registration IS NULL AND p_vin IS NULL))
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'One or more key parameters are set to NULL';
    END IF;

    SELECT `version` INTO v_current_vehicle_version
      FROM `mot2`.`vehicle`
     WHERE `id` = p_vehicle_id;

    IF (FOUND_ROWS() = 0)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Vehicle does not exist';
    END IF;

    IF (v_current_vehicle_version < p_version)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'New version is too high';
    END IF;
 
    -- locate the vehicle's historical version number that appears immediately above the version we're 'updating'.
    -- if the version we're updating is the highest hist version then we need to position between that and the current
    -- vehicle.version value
    SELECT IFNULL(MIN(`version`), v_current_vehicle_version) INTO v_lowest_version_above
      FROM `mot2`.`vehicle_hist`
     WHERE `id` = p_vehicle_id
       AND `version` > p_version;

    SELECT MAX(`version`) INTO v_highest_version_below
      FROM `mot2`.`vehicle_hist`
     WHERE `id` = p_vehicle_id
       AND `version` < p_version;

    IF (IFNULL(v_lowest_version_above, 0) = 0)
    THEN
        -- it should not be possible for this condition to occur, but if it does, and we ignore it, then we'll have problems
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Could not establish the version immediately after the one specified';
    END IF;

    IF ((v_lowest_version_above - p_version) = 0)
    THEN
        IF (IFNULL(v_highest_version_below, 0) = 0)
        THEN
            SET p_version := c_version_midpoint;
        ELSE
            SET p_version := v_highest_version_below + ((p_version - v_highest_version_below) / 2);
        END IF;
        ELSE
            SET p_version := p_version + ((v_lowest_version_above - p_version) / 2); -- this is the new version number
    END IF;

    IF (p_version = v_lowest_version_above) OR (p_version = v_highest_version_below)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Not enough version numbers available';
    END IF;

    -- LAST_INSERT_ID() to get `hist_id` back, but we're not interested in that.
    INSERT INTO `mot2`.`vehicle_hist` (hist_id, expired_on, expired_by,
                                       id, registration, registration_collapsed, vin, vin_collapsed, model_detail_id,
                                       year, manufacture_date, first_registration_date, first_used_date,
                                       primary_colour_id, secondary_colour_id,
                                       weight, weight_source_id, country_of_registration_id,
                                       engine_number, chassis_number, 
                                       is_new_at_first_reg, dvla_vehicle_id, is_damaged, is_destroyed, is_incognito,
                                       created_by, created_on, last_updated_by, last_updated_on, version)
                               VALUES (NULL, c_current_timestamp, @app_user_id,
                                       p_vehicle_id, p_registration, c_registration_collapsed, p_vin, c_vin_collapsed, p_model_detail_id,
                                       p_year, p_manufacture_date, p_first_registration_date, p_first_used_date,
                                       p_primary_colour_id, p_secondary_colour_id,
                                       p_weight, p_weight_source_id, p_country_of_registration_id,
                                       p_engine_number, p_chassis_number,
                                       c_is_new_at_first_reg, p_dvla_vehicle_id, c_is_damaged, c_is_destroyed, c_is_incognito,
                                       @app_user_id, c_current_timestamp, @app_user_id, c_current_timestamp, p_version);
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `gen_transition_fin_report` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `gen_transition_fin_report`()
BEGIN
  SELECT concat(IFNULL(o.name,''), ',',
         IFNULL(afa.ae_ref,''), ',',
         IFNULL(tar.description,''), ',',
         IFNULL(ta.slots,''), ',',
         date_format(ta.created_on, '%Y-%m-%d %T'))
    FROM test_slot_transaction_amendment ta
   INNER JOIN organisation o ON o.id = ta.organisation_id
   INNER JOIN auth_for_ae afa ON afa.organisation_id = o.id
   INNER JOIN test_slot_transaction_amendment_reason tar ON tar.id = ta.reason_id
   WHERE ta.type_id = 1
   GROUP BY ta.id, o.name, afa.ae_ref, tar.description, ta.slots, ta.created_on
   ORDER BY ta.created_on;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `gen_transition_slot_balances_fin_report` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `gen_transition_slot_balances_fin_report`()
    READS SQL DATA
    SQL SECURITY INVOKER
BEGIN
    SELECT
        concat(IFNULL(a.ae_ref,'NULL'), ',',
        IFNULL(o.name,'NULL'), ',',
        IFNULL(o.mot1_total_slots_merged,'NULL'), ',',
        IFNULL(slots_purchased_sum,'NULL'), ',',
        IFNULL(slots_used_count,'NULL'))
    FROM
        organisation o
    INNER JOIN
        auth_for_ae a
        ON a.organisation_id = o.id
       AND a.status_id NOT IN (0,1) 
    LEFT OUTER JOIN
        (SELECT
            t.organisation_id, SUM(t.slots) slots_purchased_sum
        FROM
            test_slot_transaction t
        WHERE
            t.status_id = 2
                AND t.completed_on BETWEEN DATE(DATE_ADD(NOW(), INTERVAL -1 DAY)) AND DATE(NOW())
        GROUP BY 1) slots_purchased ON slots_purchased.organisation_id = o.id
    LEFT OUTER JOIN
        (SELECT
            s.organisation_id, COUNT(mt.id) slots_used_count
        FROM
            mot_test mt
        INNER JOIN site s ON mt.site_id = s.id
        WHERE
            mt.mot_test_type_id IN (1 , 2, 3, 9)
                AND mt.status_id = 6
                AND mt.completed_date BETWEEN DATE(DATE_ADD(NOW(), INTERVAL -1 DAY)) AND DATE(NOW())
        GROUP BY 1) slots_used ON slots_used.organisation_id = o.id
    ORDER BY a.ae_ref , o.name , o.mot1_total_slots_merged , slots_purchased_sum , slots_used_count;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `set_mot_trigger_disabled` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `set_mot_trigger_disabled`(p_is_mot_trigger_disabled BOOLEAN)
    NO SQL
    SQL SECURITY INVOKER
BEGIN
    
    DECLARE c_module VARCHAR(64) DEFAULT 'set_mot_trigger_disabled';
    DECLARE c_version VARCHAR(256) DEFAULT '$Id$';
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        DECLARE c_null CHAR(4) CHARACTER SET latin1 DEFAULT 'NULL';
        DECLARE v_returned_sqlstate, v_message_text VARCHAR(1024) DEFAULT '';
        GET DIAGNOSTICS CONDITION 1 v_returned_sqlstate = RETURNED_SQLSTATE, v_message_text = MESSAGE_TEXT;
        CALL `ddr_util`.`logger`('error', c_module, CONCAT_WS('|', v_returned_sqlstate, v_message_text,
                                                              IFNULL(p_is_mot_trigger_disabled, c_null)));
        RESIGNAL;
    END;

    IF (p_is_mot_trigger_disabled IS NULL)
    THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'MOT Trigger Disable setting cannot be NULL.';
    END IF;

    SET @is_mot_trigger_disabled = p_is_mot_trigger_disabled;
END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `slot_balance_finance_report` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `slot_balance_finance_report`(IN i_ae_ref VARCHAR(12), IN i_report_start_date DATETIME(6), IN i_report_end_date DATETIME(6), IN i_active_days SMALLINT)
    READS SQL DATA
    SQL SECURITY INVOKER
BEGIN

    DECLARE i_created_start_date DATETIME(6);

    SET i_created_start_date = DATE_SUB(i_report_start_date, INTERVAL i_active_days  DAY);

    SELECT CONCAT( 
           ae_ref, ',',                        
           REPLACE(name,',',''), ',',      
           IFNULL(ae_status,''), ',',      
           DATE(i_report_start_date), ',',
           DATE(i_report_end_date), ',',
           IFNULL(opening_slots,0), ',',   
           IFNULL(sum_slots_used,0), ',',  
           IFNULL(slots_purchased,0), ',', 
           IFNULL(slot_amendments,0), ',', 
           IFNULL(end_slots,0),',',        
           IFNULL(opening_slots,0) 
               - IFNULL(sum_slots_used,0) 
               + IFNULL(slots_purchased,0) 
               + IFNULL(slot_amendments,0),',',  
          (IFNULL(opening_slots,0) 
               - IFNULL(sum_slots_used,0) 
               + IFNULL(slots_purchased,0) 
               + IFNULL(slot_amendments,0)) 
               - IFNULL(end_slots,0), ',',      
            ae_ref, ',',                        
            site_change_count, ',',             
            ifnull(ae_list,'')                  
        )
        as 'AE Ref, AE Name, AE Status, Start Date, End Date, Start Slot Balance, Slots Used, Purchased Volume, Slot Amendments, End Slot Balance, Expected End Slot Balance, Variance, AE Ref, AE-Site Changes, AE_list'
    FROM  
    (SELECT o.id, afa.ae_ref, o.name, ast.name as ae_status, o.slots_balance, coalesce(o.last_updated_on,o.created_on) last_modified_on,
            IFNULL((SELECT ifnull(oh.slots_balance,0)      
            FROM  organisation_hist oh
            JOIN  transition_status ts on ts.id = oh.transition_status_id
            WHERE oh.id = o.id
            AND   oh.expired_on >= i_report_start_date
            AND   oh.last_updated_on <= i_report_end_date
            AND   ts.code = 'FULL'
            ORDER BY oh.expired_on
            LIMIT 1),
              CASE
              WHEN 
                   coalesce(o.last_updated_on,o.created_on)  <= i_report_end_date
              THEN IFNULL(slots_balance,0)
              ELSE 0
              END) opening_slots,
           IFNULL(test_count.sum_slots_used,0) sum_slots_used,
           CASE 
           WHEN 
                coalesce(o.last_updated_on,o.created_on) <= i_report_end_date 
           THEN o.slots_balance
           ELSE
             (SELECT oh.slots_balance     
              FROM organisation_hist oh
              JOIN  transition_status ts on ts.id = oh.transition_status_id
              WHERE oh.id = o.id
              AND   oh.expired_on >= i_report_start_date
              AND   oh.last_updated_on <= i_report_end_date
              AND   ts.code = 'FULL'
              ORDER BY oh.expired_on desc
              LIMIT 1) 
           END as end_slots,
           (SELECT sum(tst.slots) 
            FROM test_slot_transaction tst
            JOIN test_slot_transaction_status tss ON tst.status_id = tss.id
            JOIN payment p ON tst.payment_id = p.id
            JOIN payment_status ps ON p.status_id = ps.id
            WHERE tss.code = 'CO' 
            AND   coalesce(tst.completed_on,tst.created_on) >= i_report_start_date
            AND   coalesce(tst.completed_on,tst.created_on) <= i_report_end_date
            AND   ps.code = 'S'   
            AND   tst.organisation_id = o.id) slots_purchased,
           ((SELECT ifnull(sum(tsa.slots),0) 
            FROM  test_slot_transaction_amendment tsa
            JOIN  test_slot_transaction_amendment_type atype ON atype.id = tsa.type_id
            WHERE tsa.created_on >= i_report_start_date
            AND   tsa.created_on <= i_report_end_date
            AND   atype.code <> 'T702'
            AND   tsa.organisation_id = o.id) +
           (SELECT ifnull(sum(tsa.slots),0) * -1 
            FROM  test_slot_transaction_amendment tsa
            JOIN  test_slot_transaction_amendment_type atype ON atype.id = tsa.type_id
            WHERE tsa.created_on >= i_report_start_date
            AND   tsa.created_on <= i_report_end_date
            AND   atype.code = 'T702'
            AND   tsa.organisation_id = o.id) ) slot_amendments ,
           (
             SELECT ifnull(count(distinct id),0) 
             FROM site_hist h
             WHERE h.organisation_id = o.id
             AND  h.expired_on >= i_report_start_date
             AND  h.last_updated_on <= i_report_end_date
             AND NOT EXISTS 
             (SELECT 1 FROM site s
              WHERE h.id = s.id
              AND   h.organisation_id = s.organisation_id)
             ) +
             
            (SELECT ifnull(count(distinct id),0) 
             FROM site_hist h  
             WHERE h.id in (select id FROM site WHERE organisation_id = o.id)
             AND   h.last_updated_on <= i_report_end_date
             AND   h.expired_on >= i_report_start_date
             AND   h.organisation_id is not null
             AND   h.organisation_id <> o.id
             )   
             site_change_count,
             replace(concat(ifnull(ae_not_linked.ae_list,','),',',ifnull(new_ae_link.ae_list ,'')),',,','') ae_list
    FROM organisation o
    JOIN auth_for_ae afa        ON afa.organisation_id = o.id
    JOIN auth_for_ae_status ast ON afa.status_id = ast.id
    LEFT JOIN
      (SELECT o.id,
            
            
            
            
            
            SUM(CASE
               WHEN s.code = 'P' AND
                    m.created_on >= i_report_start_date AND
                    m.created_on <= i_report_end_date 
               THEN 1 

               WHEN s.code = 'A' AND
                    m.created_on >= i_report_start_date AND
                    m.created_on <= i_report_end_date 
               THEN 1 
               
               WHEN m.emergency_log_id is null AND
                    s.code NOT IN ('P','A')  AND 
                    m.created_on >= i_report_start_date AND
                    m.completed_date <= i_report_end_date 
               THEN 0 
     
               WHEN m.emergency_log_id is null AND
                    s.code NOT IN ('P','A')  AND 
                    m.created_on >= i_report_start_date AND
                    m.created_on <= i_report_end_date AND
                    m.completed_date > i_report_end_date 
               THEN 1  

               WHEN m.emergency_log_id is null AND
                    s.code NOT IN ('P','A')  AND 
                    m.created_on < i_report_start_date AND
                    m.completed_date >= i_report_start_date AND
                    m.completed_date <= i_report_end_date 
               THEN -1 
     
               WHEN m.emergency_log_id IS NOT NULL AND
                    s.code NOT IN ('P','A')  AND 
                    m.created_on < i_report_start_date AND
                    m.last_updated_on >= i_report_start_date AND
                    m.last_updated_on <= i_report_end_date 
               THEN 
                   IF((SELECT IFNULL(min(h.last_updated_on),m.created_on)  
                       FROM mot_test_hist h 
                       WHERE m.id = h.id 
                       AND h.status_id IS NOT NULL 
                       AND h.status_id not in (4,6)) BETWEEN i_report_start_date AND i_report_end_date,  -1, 0) 

               WHEN m.emergency_log_id IS NOT NULL AND
                    s.code NOT IN ('P','A')  AND 
                    m.created_on >= i_report_start_date AND
                    m.created_on <= i_report_end_date AND
                    m.last_updated_on > i_report_end_date
               THEN 
                   IF((SELECT IFNULL(min(h.last_updated_on),m.created_on)  
                       FROM mot_test_hist h 
                       WHERE m.id = h.id 
                       AND h.status_id IS NOT NULL 
                       AND h.status_id not in (4,6)) > i_report_end_date,  1, 0) 
               ELSE 0 
               END
            )  sum_slots_used  
       FROM organisation o 
       JOIN auth_for_ae afa ON afa.organisation_id = o.id
       JOIN site se ON se.organisation_id = o.id
       JOIN mot_test m FORCE INDEX (mot_test_created_on_emergency_log_id_idx) ON m.site_id = se.id 
       JOIN mot_test_status s ON s.id = m.status_id 
       JOIN mot_test_type t   ON t.id = m.mot_test_type_id AND t.code IN ('NT','PL','PV','RT','ES','EI')
       WHERE m.created_on >= i_created_start_date
       AND   m.created_on <= i_report_end_date
       AND  (i_ae_ref = 'ALL' OR afa.ae_ref = i_ae_ref)
       
       GROUP BY o.id
       ) test_count  ON test_count.id = o.id
    LEFT JOIN 
    ( 
        SELECT site_hist.organisation_id, group_concat(distinct concat(ifnull(ae.ae_ref,concat('Site Unlink')),' [',se.site_number,']')) ae_list
        FROM site_hist
        JOIN site se             ON site_hist.id = se.id 
        LEFT JOIN auth_for_ae ae ON ae.organisation_id = se.organisation_id
        WHERE 
              site_hist.organisation_id is not null
        AND   site_hist.expired_on >= i_report_start_date  
        AND NOT EXISTS                                        
            (SELECT 1 FROM site
             WHERE site.id = site_hist.id
             AND   site.organisation_id = site_hist.organisation_id
             )   
        GROUP BY site_hist.organisation_id
    ) ae_not_linked   ON ae_not_linked.organisation_id = o.id
    LEFT JOIN 
    (  
        SELECT se.organisation_id, group_concat(distinct concat(ifnull(ae.ae_ref,concat('Site Unlink')),' [',se.site_number,']')) ae_list
        FROM site_hist 
        JOIN site se             ON site_hist.id = se.id
        LEFT JOIN auth_for_ae ae ON ae.organisation_id = site_hist.organisation_id
        WHERE 
              site_hist.organisation_id is not null
        AND   site_hist.expired_on >= i_report_start_date 
        AND EXISTS                                            
            (SELECT 1 FROM site
             WHERE site.id = site_hist.id
             AND   site.organisation_id <> site_hist.organisation_id
             )
        GROUP BY se.organisation_id
    ) new_ae_link   ON new_ae_link.organisation_id = o.id
    WHERE 
       (i_ae_ref = 'ALL' OR afa.ae_ref = i_ae_ref)
    ) sb_rpt;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `sp_sequence` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `sp_sequence`(
  IN in_seq_code varchar(10)
)
    MODIFIES SQL DATA
    SQL SECURITY INVOKER
BEGIN

    DECLARE l_prefix varchar(50);
    DECLARE l_padding tinyint unsigned;
    DECLARE l_seq bigint;
    DECLARE l_increment smallint;
    DECLARE l_padded varchar(50) DEFAULT '';
    DECLARE l_min int unsigned;
    DECLARE l_max int unsigned;
    DECLARE l_out_sequence varchar(100) DEFAULT '';
    DECLARE l_message_text varchar(100) DEFAULT '';
    DECLARE sequence_not_found CONDITION FOR SQLSTATE '45000';
    DECLARE minimum_reached CONDITION FOR SQLSTATE '45001';
    DECLARE maximum_reached CONDITION FOR SQLSTATE '45002';

    START TRANSACTION;
      select prefix_str, padding, sequence_number, increment_val, min_val, max_val
      into l_prefix, l_padding, l_seq, l_increment, l_min, l_max
      from ctrl_sequence where code = in_seq_code FOR UPDATE;

      
      
      if (l_seq IS NULL) THEN
        set l_message_text = concat_ws('', 'Sequence "', in_seq_code, '" not found');
        SIGNAL sequence_not_found SET MESSAGE_TEXT = l_message_text;
      end if;

      
      set l_seq = l_seq + l_increment;

      
      
      
      if (l_seq < l_min) then
        set l_message_text = concat_ws('', 'Sequence minimum value reached: ', l_min);
        SIGNAL minimum_reached SET MESSAGE_TEXT = l_message_text;
      end if;

      
      if (l_seq > l_max) then
        set l_message_text = concat_ws('', 'Sequence maximum value reached: ', l_max);
        SIGNAL maximum_reached SET MESSAGE_TEXT = l_message_text;
      end if;

      
      if (l_padding > 0) then

        
        
        if (l_padding < length(l_seq)) then
          set l_padding = length(l_seq);
        end if;

        
        set l_padded = lpad(l_seq, l_padding, '0');
      else
        
        set l_padded = l_seq;
      end if;

      
      UPDATE ctrl_sequence
        set sequence_number = l_seq,
            last_updated_by = 0,
            last_updated_on = CURRENT_TIMESTAMP(6),
            version = version + 1
        where code = in_seq_code;

      
      set l_out_sequence = concat(coalesce(l_prefix, ''), l_padded);
      select l_out_sequence as sequence from dual;

    COMMIT;
  END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 DROP PROCEDURE IF EXISTS `test_count_at_site_report` */;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8 */ ;
/*!50003 SET character_set_results = utf8 */ ;
/*!50003 SET collation_connection  = utf8_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'STRICT_ALL_TABLES' */ ;
DELIMITER ;;
CREATE  PROCEDURE `test_count_at_site_report`(IN i_site_id INT(10), IN i_report_start_date DATETIME(6), IN i_report_end_date DATETIME(6), IN i_active_days SMALLINT)
    READS SQL DATA
    SQL SECURITY INVOKER
BEGIN

    DECLARE i_created_start_date DATETIME(6);

    SET i_created_start_date = DATE_SUB(i_report_start_date, INTERVAL i_active_days  DAY);

    SELECT  concat( ifnull(a.ae_ref,'null'), ',', ifnull(se.organisation_id,'null'), ',', ifnull(se.site_number,'null'), ',', m.site_id, ',',
        
        
        
        
        
        SUM(CASE
           WHEN s.code = 'P' AND
                m.created_on >= i_report_start_date AND
                m.created_on <= i_report_end_date
           THEN 1 

           WHEN s.code = 'A' AND
                m.created_on >= i_report_start_date AND
                m.created_on <= i_report_end_date
           THEN 1 

           WHEN m.emergency_log_id is null AND
                s.code NOT IN ('P','A')  AND
                m.created_on >= i_report_start_date AND
                m.completed_date <= i_report_end_date
           THEN 0 

           WHEN m.emergency_log_id is null AND
                s.code NOT IN ('P','A')  AND
                m.created_on >= i_report_start_date AND
                m.created_on <= i_report_end_date AND
                m.completed_date > i_report_end_date
           THEN 1  

           WHEN m.emergency_log_id is null AND
                s.code NOT IN ('P','A')  AND
                m.created_on < i_report_start_date AND
                m.completed_date >= i_report_start_date AND
                m.completed_date <= i_report_end_date
           THEN -1 

           WHEN m.emergency_log_id IS NOT NULL AND
                s.code NOT IN ('P','A')  AND
                m.created_on < i_report_start_date AND
                m.last_updated_on >= i_report_start_date AND
                m.last_updated_on <= i_report_end_date
           THEN 
               IF((SELECT IFNULL(min(h.last_updated_on),m.created_on)
                   FROM mot_test_hist h
                   WHERE m.id = h.id
                   AND h.status_id IS NOT NULL
                   AND h.status_id not in (4,6)) BETWEEN i_report_start_date AND i_report_end_date,  -1, 0)

           WHEN m.emergency_log_id IS NOT NULL AND
                s.code NOT IN ('P','A')  AND
                m.created_on >= i_report_start_date AND
                m.created_on <= i_report_end_date AND
                m.last_updated_on > i_report_end_date
           THEN 
               IF((SELECT IFNULL(min(h.last_updated_on),m.created_on)
                   FROM mot_test_hist h
                   WHERE m.id = h.id
                   AND h.status_id IS NOT NULL
                   AND h.status_id not in (4,6)) > i_report_end_date,  1, 0)
           ELSE 0
           END) ) as line
    FROM mot_test m          FORCE INDEX (mot_test_created_on_emergency_log_id_idx)
    JOIN mot_test_status s   ON s.id = m.status_id
    JOIN mot_test_type t     ON t.id = m.mot_test_type_id AND t.code IN ('NT','PL','PV','RT','ES','EI')
    JOIN site se             ON se.id = m.site_id
    LEFT JOIN auth_for_ae a  ON se.organisation_id = a.organisation_id
    WHERE m.created_on >= i_created_start_date
    AND   m.created_on <= i_report_end_date
    
    AND   (i_site_id is null OR i_site_id = m.site_id)
    GROUP BY  a.ae_ref, se.organisation_id, se.site_number, m.site_id;

END ;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;

--
-- Current Database: `mot2`
--

USE `mot2`;

--
-- Final view structure for view `vehicle_detail_vw`
--

/*!50001 DROP VIEW IF EXISTS `vehicle_detail_vw`*/;
/*!50001 SET @saved_cs_client          = @@character_set_client */;
/*!50001 SET @saved_cs_results         = @@character_set_results */;
/*!50001 SET @saved_col_connection     = @@collation_connection */;
/*!50001 SET character_set_client      = utf8 */;
/*!50001 SET character_set_results     = utf8 */;
/*!50001 SET collation_connection      = utf8_general_ci */;
/*!50001 CREATE ALGORITHM=UNDEFINED */
/*!50013  SQL SECURITY DEFINER */
/*!50001 VIEW `vehicle_detail_vw` AS select `v_`.`id` AS `vehicle_id_`,`v_`.`registration` AS `registration`,`v_`.`vin` AS `vin`,`mk_`.`id` AS `make_id_`,`mk_`.`name` AS `make_name_`,`mk_`.`code` AS `make_code_`,`mo_`.`id` AS `model_id_`,`mo_`.`name` AS `model_name_`,`mo_`.`code` AS `model_code_`,`md_`.`id` AS `model_detail_id_` from (((`vehicle` `v_` join `model_detail` `md_` on((`md_`.`id` = `v_`.`model_detail_id`))) join `model` `mo_` on((`mo_`.`id` = `md_`.`model_id`))) join `make` `mk_` on((`mk_`.`id` = `mo_`.`make_id`))) */;
/*!50001 SET character_set_client      = @saved_cs_client */;
/*!50001 SET character_set_results     = @saved_cs_results */;
/*!50001 SET collation_connection      = @saved_col_connection */;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed
